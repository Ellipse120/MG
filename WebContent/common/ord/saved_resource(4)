M.add("mt-formchecker",function(e){function t(){t.superclass.constructor.apply(this,arguments)}var i=e.Node,s=e.io,a=e.Object,n=e.Lang.isFunction,r=e.Lang.isString,o=e.Lang.trim,l=e.mt.util,c={old:{fieldGroup:"field-group",highlightGroup:"field-group--highlight",type:"field-group--type",ok:"field-group--ok",error:"field-group--error"},"new":{fieldGroup:"form-field",highlightGroup:"form-field--highlight",type:"form-field--type",ok:"form-field--ok",error:"form-field--error"}},u=".",d="FormChecker: ",f=200,h="success",p="failure";t.NAME="formChecker",t.STATUS_INIT=0,t.STATUS_CHECKING=1,t.STATUS_OK=2,t.STATUS_ERROR=3,t.CLASS_INLINE_TIP="inline-tip",t.CLASS_BLOCK_TIP="block-tip",t.CHECK_EMPTY_FN=function(e){return""===o(e.get("value"))},t.ATTRS={form:{value:null,setter:"_setForm",writeOnce:!0},fields:{value:null},checkEvent:{value:"submit",writeOnce:!0},tipClass:{value:t.CLASS_INLINE_TIP,writeOnce:!0},showOkTip:{value:!1,writeOnce:!0},highlightGroup:{value:!1,writeOnce:!0},async:{value:!1,writeOnce:!0},newStyle:{value:!1,writeOnce:!0}};var g={initializer:function(){var e,t=this,i=t.get("form"),s=t.get("fields"),a=t.get("async"),n=t.get("newStyle");if(!i)throw new Error(d+"必须设置form参数");if(!s)throw new Error(d+"必须设置fields参数");n?t.className=c["new"]:t.className=i.one(u+c.old.fieldGroup)?c.old:c["new"],t.publish(h,{emitFacade:!0,defaultFn:t._defSuccessFn}),t.publish(p,{emitFacade:!0,defaultFn:t._defFailureFn}),e={emitFacade:!0},a&&(e.defaultFn=function(){i.submit()}),t.publish("submitSuccess",e),t.publish("submitFailure",{emitFacade:!0}),t.on("fieldsChange",function(){t._buildFields()}),t._handles={},t._buildFields(),t._bind()},destructor:function(){l.detachHandle(this._handles)},_bind:function(){function t(t){s.check()?(s.fire("submitSuccess"),e.Global.fire("formChecker:submitSuccess",{instance:s})):(t.halt(!0),s.fire("submitFailure"))}function i(e){e.halt(),s._isCheckingAsync||(s._isCheckingAsync=!0,s.checkAsync(function(e){s._isCheckingAsync=!1,window.setTimeout(function(){e?s.fire("submitFailure"):s.fire("submitSuccess")},0)}))}var s=this,a=s._handles,n=s.get("form"),r=s.get("async"),o=r?i:t;a.submit=n.on("submit",o),a.focus=n.delegate("focus",function(){var e=s._getFieldByNode(this);e&&s.focusField(e,!0)},"input, textarea, select"),a.blur=n.delegate("blur",function(){var e=s._getFieldByNode(this);e&&s.blurField(e,!0)},"input, textarea, select"),e.Global.on("formChecker:valueChange",function(e){var t=s._getFieldByNode(e.node);t&&s.blurField(t,!0)}),a.success=s.on(h,function(e){s._updateUncheckedFields&&s._updateUncheckedFields(e.field.name)}),a.failure=s.on(p,function(e){s._updateUncheckedFields&&s._updateUncheckedFields(e.field.name,!0)})},checkField:function(e){function t(e,t,i){var s={field:t};e===p&&i&&(s.error=i),a.fire(e,s)}var i,a=this,n=e.node,r=e._async;e.validateReg?i=!e.validateReg.test(n.get("value")):e.validateFn&&(i=e.validateFn.call(n,n)),i?t(p,e,i):e.validateAjax?(r&&r.isInProgress()&&r.abort(),r=s(e.validateAjax.action,{method:"POST",data:l.toPostData(e.validateAjax.dataFn()),on:{success:function(i,s){var a=l.getEvalRes(s);a.status?t(h,e):t(p,e,a.msg)},failure:function(i,s){s.statusText&&"abort"===s.statusText||t(p,e,"网络有问题，请稍后重试")}}}),r.isInProgress()&&a._processType(e,"检查中..."),e._async=r):t(h,e)},check:function(){var e=this,i=e.get("fields"),s=!1;return a.each(i,function(i){(i.status===t.STATUS_INIT||i.status===t.STATUS_CHECKING)&&e.checkField(i),i.status===t.STATUS_ERROR&&(s=!0)}),!s},checkAsync:function(e){var i=this,s=i.get("fields"),n={},r=!1;return a.each(s,function(e,i){(e.status===t.STATUS_INIT||e.status===t.STATUS_CHECKING)&&(n[i]=!0),e.status===t.STATUS_ERROR&&(r=!0)}),a.isEmpty(n)?void e(r):(i._updateUncheckedFields=function(t,s){n.hasOwnProperty(t)&&(delete n[t],s&&(r=!0),a.isEmpty(n)&&(i._updateUncheckedFields=null,e(r)))},void a.each(n,function(e,t){i.checkField(s[t])}))},focusField:function(e,t){var i=this,s=e.node,a=e.groupNode,n=i.get("highlightGroup");t||s.focus(),s.test("input[type=text], input[type=password], textarea")&&n&&a.addClass(i.className.highlightGroup),i._processType(e)},blurField:function(e,t){var i=this,s=e.node,a=i.get("highlightGroup"),n=i.get("checkEvent");t||s.blur(),a&&e.groupNode.removeClass(i.className.highlightGroup),"blur"===n?window.setTimeout(function(){i.checkField(e)},f):i.clearTip(e)},_processType:function(e,i){e.status=t.STATUS_CHECKING,i=i||e.typeTip,""===i?this.clearTip(e):this._setTip(e,this.className.type,i)},_defSuccessFn:function(e,i){var s=e.field,a=s.showOkTip;s.status=t.STATUS_OK,a?this._setTip(s,this.className.ok,i||s.okTip||""):this.clearTip(s)},_defFailureFn:function(e){var i=e.field,s=e.error;i.status=t.STATUS_ERROR,s===!0&&(s=i.errorTip),this._setTip(i,this.className.error,s||i.errorTip)},_setTip:function(e,t,s){var a,n,o=this,l=o.get("fields"),d=o.get("tipClass"),f=o.className;if(r(e)&&(e=l[e]),a=e.groupNode,n=a.one(u+d),n||(n=i.create('<span class="'+d+'"></span>'),a.append(n)),f===c["new"])switch(t){case f.type:s='<i class="tip-status"></i>'+s;break;case f.ok:s='<i class="tip-status tip-status--success"></i>'+s;break;case f.error:s='<i class="tip-status tip-status--opinfo"></i>'+s}o.replaceGroupClass(e,t),n.setHTML(s).show()},setOkTip:function(e,t){this._setTip(e,this.className.ok,t)},setErrorTip:function(e,t){this._setTip(e,this.className.error,t)},setTypeTip:function(e,t){this._setTip(e,this.className.type,t)},clearTip:function(e){var t,i,s=this,a=s.get("fields");r(e)&&(e=a[e]),t=e.groupNode,i=t.one(u+s.get("tipClass")),i&&i.setHTML("").hide(),s.replaceGroupClass(e)},replaceGroupClass:function(t,i){var s=t.groupNode,a=this.className;e.Array.each([a.type,a.ok,a.error],function(e){s.removeClass(e)}),i&&s.addClass(i)},_getFieldByNode:function(e){var t=this.get("fields"),i=null;return a.some(t,function(t){return t.node===e?(i=t,!0):void 0}),i},addField:function(i,s){var a=this,r=a.get("fields"),o=a.get("showOkTip"),l=e.one(s.node),c=l&&l.ancestor(u+a.className.fieldGroup);return l&&c?(e.mix(s,{name:i,node:l,groupNode:c,status:t.STATUS_INIT,showOkTip:s.hasOwnProperty("showOkTip")?s.showOkTip:o},!0),s.validateAjax&&!n(s.validateAjax.dataFn)&&(s.validateAjax.dataFn=function(){var e={};return e[l.get("name")]=l.get("value"),e}),r[i]=s,!0):!1},addFields:function(e){var t,i=this,s=!0;for(t in e)e.hasOwnProperty(t)&&(s=i.addField(t,e[t])&&s);return s},removeField:function(e){var t=this,i=t.get("fields"),s=r(e)?e:e.name;return i.hasOwnProperty(s)?(delete i[s],!0):!1},resetAllFields:function(){var t=this,i=t.get("fields");e.Object.each(i,function(e){t.resetField(e)})},resetField:function(e){var i=this,s=i.get("fields");r(e)&&(e=s[e]),e.status=t.STATUS_INIT,i.clearTip(e)},_buildFields:function(){var e=this,t=e.get("fields");a.each(t,function(i,s){var a=e.addField(s,i);a||delete t[s]})},_setForm:function(t){return e.one(t)}};e.extend(t,e.Base,g),e.mt.FormChecker=t},"1.0.0",{requires:["mt-base","io-base","base-base","node"]});
;YUI.add("attribute-complex",function(t,e){var r=t.Attribute;r.Complex=function(){},r.Complex.prototype={_normAttrVals:r.prototype._normAttrVals,_getAttrInitVal:r.prototype._getAttrInitVal},t.AttributeComplex=r.Complex},"3.16.0",{requires:["attribute-base"]});
;YUI.add("base-pluginhost",function(u,l){var n=u.Base,s=u.Plugin.Host;u.mix(n,s,!1,null,1),n.plug=s.plug,n.unplug=s.unplug},"3.16.0",{requires:["base-base","pluginhost"]});
;YUI.add("classnamemanager",function(a,e){var n="classNamePrefix",r="classNameDelimiter",s=a.config;s[n]=s[n]||"yui3",s[r]=s[r]||"-",a.ClassNameManager=function(){var e=s[n],i=s[r];return{getClassName:a.cached(function(){var n=a.Array(arguments);return n[n.length-1]!==!0?n.unshift(e):n.pop(),n.join(i)})}}()},"3.16.0",{requires:["yui-base"]});
;YUI.add("widget-base",function(t,e){function s(t){var e,n,i=this,r=i.constructor;i._strs={},i._cssPrefix=r.CSS_PREFIX||a(r.NAME.toLowerCase()),t=t||{},s.superclass.constructor.call(i,t),n=i.get(S),n&&(n!==P&&(e=n),i.render(e))}var n,i,r=t.Lang,o=t.Node,u=t.ClassNameManager,a=u.getClassName,c=t.cached(function(t){return t.substring(0,1).toUpperCase()+t.substring(1)}),l="content",h="visible",d="hidden",_="disabled",g="focused",f="width",m="height",N="boundingBox",v="contentBox",C="parentNode",b="ownerDocument",I="auto",T="srcNode",p="body",D="tabIndex",E="id",S="render",U="rendered",B="destroyed",y="strings",A="<div></div>",F="Change",x="loading",O="_uiSet",w="",M=function(){},P=!0,R=!1,L={},X=[h,_,m,f,g,D],z=t.UA.webkit,G={};s.NAME="widget",i=s.UI_SRC="ui",s.ATTRS=L,L[E]={valueFn:"_guid",writeOnce:P},L[U]={value:R,readOnly:P},L[N]={valueFn:"_defaultBB",setter:"_setBB",writeOnce:P},L[v]={valueFn:"_defaultCB",setter:"_setCB",writeOnce:P},L[D]={value:null,validator:"_validTabIndex"},L[g]={value:R,readOnly:P},L[_]={value:R},L[h]={value:P},L[m]={value:w},L[f]={value:w},L[y]={value:{},setter:"_strSetter",getter:"_strGetter"},L[S]={value:R,writeOnce:P},s.CSS_PREFIX=a(s.NAME.toLowerCase()),s.getClassName=function(){return a.apply(u,[s.CSS_PREFIX].concat(t.Array(arguments),!0))},n=s.getClassName,s.getByNode=function(e){var s,i=n();return e=o.one(e),e&&(e=e.ancestor("."+i,!0),e&&(s=G[t.stamp(e,!0)])),s||null},t.extend(s,t.Base,{getClassName:function(){return a.apply(u,[this._cssPrefix].concat(t.Array(arguments),!0))},initializer:function(e){var s=this.get(N);s instanceof o&&this._mapInstance(t.stamp(s))},_mapInstance:function(t){G[t]=this},destructor:function(){var e,s=this.get(N);s instanceof o&&(e=t.stamp(s,!0),e in G&&delete G[e],this._destroyBox())},destroy:function(t){return this._destroyAllNodes=t,s.superclass.destroy.apply(this)},_destroyBox:function(){var t,e=this.get(N),s=this.get(v),n=this._destroyAllNodes;t=e&&e.compareTo(s),this.UI_EVENTS&&this._destroyUIEvents(),this._unbindUI(e),s&&(n&&s.empty(),s.remove(P)),t||(n&&e.empty(),e.remove(P))},render:function(t){return!this.get(B)&&!this.get(U)&&(this.publish(S,{queuable:R,fireOnce:P,defaultTargetOnly:P,defaultFn:this._defRenderFn}),this.fire(S,{parentNode:t?o.one(t):null})),this},_defRenderFn:function(t){this._parentNode=t.parentNode,this.renderer(),this._set(U,P),this._removeLoadingClassNames()},renderer:function(){var t=this;t._renderUI(),t.renderUI(),t._bindUI(),t.bindUI(),t._syncUI(),t.syncUI()},bindUI:M,renderUI:M,syncUI:M,hide:function(){return this.set(h,R)},show:function(){return this.set(h,P)},focus:function(){return this._set(g,P)},blur:function(){return this._set(g,R)},enable:function(){return this.set(_,R)},disable:function(){return this.set(_,P)},_uiSizeCB:function(t){this.get(v).toggleClass(n(l,"expanded"),t)},_renderBox:function(t){var e=this,s=e.get(v),n=e.get(N),i=e.get(T),r=e.DEF_PARENT_NODE,u=i&&i.get(b)||n.get(b)||s.get(b);i&&!i.compareTo(s)&&!s.inDoc(u)&&i.replace(s),!n.compareTo(s.get(C))&&!n.compareTo(s)&&(s.inDoc(u)&&s.replace(n),n.appendChild(s)),t=t||r&&o.one(r),t?t.appendChild(n):n.inDoc(u)||o.one(p).insert(n,0)},_setBB:function(t){return this._setBox(this.get(E),t,this.BOUNDING_TEMPLATE,!0)},_setCB:function(t){return null===this.CONTENT_TEMPLATE?this.get(N):this._setBox(null,t,this.CONTENT_TEMPLATE,!1)},_defaultBB:function(){var t=this.get(T),e=null===this.CONTENT_TEMPLATE;return t&&e?t:null},_defaultCB:function(t){return this.get(T)||null},_setBox:function(e,s,n,i){return s=o.one(s),s||(s=o.create(n),i?this._bbFromTemplate=!0:this._cbFromTemplate=!0),s.get(E)||s.set(E,e||t.guid()),s},_renderUI:function(){this._renderBoxClassNames(),this._renderBox(this._parentNode)},_renderBoxClassNames:function(){var t,e,s=this._getClasses(),i=this.get(N);for(i.addClass(n()),e=s.length-3;e>=0;e--)t=s[e],i.addClass(t.CSS_PREFIX||a(t.NAME.toLowerCase()));this.get(v).addClass(this.getClassName(l))},_removeLoadingClassNames:function(){var t=this.get(N),e=this.get(v),s=this.getClassName(x),i=n(x);t.removeClass(i).removeClass(s),e.removeClass(i).removeClass(s)},_bindUI:function(){this._bindAttrUI(this._UI_ATTRS.BIND),this._bindDOM()},_unbindUI:function(t){this._unbindDOM(t)},_bindDOM:function(){var e=this.get(N).get(b),n=s._hDocFocus;n||(n=s._hDocFocus=e.on("focus",this._onDocFocus,this),n.listeners={count:0}),n.listeners[t.stamp(this,!0)]=!0,n.listeners.count++,z&&(this._hDocMouseDown=e.on("mousedown",this._onDocMouseDown,this))},_unbindDOM:function(e){var n,i=s._hDocFocus,r=t.stamp(this,!0),o=this._hDocMouseDown;i&&(n=i.listeners,n[r]&&(delete n[r],n.count--),0===n.count&&(i.detach(),s._hDocFocus=null)),z&&o&&o.detach()},_syncUI:function(){this._syncAttrUI(this._UI_ATTRS.SYNC)},_uiSetHeight:function(t){this._uiSetDim(m,t),this._uiSizeCB(t!==w&&t!==I)},_uiSetWidth:function(t){this._uiSetDim(f,t)},_uiSetDim:function(t,e){this.get(N).setStyle(t,r.isNumber(e)?e+this.DEF_UNIT:e)},_uiSetVisible:function(t){this.get(N).toggleClass(this.getClassName(d),!t)},_uiSetDisabled:function(t){this.get(N).toggleClass(this.getClassName(_),t)},_uiSetFocused:function(t,e){var s=this.get(N);s.toggleClass(this.getClassName(g),t),e!==i&&(t?s.focus():s.blur())},_uiSetTabIndex:function(t){var e=this.get(N);r.isNumber(t)?e.set(D,t):e.removeAttribute(D)},_onDocMouseDown:function(t){this._domFocus&&this._onDocFocus(t)},_onDocFocus:function(t){var e=s.getByNode(t.target),n=s._active;n&&n!==e&&(n._domFocus=!1,n._set(g,!1,{src:i}),s._active=null),e&&(e._domFocus=!0,e._set(g,!0,{src:i}),s._active=e)},toString:function(){return this.name+"["+this.get(E)+"]"},DEF_UNIT:"px",DEF_PARENT_NODE:null,CONTENT_TEMPLATE:A,BOUNDING_TEMPLATE:A,_guid:function(){return t.guid()},_validTabIndex:function(t){return r.isNumber(t)||r.isNull(t)},_bindAttrUI:function(t){var e,s=t.length;for(e=0;s>e;e++)this.after(t[e]+F,this._setAttrUI)},_syncAttrUI:function(t){var e,s,n=t.length;for(e=0;n>e;e++)s=t[e],this[O+c(s)](this.get(s))},_setAttrUI:function(t){t.target===this&&this[O+c(t.attrName)](t.newVal,t.src)},_strSetter:function(e){return t.merge(this.get(y),e)},getString:function(t){return this.get(y)[t]},getStrings:function(){return this.get(y)},_UI_ATTRS:{BIND:X,SYNC:X}}),t.Widget=s},"3.16.0",{requires:["attribute","base-base","base-pluginhost","classnamemanager","event-focus","node-base","node-style"],skinnable:!0});
;YUI.add("widget-htmlparser",function(e,t){var r=e.Widget,n=e.Node,o=e.Lang,i="srcNode",s="contentBox";r.HTML_PARSER={},r._buildCfg={aggregates:["HTML_PARSER"]},r.ATTRS[i]={value:null,setter:n.one,getter:"_getSrcNode",writeOnce:!0},e.mix(r.prototype,{_getSrcNode:function(e){return e||this.get(s)},_preAddAttrs:function(e,t,r){var n={id:e.id,boundingBox:e.boundingBox,contentBox:e.contentBox,srcNode:e.srcNode};this.addAttrs(n,t,r),delete e.boundingBox,delete e.contentBox,delete e.srcNode,delete e.id,this._applyParser&&this._applyParser(t)},_applyParsedConfig:function(t,r,n){return n?e.mix(r,n,!1):r},_applyParser:function(t){var r,n,i=this,s=this._getNodeToParse(),a=i._getHtmlParser();a&&s&&e.Object.each(a,function(e,t,a){n=null,o.isFunction(e)?n=e.call(i,s):o.isArray(e)?(n=s.all(e[0]),n.isEmpty()&&(n=null)):n=s.one(e),null!==n&&void 0!==n&&(r=r||{},r[t]=n)}),t=i._applyParsedConfig(s,t,r)},_getNodeToParse:function(){var e=this.get("srcNode");return this._cbFromTemplate?null:e},_getHtmlParser:function(){var t,r,n=this._getClasses(),o={};for(t=n.length-1;t>=0;t--)r=n[t].HTML_PARSER,r&&e.mix(o,r,!0);return o}})},"3.16.0",{requires:["widget-base"]});
;YUI.add("widget-skin",function(e,t){var n="boundingBox",a="contentBox",i="skin",s=e.ClassNameManager.getClassName;e.Widget.prototype.getSkinName=function(e){var t,g,r=this.get(a)||this.get(n);return e=e||s(i,""),g=new RegExp("\\b"+e+"(\\S+)"),r&&r.ancestor(function(e){return t=e.get("className").match(g)}),t?t[1]:null}},"3.16.0",{requires:["widget-base"]});
;YUI.add("widget-uievents",function(t,e){var n="boundingBox",i=t.Widget,s="render",r=t.Lang,a=":",u=t.Widget._uievts=t.Widget._uievts||{};t.mix(i.prototype,{_destroyUIEvents:function(){var e=t.stamp(this,!0);t.each(u,function(n,i){n.instances[e]&&(delete n.instances[e],t.Object.isEmpty(n.instances)&&(n.handle.detach(),u[i]&&delete u[i]))})},UI_EVENTS:t.Node.DOM_EVENTS,_getUIEventNode:function(){return this.get(n)},_createUIEvent:function(e){var n,s=this._getUIEventNode(),r=t.stamp(s)+e,a=u[r];a||(n=s.delegate(e,function(t){var e=i.getByNode(this);e&&e._filterUIEvent(t)&&e.fire(t.type,{domEvent:t})},"."+t.Widget.getClassName()),u[r]=a={instances:{},handle:n}),a.instances[t.stamp(this)]=1},_filterUIEvent:function(t){return t.currentTarget.compareTo(t.container)||t.container.compareTo(this._getUIEventNode())},_getUIEvent:function(t){if(r.isString(t)){var e,n,i=this.parseType(t)[1];return i&&(e=i.indexOf(a),e>-1&&(i=i.substring(e+a.length)),this.UI_EVENTS[i]&&(n=i)),n}},_initUIEvent:function(t){var e=this._getUIEvent(t),n=this._uiEvtsInitQueue||{};e&&!n[e]&&(this._uiEvtsInitQueue=n[e]=1,this.after(s,function(){this._createUIEvent(e),delete this._uiEvtsInitQueue[e]}))},on:function(t){return this._initUIEvent(t),i.superclass.on.apply(this,arguments)},publish:function(t,e){var n=this._getUIEvent(t);return n&&e&&e.defaultFn&&this._initUIEvent(n),i.superclass.publish.apply(this,arguments)}},!0)},"3.16.0",{requires:["node-event-delegate","widget-base"]});
;YUI.add("base-build",function(t,e){function r(t,e,r){r[t]&&(e[t]=(e[t]||[]).concat(r[t]))}function n(t,e,n){n._ATTR_CFG&&(e._ATTR_CFG_HASH=null,r.apply(null,arguments))}function i(t,e,r){s.modifyAttrs(e,r.ATTRS)}var u,s=t.BaseCore,a=t.Base,c=t.Lang,o="initializer",l="destructor",g=["_PLUG","_UNPLUG"];a._build=function(e,r,n,i,u,s){var c,g,_,f,m,d,p=a._build,y=p._ctor(r,s),A=p._cfg(r,s,n),C=p._mixCust,T=y._yuibuild.dynamic;for(c=0,g=n.length;g>c;c++)_=n[c],f=_.prototype,m=f[o],d=f[l],delete f[o],delete f[l],t.mix(y,_,!0,null,1),C(y,_,A),m&&(f[o]=m),d&&(f[l]=d),y._yuibuild.exts.push(_);return i&&t.mix(y.prototype,i,!0),u&&(t.mix(y,p._clean(u,A),!0),C(y,u,A)),y.prototype.hasImpl=p._impl,T&&(y.NAME=e,y.prototype.constructor=y,y.modifyAttrs=r.modifyAttrs),y},u=a._build,t.mix(u,{_mixCust:function(e,r,n){var i,u,s,a,o,l;if(n&&(i=n.aggregates,u=n.custom,s=n.statics),s&&t.mix(e,r,!0,s),i)for(l=0,o=i.length;o>l;l++)a=i[l],!e.hasOwnProperty(a)&&r.hasOwnProperty(a)&&(e[a]=c.isArray(r[a])?[]:{}),t.aggregate(e,r,!0,[a]);if(u)for(l in u)u.hasOwnProperty(l)&&u[l](l,e,r)},_tmpl:function(e){function r(){r.superclass.constructor.apply(this,arguments)}return t.extend(r,e),r},_impl:function(t){var e,r,n,i,u,s,a=this._getClasses();for(e=0,r=a.length;r>e;e++)if(n=a[e],n._yuibuild)for(i=n._yuibuild.exts,u=i.length,s=0;u>s;s++)if(i[s]===t)return!0;return!1},_ctor:function(t,e){var r=e&&!1===e.dynamic?!1:!0,n=r?u._tmpl(t):t,i=n._yuibuild;return i||(i=n._yuibuild={}),i.id=i.id||null,i.exts=i.exts||[],i.dynamic=r,n},_cfg:function(e,r,n){for(var i,u,s,a=[],c={},o=[],l=r&&r.aggregates,g=r&&r.custom,_=r&&r.statics,f=e;f&&f.prototype;)i=f._buildCfg,i&&(i.aggregates&&(a=a.concat(i.aggregates)),i.custom&&t.mix(c,i.custom,!0),i.statics&&(o=o.concat(i.statics))),f=f.superclass?f.superclass.constructor:null;if(n)for(u=0,s=n.length;s>u;u++)f=n[u],i=f._buildCfg,i&&(i.aggregates&&(a=a.concat(i.aggregates)),i.custom&&t.mix(c,i.custom,!0),i.statics&&(o=o.concat(i.statics)));return l&&(a=a.concat(l)),g&&t.mix(c,r.cfgBuild,!0),_&&(o=o.concat(_)),{aggregates:a,custom:c,statics:o}},_clean:function(e,r){var n,i,u,s=t.merge(e),a=r.aggregates,c=r.custom;for(n in c)s.hasOwnProperty(n)&&delete s[n];for(i=0,u=a.length;u>i;i++)n=a[i],s.hasOwnProperty(n)&&delete s[n];return s}}),a.build=function(t,e,r,n){return u(t,e,r,null,null,n)},a.create=function(t,e,r,n,i){return u(t,e,r,n,i)},a.mix=function(t,e){return t._CACHED_CLASS_DATA&&(t._CACHED_CLASS_DATA=null),u(null,t,e,null,null,{dynamic:!1})},s._buildCfg={aggregates:g.concat(),custom:{ATTRS:i,_ATTR_CFG:n,_NON_ATTRS_CFG:r}},a._buildCfg={aggregates:g.concat(),custom:{ATTRS:i,_ATTR_CFG:n,_NON_ATTRS_CFG:r}}},"3.16.0",{requires:["base-base"]});
;YUI.add("widget-stdmod",function(t,e){function i(t){}var d=t.Lang,o=t.Node,n=t.UA,s=t.Widget,r="",h="hd",a="bd",l="ft",S="header",f="body",g="footer",u="fillHeight",_="stdmod",M="Node",c="Content",C="firstChild",p="childNodes",E="ownerDocument",v="contentBox",N="height",H="offsetHeight",T="auto",b="headerContentChange",A="bodyContentChange",y="footerContentChange",I="fillHeightChange",P="heightChange",m="contentUpdate",F="renderUI",O="bindUI",R="syncUI",L="_applyParsedConfig",B=t.Widget.UI_SRC;i.HEADER=S,i.BODY=f,i.FOOTER=g,i.AFTER="after",i.BEFORE="before",i.REPLACE="replace";var U=i.HEADER,w=i.BODY,D=i.FOOTER,V=U+c,W=D+c,Y=w+c;i.ATTRS={headerContent:{value:null},footerContent:{value:null},bodyContent:{value:null},fillHeight:{value:i.BODY,validator:function(t){return this._validateFillHeight(t)}}},i.HTML_PARSER={headerContent:function(t){return this._parseStdModHTML(U)},bodyContent:function(t){return this._parseStdModHTML(w)},footerContent:function(t){return this._parseStdModHTML(D)}},i.SECTION_CLASS_NAMES={header:s.getClassName(h),body:s.getClassName(a),footer:s.getClassName(l)},i.TEMPLATES={header:'<div class="'+i.SECTION_CLASS_NAMES[U]+'"></div>',body:'<div class="'+i.SECTION_CLASS_NAMES[w]+'"></div>',footer:'<div class="'+i.SECTION_CLASS_NAMES[D]+'"></div>'},i.prototype={initializer:function(){this._stdModNode=this.get(v),t.before(this._renderUIStdMod,this,F),t.before(this._bindUIStdMod,this,O),t.before(this._syncUIStdMod,this,R)},_syncUIStdMod:function(){var t=this._stdModParsed;(!t||!t[V])&&this._uiSetStdMod(U,this.get(V)),(!t||!t[Y])&&this._uiSetStdMod(w,this.get(Y)),(!t||!t[W])&&this._uiSetStdMod(D,this.get(W)),this._uiSetFillHeight(this.get(u))},_renderUIStdMod:function(){this._stdModNode.addClass(s.getClassName(_)),this._renderStdModSections(),this.after(b,this._afterHeaderChange),this.after(A,this._afterBodyChange),this.after(y,this._afterFooterChange)},_renderStdModSections:function(){d.isValue(this.get(V))&&this._renderStdMod(U),d.isValue(this.get(Y))&&this._renderStdMod(w),d.isValue(this.get(W))&&this._renderStdMod(D)},_bindUIStdMod:function(){this.after(I,this._afterFillHeightChange),this.after(P,this._fillHeight),this.after(m,this._fillHeight)},_afterHeaderChange:function(t){t.src!==B&&this._uiSetStdMod(U,t.newVal,t.stdModPosition)},_afterBodyChange:function(t){t.src!==B&&this._uiSetStdMod(w,t.newVal,t.stdModPosition)},_afterFooterChange:function(t){t.src!==B&&this._uiSetStdMod(D,t.newVal,t.stdModPosition)},_afterFillHeightChange:function(t){this._uiSetFillHeight(t.newVal)},_validateFillHeight:function(t){return!t||t==i.BODY||t==i.HEADER||t==i.FOOTER},_uiSetFillHeight:function(t){var e=this.getStdModNode(t),i=this._currFillNode;i&&e!==i&&i.setStyle(N,r),e&&(this._currFillNode=e),this._fillHeight()},_fillHeight:function(){if(this.get(u)){var t=this.get(N);t!=r&&t!=T&&this.fillHeight(this.getStdModNode(this.get(u)))}},_uiSetStdMod:function(t,e,i){if(d.isValue(e)){var o=this.getStdModNode(t,!0);this._addStdModContent(o,e,i),this.set(t+c,this._getStdModContent(t),{src:B})}else this._eraseStdMod(t);this.fire(m)},_renderStdMod:function(t){var e=this.get(v),i=this._findStdModSection(t);return i||(i=this._getStdModTemplate(t)),this._insertStdModSection(e,t,i),this[t+M]=i,this[t+M]},_eraseStdMod:function(t){var e=this.getStdModNode(t);e&&(e.remove(!0),delete this[t+M])},_insertStdModSection:function(t,e,i){var d=t.get(C);if(e!==D&&d)if(e===U)t.insertBefore(i,d);else{var o=this[D+M];o?t.insertBefore(i,o):t.appendChild(i)}else t.appendChild(i)},_getStdModTemplate:function(t){return o.create(i.TEMPLATES[t],this._stdModNode.get(E))},_addStdModContent:function(t,e,d){switch(d){case i.BEFORE:d=0;break;case i.AFTER:d=void 0;break;default:d=i.REPLACE}t.insert(e,d)},_getPreciseHeight:function(t){var e=t?t.get(H):0,i="getBoundingClientRect";if(t&&t.hasMethod(i)){var d=t.invoke(i);d&&(e=d.bottom-d.top)}return e},_findStdModSection:function(t){return this.get(v).one("> ."+i.SECTION_CLASS_NAMES[t])},_parseStdModHTML:function(e){var i=this._findStdModSection(e);return i?(this._stdModParsed||(this._stdModParsed={},t.before(this._applyStdModParsedConfig,this,L)),this._stdModParsed[e+c]=1,i.get("innerHTML")):null},_applyStdModParsedConfig:function(t,e,i){var d=this._stdModParsed;d&&(d[V]=!(V in e)&&V in d,d[Y]=!(Y in e)&&Y in d,d[W]=!(W in e)&&W in d)},_getStdModContent:function(t){return this[t+M]?this[t+M].get(p):null},setStdModContent:function(t,e,i){this.set(t+c,e,{stdModPosition:i})},getStdModNode:function(t,e){var i=this[t+M]||null;return!i&&e&&(i=this._renderStdMod(t)),i},fillHeight:function(t){if(t){for(var e,i,o=this.get(v),s=[this.headerNode,this.bodyNode,this.footerNode],r=0,h=0,a=!1,l=0,S=s.length;S>l;l++)e=s[l],e&&(e!==t?r+=this._getPreciseHeight(e):a=!0);a&&((n.ie||n.opera)&&t.set(H,0),i=o.get(H)-parseInt(o.getComputedStyle("paddingTop"),10)-parseInt(o.getComputedStyle("paddingBottom"),10)-parseInt(o.getComputedStyle("borderBottomWidth"),10)-parseInt(o.getComputedStyle("borderTopWidth"),10),d.isNumber(i)&&(h=i-r,h>=0&&t.set(H,h)))}}},t.WidgetStdMod=i},"3.16.0",{requires:["base-build","widget"]});
;YUI.add("widget-position",function(t,i){function e(t){}var n=t.Lang,s=t.Widget,o="xy",r="position",u="positioned",a="boundingBox",h="relative",_="renderUI",d="bindUI",c="syncUI",f=s.UI_SRC,g="xyChange";e.ATTRS={x:{setter:function(t){this._setX(t)},getter:function(){return this._getX()},lazyAdd:!1},y:{setter:function(t){this._setY(t)},getter:function(){return this._getY()},lazyAdd:!1},xy:{value:[0,0],validator:function(t){return this._validateXY(t)}}},e.POSITIONED_CLASS_NAME=s.getClassName(u),e.prototype={initializer:function(){this._posNode=this.get(a),t.after(this._renderUIPosition,this,_),t.after(this._syncUIPosition,this,c),t.after(this._bindUIPosition,this,d)},_renderUIPosition:function(){this._posNode.addClass(e.POSITIONED_CLASS_NAME)},_syncUIPosition:function(){var t=this._posNode;t.getStyle(r)===h&&this.syncXY(),this._uiSetXY(this.get(o))},_bindUIPosition:function(){this.after(g,this._afterXYChange)},move:function(){var t=arguments,i=n.isArray(t[0])?t[0]:[t[0],t[1]];this.set(o,i)},syncXY:function(){this.set(o,this._posNode.getXY(),{src:f})},_validateXY:function(t){return n.isArray(t)&&n.isNumber(t[0])&&n.isNumber(t[1])},_setX:function(t){this.set(o,[t,this.get(o)[1]])},_setY:function(t){this.set(o,[this.get(o)[0],t])},_getX:function(){return this.get(o)[0]},_getY:function(){return this.get(o)[1]},_afterXYChange:function(t){t.src!=f&&this._uiSetXY(t.newVal)},_uiSetXY:function(t){this._posNode.setXY(t)}},t.WidgetPosition=e},"3.16.0",{requires:["base-build","node-screen","widget"]});
;YUI.add("widget-position-align",function(t,e){function i(t){}var n=t.Lang,s="align",a="alignOn",o="visible",g="boundingBox",l="offsetWidth",r="offsetHeight",h="region",c="viewportRegion";i.ATTRS={align:{value:null},centered:{setter:"_setAlignCenter",lazyAdd:!1,value:!1},alignOn:{value:[],validator:t.Lang.isArray}},i.TL="tl",i.TR="tr",i.BL="bl",i.BR="br",i.TC="tc",i.RC="rc",i.BC="bc",i.LC="lc",i.CC="cc",i.prototype={initializer:function(){this._posNode||t.error("WidgetPosition needs to be added to the Widget, before WidgetPositionAlign is added"),t.after(this._bindUIPosAlign,this,"bindUI"),t.after(this._syncUIPosAlign,this,"syncUI")},_posAlignUIHandles:null,destructor:function(){this._detachPosAlignUIHandles()},_bindUIPosAlign:function(){this.after("alignChange",this._afterAlignChange),this.after("alignOnChange",this._afterAlignOnChange),this.after("visibleChange",this._syncUIPosAlign)},_syncUIPosAlign:function(){var t=this.get(s);this._uiSetVisiblePosAlign(this.get(o)),t&&this._uiSetAlign(t.node,t.points)},align:function(t,e){return arguments.length?this.set(s,{node:t,points:e}):this._syncUIPosAlign(),this},centered:function(t){return this.align(t,[i.CC,i.CC])},_setAlignCenter:function(t){return t&&this.set(s,{node:t===!0?null:t,points:[i.CC,i.CC]}),t},_uiSetAlign:function(e,s){if(!n.isArray(s)||2!==s.length)return void t.error("align: Invalid Points Arguments");var a,o,g,l=this._getRegion(e);if(l){switch(a=s[0],o=s[1]){case i.TL:g=[l.left,l.top];break;case i.TR:g=[l.right,l.top];break;case i.BL:g=[l.left,l.bottom];break;case i.BR:g=[l.right,l.bottom];break;case i.TC:g=[l.left+Math.floor(l.width/2),l.top];break;case i.BC:g=[l.left+Math.floor(l.width/2),l.bottom];break;case i.LC:g=[l.left,l.top+Math.floor(l.height/2)];break;case i.RC:g=[l.right,l.top+Math.floor(l.height/2)];break;case i.CC:g=[l.left+Math.floor(l.width/2),l.top+Math.floor(l.height/2)]}g&&this._doAlign(a,g[0],g[1])}},_uiSetVisiblePosAlign:function(t){t?this._attachPosAlignUIHandles():this._detachPosAlignUIHandles()},_attachPosAlignUIHandles:function(){if(!this._posAlignUIHandles){var e=this.get(g),i=t.bind(this._syncUIPosAlign,this),n=[];t.Array.each(this.get(a),function(s){var a=s.eventName,o=t.one(s.node)||e;a&&n.push(o.on(a,i))}),this._posAlignUIHandles=n}},_detachPosAlignUIHandles:function(){var e=this._posAlignUIHandles;e&&(new t.EventHandle(e).detach(),this._posAlignUIHandles=null)},_doAlign:function(t,e,n){var s,a=this._posNode;switch(t){case i.TL:s=[e,n];break;case i.TR:s=[e-a.get(l),n];break;case i.BL:s=[e,n-a.get(r)];break;case i.BR:s=[e-a.get(l),n-a.get(r)];break;case i.TC:s=[e-a.get(l)/2,n];break;case i.BC:s=[e-a.get(l)/2,n-a.get(r)];break;case i.LC:s=[e,n-a.get(r)/2];break;case i.RC:s=[e-a.get(l),n-a.get(r)/2];break;case i.CC:s=[e-a.get(l)/2,n-a.get(r)/2]}s&&this.move(s)},_getRegion:function(e){var i;return e?(e=t.Node.one(e),e&&(i=e.get(h))):i=this._posNode.get(c),i},_afterAlignChange:function(t){var e=t.newVal;e&&this._uiSetAlign(e.node,e.points)},_afterAlignOnChange:function(t){this._detachPosAlignUIHandles(),this.get(o)&&this._attachPosAlignUIHandles()}},t.WidgetPositionAlign=i},"3.16.0",{requires:["widget-position"]});
;YUI.add("widget-stack",function(e,t){function i(e){}var s=e.Lang,n=e.UA,h=e.Node,a=e.Widget,d="zIndex",r="shim",_="visible",c="boundingBox",o="renderUI",S="bindUI",f="syncUI",u="offsetWidth",l="offsetHeight",m="parentNode",g="firstChild",k="ownerDocument",I="width",N="height",p="px",C="shimdeferred",H="shimresize",x="visibleChange",A="widthChange",v="heightChange",b="shimChange",z="zIndexChange",U="contentUpdate",y="stacked";i.ATTRS={shim:{value:6==n.ie},zIndex:{value:0,setter:"_setZIndex"}},i.HTML_PARSER={zIndex:function(e){return this._parseZIndex(e)}},i.SHIM_CLASS_NAME=a.getClassName(r),i.STACKED_CLASS_NAME=a.getClassName(y),i.SHIM_TEMPLATE='<iframe class="'+i.SHIM_CLASS_NAME+'" frameborder="0" title="Widget Stacking Shim" src="javascript:false" tabindex="-1" role="presentation"></iframe>',i.prototype={initializer:function(){this._stackNode=this.get(c),this._stackHandles={},e.after(this._renderUIStack,this,o),e.after(this._syncUIStack,this,f),e.after(this._bindUIStack,this,S)},_syncUIStack:function(){this._uiSetShim(this.get(r)),this._uiSetZIndex(this.get(d))},_bindUIStack:function(){this.after(b,this._afterShimChange),this.after(z,this._afterZIndexChange)},_renderUIStack:function(){this._stackNode.addClass(i.STACKED_CLASS_NAME)},_parseZIndex:function(e){var t;return t=e.inDoc()&&"static"!==e.getStyle("position")?e.getComputedStyle("zIndex"):"auto","auto"===t?null:t},_setZIndex:function(e){return s.isString(e)&&(e=parseInt(e,10)),s.isNumber(e)||(e=0),e},_afterShimChange:function(e){this._uiSetShim(e.newVal)},_afterZIndexChange:function(e){this._uiSetZIndex(e.newVal)},_uiSetZIndex:function(e){this._stackNode.setStyle(d,e)},_uiSetShim:function(e){e?(this.get(_)?this._renderShim():this._renderShimDeferred(),6==n.ie&&this._addShimResizeHandlers()):this._destroyShim()},_renderShimDeferred:function(){this._stackHandles[C]=this._stackHandles[C]||[];var e=this._stackHandles[C],t=function(e){e.newVal&&this._renderShim()};e.push(this.on(x,t))},_addShimResizeHandlers:function(){this._stackHandles[H]=this._stackHandles[H]||[];var e=this.sizeShim,t=this._stackHandles[H];t.push(this.after(x,e)),t.push(this.after(A,e)),t.push(this.after(v,e)),t.push(this.after(U,e))},_detachStackHandles:function(e){var t,i=this._stackHandles[e];if(i&&i.length>0)for(;t=i.pop();)t.detach()},_renderShim:function(){var e=this._shimNode,t=this._stackNode;e||(e=this._shimNode=this._getShimTemplate(),t.insertBefore(e,t.get(g)),this._detachStackHandles(C),this.sizeShim())},_destroyShim:function(){this._shimNode&&(this._shimNode.get(m).removeChild(this._shimNode),this._shimNode=null,this._detachStackHandles(C),this._detachStackHandles(H))},sizeShim:function(){var e=this._shimNode,t=this._stackNode;e&&6===n.ie&&this.get(_)&&(e.setStyle(I,t.get(u)+p),e.setStyle(N,t.get(l)+p))},_getShimTemplate:function(){return h.create(i.SHIM_TEMPLATE,this._stackNode.get(k))}},e.WidgetStack=i},"3.16.0",{requires:["base-build","widget"],skinnable:!0});
;YUI.add("widget-position-constrain",function(t,n){function i(t){}var e,o="constrain",s="constrain|xyChange",r="constrainChange",a="preventOverlap",h="align",g="",d="bindUI",l="xy",c="x",_="y",u=t.Node,f="viewportRegion",p="region";i.ATTRS={constrain:{value:null,setter:"_setConstrain"},preventOverlap:{value:!1}},e=i._PREVENT_OVERLAP={x:{tltr:1,blbr:1,brbl:1,trtl:1},y:{trbr:1,tlbl:1,bltl:1,brtr:1}},i.prototype={initializer:function(){this._posNode||t.error("WidgetPosition needs to be added to the Widget, before WidgetPositionConstrain is added"),t.after(this._bindUIPosConstrained,this,d)},getConstrainedXY:function(t,n){n=n||this.get(o);var i=this._getRegion(n===!0?null:n),e=this._posNode.get(p);return[this._constrain(t[0],c,e,i),this._constrain(t[1],_,e,i)]},constrain:function(t,n){var i,e,s=n||this.get(o);s&&(i=t||this.get(l),e=this.getConstrainedXY(i,s),(e[0]!==i[0]||e[1]!==i[1])&&this.set(l,e,{constrained:!0}))},_setConstrain:function(t){return t===!0?t:u.one(t)},_constrain:function(t,n,i,e){if(e){this.get(a)&&(t=this._preventOverlap(t,n,i,e));var o=n==c,s=o?e.width:e.height,r=o?i.width:i.height,h=o?e.left:e.top,g=o?e.right-r:e.bottom-r;(h>t||t>g)&&(s>r?h>t?t=h:t>g&&(t=g):t=h)}return t},_preventOverlap:function(t,n,i,o){var s,r,a,d,l,_,u=this.get(h),f=n===c;return u&&u.points&&e[n][u.points.join(g)]&&(r=this._getRegion(u.node),r&&(s=f?i.width:i.height,a=f?r.left:r.top,d=f?r.right:r.bottom,l=f?r.left-o.left:r.top-o.top,_=f?o.right-r.right:o.bottom-r.bottom),t>a?s>_&&l>s&&(t=a-s):s>l&&_>s&&(t=d)),t},_bindUIPosConstrained:function(){this.after(r,this._afterConstrainChange),this._enableConstraints(this.get(o))},_afterConstrainChange:function(t){this._enableConstraints(t.newVal)},_enableConstraints:function(t){t?(this.constrain(),this._cxyHandle=this._cxyHandle||this.on(s,this._constrainOnXYChange)):this._cxyHandle&&(this._cxyHandle.detach(),this._cxyHandle=null)},_constrainOnXYChange:function(t){t.constrained||(t.newVal=this.getConstrainedXY(t.newVal))},_getRegion:function(t){var n;return t?(t=u.one(t),t&&(n=t.get(p))):n=this._posNode.get(f),n}},t.WidgetPositionConstrain=i},"3.16.0",{requires:["widget-position"]});
;YUI.add("overlay",function(i,t){i.Overlay=i.Base.create("overlay",i.Widget,[i.WidgetStdMod,i.WidgetPosition,i.WidgetStack,i.WidgetPositionAlign,i.WidgetPositionConstrain])},"3.16.0",{requires:["widget","widget-stdmod","widget-position","widget-position-align","widget-stack","widget-position-constrain"],skinnable:!0});
;M.add("mt-dialog",function(e){function t(){var i=arguments[0],n=t._instances[i.id];return i.useAnim?i.useAnim=e.mt.UIUtil.isSupportAnimation().animation&&e.mt.UIUtil.isSupportAnimation().transform:i.useAnim=!1,n instanceof t?(n.setAttrs(i),n):(t._instances[i.id]=this,t.superclass.constructor.apply(this,arguments),this.config=i,this)}var i=e.UA.ie,n=6===i,o=e.Lang.isString,s=e.Lang.isNumber,a=e.mt.util,l=e.mt.macro.key,d={CLOSE:"close",OPEN:"open"};t._instances={},t.NAME="mt-dialog",t.MASK_ID="mt-overlay-mask",t.IFRAME_ID="mt-overlay-iframe",t.UNDERLAY_CLASS="mt-overlay-underlay",t.OVERLAY_CONTAINER_CLASS="mt-overlay-container",t.TITLE_TPL='<h3 class="head">{title}<span class="close">关闭</span></h3><div class="body"><p class="error" style="display:none">&nbsp;</p>{content}</div>',t.NO_TITLE_TPL='<a class="close no-title" hidefocus="true">关闭</a><div class="body"><p class="error" style="display:none">&nbsp;</p>{content}</div>',t.ATTRS={id:{value:null,writeOnce:!0},width:{value:"420px",setter:"_setWidth"},zIndex:{value:102},align:{value:null},centered:{value:!0},modal:{value:!0},autoHide:{value:!1},title:{value:""},content:{value:""},useAnim:{value:!1}};var r={initializer:function(){var e=this;e._timer=null,e._dialog=null,e._scrollHandle=null,e._escHandle=null,e.publish("open",{emitFacade:!0,defaultFn:e._defOpenFn}),e.publish("close",{emitFacade:!0,defaultFn:e._defCloseFn}),e._initDialog(),e._bind()},destructor:function(){var i=this,n=e.one(e.config.doc),o=n.one("#"+t.IFRAME_ID),s=n.one("#"+t.MASK_ID);i._dialog.destroy(),i._escHandle.detach(),i._scrollHandle&&i._scrollHandle.detach(),e.one("#"+i.get("id")).destroy(!0),o&&o.destroy(!0),s&&s.destroy(!0),delete t._instances[i.get("id")]},_initDialog:function(){var t=this,i=t.getAttrs(["width","zIndex","align","centered"]);i.visible=!1,t._dialog=new e.Overlay(i),t._initOverlay()},_bind:function(){var t=this;t.on("widthChange",function(e){this._dialog.set("width",e.newVal),t.resizeUnderlay()}),t.on("titleChange",function(e){t._fillTemplate({title:e.newVal})}),t.on("contentChange",function(e){t._fillTemplate({content:e.newVal})}),t.on("centeredChange",function(e){this._dialog.set("centered",e.newVal)}),t.on("alignChange",function(e){this._dialog.set("align",e.newVal)}),t.on("autoHideChange",function(e){e.newVal&&(t._timer=window.setTimeout(function(){t.close()},1e3*parseInt(e.newVal,10)))}),t._escHandle=e.one("body").on("keydown",function(e){e.keyCode===l.ESC&&t._status===d.OPEN&&t.close()}),e.one("#"+t.get("id")).delegate("click",function(){t.close()},".close")},_fillTemplate:function(i){var n,o,s,a=this;i=i||{},n=i.title||a.get("title"),o=i.content||a.get("content"),(n||o)&&(s=n?e.Lang.sub(t.TITLE_TPL,{title:n,content:o}):e.Lang.sub(t.NO_TITLE_TPL,{content:o}),a._dialog.set("bodyContent",'<div class="mt-dialog">'+s+"</div>"),a.get("centered")&&a.set("centered",!0),a.resizeUnderlay())},_initOverlay:function(){var i,o=this,s=o.get("modal"),a=o.get("zIndex"),l=o.get("id"),d=o._dialog,r=e.one(document.body),c=r.one("#"+t.IFRAME_ID),u=r.one("#"+t.MASK_ID);s&&(n&&!c&&(c=e.Node.create('<iframe id="'+t.IFRAME_ID+'"></iframe>'),r.prepend(c)),u||(u=e.Node.create('<div id="'+t.MASK_ID+'"></div>'),c?c.insert(u,"before"):r.prepend(u)),c&&c.setStyles({width:r.get("docWidth"),height:r.get("docHeight"),zIndex:parseInt(a,10)-2,visibility:"hidden"}),u.setStyles({width:r.get("docWidth"),height:r.get("docHeight"),zIndex:parseInt(a,10)-1,visibility:"hidden"})),i=e.Node.create('<div id="'+l+'" class="'+t.OVERLAY_CONTAINER_CLASS+'"></div>'),c?c.insert(i,"after"):r.prepend(i),d.render(i),o._fillTemplate(),i.one("."+t.UNDERLAY_CLASS)||i.get("firstChild").append('<div class="'+t.UNDERLAY_CLASS+'"></div>')},open:function(){var e=this,t=e.get("id");e.fire("open",{id:t})},_defOpenFn:function(){var i=this,n=i._dialog,o=i.get("centered"),s=i.get("autoHide"),l=e.one(window),r=e.one(document),c=r.one("#"+t.IFRAME_ID),u=r.one("#"+t.MASK_ID),h=i.get("id"),p=r.one("#"+h);c&&c.setStyle("visibility","visible"),u&&u.setStyles({width:r.get("docWidth"),height:r.get("docHeight"),visibility:"visible"}),this.get("useAnim")?setTimeout(function(){n.show(),p.one(".mt-dialog").addClass("anim-popup"),p.one(".mt-overlay-underlay").addClass("anim-popup")},0):n.show(),i._status=d.OPEN,s&&i.set("autoHide",s),o&&(i.set("centered",!0),i._scrollHandle=l.on(["scroll","resize"],a.throttle(function(){i.set("centered",!0)},100)))},close:function(){var e=this,t=e.get("id");e.fire("close",{id:t})},_defCloseFn:function(){var i=this,n=i.get("modal"),o=i.get("centered"),s=i.get("id"),a=i._dialog,l=e.one(document.body),r=l.one("#"+t.MASK_ID),c=l.one("#"+t.IFRAME_ID),u=l.one("#"+s);this.get("useAnim")?u.all(".anim-popup").each(function(t){t.removeClass("anim-popup"),t.addClass("anim-hide-popup"),e.mt.UIUtil.bindAnimEndEvent(t,function(e,t){e.animationName&&"hide-popup"===e.animationName&&(a.hide(),t.removeClass("anim-hide-popup"))})}):a.hide(),i._status=d.CLOSE,n&&(r.setStyle("visibility","hidden"),c&&c.setStyle("visibility","hidden")),o&&i._scrollHandle&&i._scrollHandle.detach(),u&&u.all(".close").each(function(e){e.purge()}),window.clearTimeout(i._timer),i.config.onClose&&i.config.onClose(i)},resizeUnderlay:function(){var o,s,a=this,l=a.get("id");if(n||7===i&&"BackCompat"===document.compatMode){if(o=e.one("#"+l+" ."+t.UNDERLAY_CLASS),!o)return;s=o.ancestor(),o.setStyles({width:parseFloat(s.getComputedStyle("width"))+12+"px",height:parseFloat(s.getComputedStyle("height"))+12+"px"})}},one:function(t){return e.one("#"+this.get("id")).one(t)},all:function(t){return e.one("#"+this.get("id")).all(t)},showError:function(e){this.one(".body > .error").setHTML(e).show()},clearError:function(){this.one(".body > .error").hide()},showResult:function(t,i){var n="350px",o='<div class="result-box result-box--{className} pngfix"><i></i><h5>{title}</h5>{tip}</div>{extra}',s='<div class="result-box result-box--{className} result-box--alert pngfix"><table class="alert-table"><tr><td width="35"><i class="alert-icon"></i></td><td><div class="alert-msg">{tip}</div></td></tr></table></div>',a={tip:{className:"tip",title:"",extra:""},success:{className:"success",title:"操作成功",extra:""},failure:{className:"failure",title:"操作失败",extra:""}};e.mix(t,a[t.type||"success"]),t.tip?t.tip="<p>"+t.tip+"</p>":(t.tip="",t.className+=" no-tip"),this.setAttrs({width:t.width||n,content:e.Lang.sub(i?s:o,t)})},_setWidth:function(e){return o(e)?e:s(e)?e+"px":"420px"}};e.extend(t,e.Base,r),e.mt.Dialog=t},"1.0.0",{requires:["mt-base","overlay","node","base","mt-uiutil"]});
;M.add("www-dialog",function(e){var t=e.io,n=e.Lang.isFunction,i=e.Lang.trim,o=e.Lang.sub,a=e.mt.util,s=a.Cookie,r=e.mt.www,l=r.REG,c=e.mt.Dialog,u=e.mt.FormChecker;e.namespace("mt.www.Dialog"),r.Dialog=e.merge(r.Dialog,{alert:function(t,n){var i,o=e.mt.Dialog,a=o._instances;"string"==typeof t&&(t={tip:t}),t.id="mt-alert-dialog",t.title=n||"",t.type="tip",e.each(a,function(e){"open"===e._status&&(e._needReopen=!0,e.close())}),i=new o(t),i.open(),i.showResult(t,!0),t.autoHide||i.set("autoHide",t.autoHide),t.reload?i.on("close",function(){window.location.reload()}):i.on("close",function(){e.each(a,function(e){e._needReopen&&(e.open(),delete e._needReopen)})})},login:function(t,i){function o(n){var o;i?o=i:n.loginRef&&(o=function(e){e.loginRef&&""!==e.loginRef?location.href=e.loginRef:location.reload()}),window._mbq("eventlog","unitivelogin","getjs","www"),e.Get.js("/account/fetchunitiveloginscript",function(){var i,a,s=window.passport;window._mbq("eventlog","unitivelogin","jsloaded","www"),a={ndContentWrapper:n.ndWrapper.getDOMNode(),extraCallback:o},"meituan.com"!==M.DOMAIN_HOST&&(i=2===M.DEV?"http://www."+M.DOMAIN_HOST:M.DOMAIN_HOST,a=e.merge(a,{env:i})),s.init(a),t.plainQueryString?s.login({plainQueryString:t.plainQueryString}):s.login({service:"www","continue":"http://www."+M.DOMAIN_HOST+"/account/settoken",origin:t.origin})})}function a(){window._gaq&&window._gaq.push(["_trackEvent","Dialog","view",t.galabel])}var r,l,u="wwwlr",d="common-login-dialog",p="unitive-login-iframe";return 1===arguments.length&&n(arguments[0])&&(i=arguments[0],t={}),e.mix(t,{galabel:"common/login",origin:"dialog"}),r=new c({id:d,title:"登录",width:"440px",content:'<div class="J-content-wrapper" style="height:440px"></div>',useAnim:!0}),r.open(),l=e.one("#"+d),l.one("#"+p)||o({ndWrapper:l.one(".J-content-wrapper"),callback:i,loginRef:t.loginRef}),r.setCookie=function(e,t){t=t||s.getExpiresDate(1,0,0),s.set(u,e,t,"/","."+M.DOMAIN_HOST)},t.loginRef&&r.setCookie(t.loginRef,t.expiresDate),a(),r},Email:{_ID:"email-bind-dialog",tips:{type:"请填写邮箱地址",empty:"请填写邮箱地址",error:"邮箱格式错误，请重新输入"},bind:function(n,i){function o(){function e(e){var t;e.status?(p.after("close",function(){window.location.reload()}),f.activate(e.email,e.url)):(t="captcha"===e.errortype?o.get("fields").captcha:o.get("fields").email,o.setErrorTip(t,e.msg),g.refresh(l))}var o,l=p.one("form"),c=a.field(l,"email"),d=a.field(l,"captcha");g.bindRefreshEvent(l),o=new u({form:l,fields:{email:{node:c,validateFn:s,typeTip:w.type},captcha:{node:d,validateFn:g.check,typeTip:g.tips.type}},tipClass:u.CLASS_BLOCK_TIP}),l.on("submit",function(o){o.halt();var s;s=n?"/account/bindemail/modify"+(i?"/verified":""):"/account/bindemail",t(s,{method:"POST",form:{id:l},on:{success:function(t,n){var i=a.getEvalRes(n);e(i)},failure:function(){var e={type:"failure",tip:"请求失败，请稍候重试",autoHide:3,reload:!0};r.Dialog.showResult(p,e)}}})})}function s(e){var t=e.get("value");return""===t?w.empty:l.email.test(t)?!1:w.error}var d=e.one("#email-bind-dialog-markup");if(d){var p,f=this,w=f.tips,g=r.Dialog.Captcha;p=new c({id:f._ID,width:"470px",title:"绑定邮箱",content:d.getHTML()}),p.open(),o()}},activate:function(t,n){var i=e.one("#email-activate-dialog-markup");if(i){var a,s=this;a=new c({id:s._ID,width:"470px",title:"绑定邮箱",content:o(i.getHTML(),{email:t,url:n})}),a.open()}}},Password:{tips:{thesamepwd:"当前密码和新密码一致，请重新输入",currentpwd:"请输入当前密码",emptypwd:"请输入新密码",whitespace:"密码中不能包含空格",password:"建议使用与您其它账户不同的密码",emptypwd2:"请再次输入新密码",password2:"请再次输入密码以确认",notequal:"密码不一致，请重新输入"},set:function(e){this._set(e)},reset:function(e){this._set(e,!0)},_set:function(n,i){function s(){function o(e){g.setHTML(e).show(),r.disableButton(w,!1)}l=v.one("form"),d=a.field(l,"currentpassword"),p=a.field(l,"password"),f=a.field(l,"password2"),w=a.field(l,"commit"),g=l.one(".error"),e.use("www-passwordstrength",function(){p.on("keyup",function(){r.PasswordStrength.check(p.get("value"))})}),m=new u({form:l,fields:{},tipClass:u.CLASS_BLOCK_TIP,async:!0}),i&&m.addField("currentPassword",{node:d,validateFn:b.getCheckMethod(m,0)}),m.addFields({password:{node:p,validateFn:b.getCheckMethod(m,1),typeTip:b.tips.password},password2:{node:f,validateFn:b.getCheckMethod(m,2)}}),m.on("submitSuccess",function(e){e.halt(),r.disableButton(w),h&&h.isInProgress()||(h=t(l.get("action"),{method:"POST",form:{id:l},on:{success:function(e,t){var i,s=a.getEvalRes(t);s.status?(i={type:"success",title:"设置成功！"},s.growth&&s.growth>0&&(i.tip='您已获得<span class="growth-dialog-focus">'+parseInt(s.growth,10)+"个成长值</span>"),v.showResult(i),v.on("close",function(){n.reload?window.location.reload():s.redirect&&(window.location.href=s.redirect)}),v.set("autoHide",3)):o(s.msg)},failure:function(){o("网络故障，请稍后重试")}}}))})}var l,d,p,f,w,g,m,h,v=null,b=this,y=e.one("#J-set-password-dialog-markup"),k={tip:"",currentPasswordField:"",mobileField:""},T="set-password-dialog",M='<div class="field-group"><label>当前密码</label><input type="password" name="currentpassword" id="current-password" class="f-text" autocomplete="off" /></div>',D='<div class="field-group"><label class="text">手机号</label>{mobile}</div>';n=n||{},e.mix(k,n,!0,["tip"]),i?(k.action="/account/settings",k.currentPasswordField=M):(k.action="/account/addpassword",n.mobile&&(k.mobileField=o(D,{mobile:n.mobile}))),v=new c({id:T,width:"400px",title:"设置密码",content:o(y.getHTML(),k)}),v.open(),s()},getCheckMethod:function(e,t){function n(e,t){var n=t||"",i=/\s/,a=/^[\x21-\x7e]{6,32}$/i;switch(n){case"current":if(""===e)return o.currentpwd;break;case"password":if(""===e)return o.emptypwd;if(i.test(e))return o.whitespace;if(!a.test(e))return o.password;break;case"password2":if(""===e)return o.emptypwd2}return!1}var i=e.get("fields"),o=this.tips;switch(t){case 0:return function(e){return n(e.get("value"),"current")};case 1:return function(t){var a,s,r,l=t.get("value");return r=n(l,"password"),r!==!1?r:i.currentPassword&&(a=i.currentPassword.node.get("value"),a===l)?o.thesamepwd:(s=i.password2.node.get("value"),s&&n(s,"password2")===!1&&e.checkField(i.password2),!1)};case 2:return function(e){var t,a,s=e.get("value");return a=n(s,"password2"),a!==!1?a:(t=i.password.node.get("value"),t!==s?o.notequal:!1)};default:return function(){return!1}}}},Mobile:{bind:function(t,n){var i,o=null,a="mobile-bind-dialog";if(!t){if(i=e.one("#mobile-bind-dialog-markup"),!i)return;t=i.getHTML()}o=new c({id:a,width:"450px",title:"绑定手机号码",content:t}),o.open(),n?this.initSmsUpBind(o.one("form"),{dialog:o}):this.initBinder(o)},initBinder:function(e){function n(e){var t=i(e.get("value"));return""===t?"手机号不能为空":l.mobile.test(t)?!1:"请输入正确的11位手机号"}function o(e){return""===e?"图片验证码不能为空":4!==e.length?"请填入正确的图片验证码":!1}function s(e){var t=i(e.get("value"));return""===t?"动态码不能为空":!1}function c(e){return e?(e='<i class="tip-status tip-status--opinfo"></i>'+e,void T.setHTML(e).show()):void T.setHTML("").hide()}function d(){function e(i){g&&g.isInProgress()||(g=t("/account/bindsendnew",{method:"POST",data:a.toPostData(i),on:{success:function(t,o){var l=a.getEvalRes(o);l.data&&l.data.needconfirm?window.confirm(l.msg)&&(i.confirm=!0,e(i)):l.status?(r.disableButton(v,!1),r.disableButton(M,!1),n()):s(l,i.mobileNum)},failure:function(){c("网络有问题，请稍后重试。")}}}))}function n(){var e,t=60;C=!0,c(!1),D&&(y.hide(),D=!1),r.disableButton(b),e=window.setInterval(function(){t-=1,t?b.set("value","已发送，"+t+"秒后可重新获取"):(window.clearInterval(e),b.set("value","重新获取"),r.disableButton(b,!1))},1e3)}function s(e,t){if(c(e.msg),C=!1,e.errType)switch(e.errType){case 2:S=t,y.hide(),r.disableButton(b);break;case 3:D=!0,w.update(),y.show(),k.focus()}}var l,d,p,f=H.get("fields").mobile;b.on("click",function(){if(H.checkField(f),f.status===u.STATUS_OK){if(d=i(h.get("value")),p=i(k.get("value")),!D)return void e({mobile:d});l=o(p),l?(y.addClass("form-field--error"),c(l)):e({mobile:d,captcha:p})}})}function p(t){e.after("close",function(){window.location.reload()});var n={};n.type="success",n.tip=t.msg,t.growth&&t.growth>0&&(n.tip='您已获得<span class="growth-dialog-focus">'+parseInt(t.growth,10)+"个成长值</span>"),n.autoHide=2,r.Dialog.showResult(e,n)}function f(e){c(e.msg),1===e.errType&&(r.disableButton(v),r.disableButton(M)),M.set("value","登录")}var w,g,m=e.one("form"),h=a.field(m,"mobile"),v=a.field(m,"verifycode"),b=m.one("#mobile-verify"),y=m.one(".form-field--captcha"),k=a.field(m,"captcha"),T=m.one("#validate-info"),M=m.one("#J-bind-btn"),D=!1,S="",C=!1,H=new u({form:m,fields:{mobile:{node:h,validateFn:n,typeTip:""},verifyCode:{node:v,validateFn:s,typeTip:""}},tipClass:u.CLASS_INLINE_TIP,checkEvent:"blur",showOkTip:!1,async:!0});w=r.refreshCaptcha(m,!0,"captcha"),h.on("keyup",function(){var e=i(h.get("value"));""!==S&&11===e.length&&S!==e&&(D=!1,y.hide(),c(!1),b.set("value","获取动态码"),r.disableButton(b,!1))}),d(),H.on("submitSuccess",function(e){return e.halt(),C?void(g&&g.isInProgress()||(M.set("value","登录中..."),g=t(m.get("action"),{method:"POST",form:{id:m},on:{success:function(e,t){var n=a.getEvalRes(t);n.status?p(n):f(n)},failure:function(){c("网络有问题，请稍后重试。")}}}))):void c("请先获取手机动态码")})},initSmsUpBind:function(n,i){function o(t,n){var o=a.getEvalRes(n),l=e.one("#J-upstream-sms-content"),c=e.one("#J-upstream-sms-receiver");o.status?(h.hide(),v.show(),m.setHTML(o.maskmobile),l.setHTML(o.verifycode),c.setHTML(o.damobile),e.mt.www.Dialog.Mobile.initSmsUpChecker(b,e.merge({successFn:s,failFn:r,failMsg:"您发送的短信暂时无法收到，建议您咨询客服解决",type:"绑定"},i))):y({tip:o.msg,reload:!0})}function s(e){k=w;var t="绑定成功";e.growth&&e.growth>0&&(t='您已获得<span class="growth-dialog-focus">'+parseInt(e.growth,10)+"个成长值</span>"),y({tip:t,reload:!0,autoHide:5})}function r(){k=f}function l(){var e=c.get("value");return""===e?"请输入手机号":/^\d{11}$/.test(e)?(k=p,!1):"请输入正确的11位手机号码"}var c=e.one("#J-smsup-bind-input");if(c){var u,d=1,p=2,f=3,w=4,g=e.one("#J-smsup-bind-next"),m=e.one("#J-smsup-bind-mask"),h=e.one("#J-smsup-bind-step1"),v=e.one("#J-smsup-bind-step2"),b=e.one("#J-smsup-bind-check"),y="undefined"!=typeof e.mt.www.Dialog.alert?e.mt.www.Dialog.alert:window.alert,k=d;i=i||{},n&&n.on("submit",function(e){switch(l(),k){case w:return!0;case d:y("请输入正确的手机号");break;case f:case p:y("您尚未完成手机号码绑定")}return e.halt(),!1}),g.on("click",function(e){if(e.halt(),!u||!u.isInProgress()){var n=l();return n?y(n):void(u=t(g.getData("action"),{method:"POST",data:a.toPostData({mobile:c.get("value")}),on:{success:o}}))}})}},initSmsUpRebind:function(n,i){function o(t,n){var o=a.getEvalRes(n),l=e.one("#J-upstream-sms-content"),c=e.one("#J-upstream-sms-receiver");o.status?(v.hide(),b.show(),h.setHTML(o.maskmobile),l.setHTML(o.verifycode),c.setHTML(o.damobile),e.mt.www.Dialog.Mobile.initSmsUpChecker(y,e.merge({successFn:s,failFn:r,failMsg:"您发送的短信暂时无法收到，建议您咨询客服解决",type:"绑定"},i))):k({tip:o.msg,reload:!0})}function s(e){T=g;var t="绑定成功";e.growth&&e.growth>0&&(t='您已获得<span class="growth-dialog-focus">'+parseInt(e.growth,10)+"个成长值</span>"),k({tip:t,reload:!0,autoHide:5})}function r(){T=w}function l(){var e=c.get("value"),t=u.get("value");return""===t?"请输入原手机号":""===e?"请输入新手机号":/^\d{11}$/.test(e)&&/^\d{11}$/.test(t)?t===e?"新手机号不能和原手机号相同":(T=f,!1):"请输入正确的11位手机号码"}var c=e.one("#J-smsup-bind-input"),u=e.one("#J-smsup-bind-input-old");if(c&&u){var d,p=1,f=2,w=3,g=4,m=e.one("#J-smsup-bind-next"),h=e.one("#J-smsup-bind-mask"),v=e.one("#J-smsup-bind-step1"),b=e.one("#J-smsup-bind-step2"),y=e.one("#J-smsup-bind-check"),k="undefined"!=typeof e.mt.www.Dialog.alert?e.mt.www.Dialog.alert:window.alert,T=p;i=i||{},n&&n.on("submit",function(e){switch(l(),T){case g:return!0;case p:k("请输入正确的手机号");break;case w:case f:k("您尚未完成手机号码绑定")}return e.halt(),!1}),m.on("click",function(e){if(e.halt(),!d||!d.isInProgress()){var n=l();return n?k(n):void(d=t(m.getData("action"),{method:"POST",data:a.toPostData({mobile:c.get("value"),oldmobile:u.get("value")}),on:{success:o}}))}})}},initSmsUpChecker:function(n,i){function o(){!h&&f?(f%p===0&&r(),n.set("value","系统将在("+f+"秒)内完成"+u)):(window.clearInterval(l),h||r(s)),f-=1}function s(){h||(w(i.failMsg),f=d,n.set("value",u+"失败，请重发短信后再次确认").set("disabled",!1).removeClass(g))}function r(e){c=t(m,{method:"POST",data:a.toPostData(i.data),on:{success:function(t,n){var o=a.getEvalRes(n);o.status=parseInt(o.status,10),0===o.status?(h=!0,i.successFn&&i.successFn(o)):1===o.status?w({tip:o.msg,reload:!0}):(h=!1,i.failFn&&i.failFn(o)),e&&e(o)},failure:function(){w("网络异常，请重试"),n.set("disabled",!1).removeClass(g)}}})}if(n=e.one(n)){var l,c,u,d=60,p=10,f=d,w="undefined"!=typeof e.mt.www.Dialog.alert?e.mt.www.Dialog.alert:window.alert,g="btn-disabled",m=n.getData("action"),h=!1,v={successFn:function(){},failFn:function(){},type:"注册",failMsg:""};i=e.merge(v,i),u=i.type,n.on("click",function(){n.addClass(g).set("disabled",!0).set("value","系统将在("+f+")内完成"+u),o(),l=window.setInterval(o,1e3)}),i.dialog&&i.dialog.on&&i.dialog.on("close",function(){l&&window.clearInterval(l)})}},_performVerify:function(e){if(e.ndForm){var n=e.config||{},i=e.ndForm.one('input[type="submit"]'),o=e.ndVerifyMsg||null,s="error";r.disableButton(i,!0),o&&(o.removeClass(s),o.setHTML("")),t(e.ndForm.get("action"),{method:"POST",form:{id:e.ndForm},on:{success:function(t,l){var c,u=a.getEvalRes(l);u.status?e.callback?e.callback(u):(n.type=u.status?"success":"failure",c=u.msg,u.growth&&u.growth>0&&(c='您已获得<span class="growth-dialog-focus">'+parseInt(u.growth,10)+"个成长值</span>"),n.tip=c,n.autoHide=2,r.Dialog.showResult(e.dialog,n)):(r.disableButton(i,!1),o?(o.addClass(s),o.setHTML(u.msg)):r.Dialog.alert(u.msg))},failure:function(){r.disableButton(i,!1)}}})}},_check:function(e){return/^\d{11}$/.test(e.get("value"))?!1:"请输入正确的11位手机号码"}},Captcha:{tips:{type:"请输入图片中的字符，不区分大小写",empty:"请输入验证码",error:"验证码输入错误，请重新输入"},bindRefreshEvent:function(e){if(e){var t=e.one(".captcha-refresh"),n=e.one(".signup-captcha-img"),i=this;t&&n&&e.delegate("click",function(t){t.halt(),i.refresh(e)},".signup-captcha-img, .captcha-refresh")}},refresh:function(e){var t=e.one(".signup-captcha-img"),n=t.getAttribute("src").replace(/(\?0\.\d+)?$/,"");t.setAttribute("src",n+"?"+Math.random())},check:function(e){var t=e.get("value"),n=r.Dialog.Captcha.tips;return""===t?n.empty:4!==t.length?n.error:!1}},showResult:function(e,t){t=t||{},t.title||(t.title="success"===t.type?"操作成功":"操作失败"),e.showResult(t),void 0!==t.autoHide&&e.set("autoHide",t.autoHide),t.reload&&e.after("close",function(){window.location.reload()}),t.onClose&&e.after("close",function(){t.onClose(e)})},createResultDialog:function(e,t,n){n=n||"MT_SHOW_RESULT_DIALOG";var i=new c({id:n,title:t||""});i.open(),this.showResult(i,e)}})},"1.0.0",{requires:["www-base","mt-formchecker","mt-dialog"]});
;YUI.add("transition",function(t,n){var e,i,o,r,s,a,u="",d="",l=t.config.doc,_="documentElement",f=l[_].style,p="transition",c="transitionProperty",h={},y=["Webkit","Moz"],g={Webkit:"webkitTransitionEnd"},v=function(){this.init.apply(this,arguments)};v._TRANSFORM="transform",v._toCamel=function(t){return t=t.replace(/-([a-z])/gi,function(t,n){return n.toUpperCase()})},v._toHyphen=function(t){return t=t.replace(/([A-Z]?)([a-z]+)([A-Z]?)/g,function(t,n,e,i){var o=(n?"-"+n.toLowerCase():"")+e;return i&&(o+="-"+i.toLowerCase()),o})},v.SHOW_TRANSITION="fadeIn",v.HIDE_TRANSITION="fadeOut",v.useNative=!1,"transition"in f&&"transitionProperty"in f&&"transitionDuration"in f&&"transitionTimingFunction"in f&&"transitionDelay"in f?(v.useNative=!0,v.supported=!0):t.Array.each(y,function(t){var n=t+"Transition";n in l[_].style&&(u=t,d=v._toHyphen(t)+"-",v.useNative=!0,v.supported=!0,v._VENDOR_PREFIX=t)}),"undefined"==typeof f.transform&&t.Array.each(y,function(t){var n=t+"Transform";"undefined"!=typeof f[n]&&(v._TRANSFORM=n)}),u&&(p=u+"Transition",c=u+"TransitionProperty"),e=d+"transition-property",i=d+"transition-duration",o=d+"transition-timing-function",r=d+"transition-delay",s="transitionend",a="on"+u.toLowerCase()+"transitionend",s=g[u]||s,v.fx={},v.toggles={},v._hasEnd={},v._reKeywords=/^(?:node|duration|iterations|easing|delay|on|onstart|onend)$/i,t.Node.DOM_EVENTS[s]=1,v.NAME="transition",v.DEFAULT_EASING="ease",v.DEFAULT_DURATION=.5,v.DEFAULT_DELAY=0,v._nodeAttrs={},v.prototype={constructor:v,init:function(t,n){var e=this;return e._node=t,!e._running&&n&&(e._config=n,t._transition=e,e._duration="duration"in n?n.duration:e.constructor.DEFAULT_DURATION,e._delay="delay"in n?n.delay:e.constructor.DEFAULT_DELAY,e._easing=n.easing||e.constructor.DEFAULT_EASING,e._count=0,e._running=!1),e},addProperty:function(n,e){var i,o,r,s,a,u=this,d=this._node,l=t.stamp(d),_=t.one(d),f=v._nodeAttrs[l];f||(f=v._nodeAttrs[l]={}),s=f[n],e&&void 0!==e.value?a=e.value:void 0!==e&&(a=e,e=h),"function"==typeof a&&(a=a.call(_,_)),s&&s.transition&&s.transition!==u&&s.transition._count--,u._count++,r=("undefined"!=typeof e.duration?e.duration:u._duration)||1e-4,f[n]={value:a,duration:r,delay:"undefined"!=typeof e.delay?e.delay:u._delay,easing:e.easing||u._easing,transition:u},i=t.DOM.getComputedStyle(d,n),o="string"==typeof a?i:parseFloat(i),v.useNative&&o===a&&setTimeout(function(){u._onNativeEnd.call(d,{propertyName:n,elapsedTime:r})},1e3*r)},removeProperty:function(n){var e=this,i=v._nodeAttrs[t.stamp(e._node)];i&&i[n]&&(delete i[n],e._count--)},initAttrs:function(n){var e,i=this._node;n.transform&&!n[v._TRANSFORM]&&(n[v._TRANSFORM]=n.transform,delete n.transform);for(e in n)n.hasOwnProperty(e)&&!v._reKeywords.test(e)&&(this.addProperty(e,n[e]),""===i.style[e]&&t.DOM.setStyle(i,e,t.DOM.getComputedStyle(i,e)))},run:function(n){var e=this,i=e._node,o=e._config,r={type:"transition:start",config:o};return e._running||(e._running=!0,o.on&&o.on.start&&o.on.start.call(t.one(i),r),e.initAttrs(e._config),e._callback=n,e._start()),e},_start:function(){this._runNative()},_prepDur:function(t){return t=1e3*parseFloat(t),t+"ms"},_runNative:function(){var n,a,u,d=this,l=d._node,_=t.stamp(l),f=l.style,p=l.ownerDocument.defaultView.getComputedStyle(l),c=v._nodeAttrs[_],h="",y=p[v._toCamel(e)],g=e+": ",m=i+": ",N=o+": ",T=r+": ";"all"!==y&&(g+=y+",",m+=p[v._toCamel(i)]+",",N+=p[v._toCamel(o)]+",",T+=p[v._toCamel(r)]+",");for(u in c)n=v._toHyphen(u),a=c[u],(a=c[u])&&a.transition===d&&(u in l.style?(m+=d._prepDur(a.duration)+",",T+=d._prepDur(a.delay)+",",N+=a.easing+",",g+=n+",",h+=n+": "+a.value+"; "):this.removeProperty(u));g=g.replace(/,$/,";"),m=m.replace(/,$/,";"),N=N.replace(/,$/,";"),T=T.replace(/,$/,";"),v._hasEnd[_]||(l.addEventListener(s,d._onNativeEnd,""),v._hasEnd[_]=!0),f.cssText+=g+m+N+T+h},_end:function(n){var e=this,i=e._node,o=e._callback,r=e._config,s={type:"transition:end",config:r,elapsedTime:n},a=t.one(i);e._running=!1,e._callback=null,i&&(r.on&&r.on.end?setTimeout(function(){r.on.end.call(a,s),o&&o.call(a,s)},1):o&&setTimeout(function(){o.call(a,s)},1))},_endNative:function(t){var n=this._node,i=n.ownerDocument.defaultView.getComputedStyle(n,"")[v._toCamel(e)];t=v._toHyphen(t),"string"==typeof i&&(i=i.replace(new RegExp("(?:^|,\\s)"+t+",?"),","),i=i.replace(/^,|,$/,""),n.style[p]=i)},_onNativeEnd:function(n){var e,i,o=this,r=t.stamp(o),s=n,a=v._toCamel(s.propertyName),u=s.elapsedTime,d=v._nodeAttrs[r],l=d[a],_=l?l.transition:null;_&&(_.removeProperty(a),_._endNative(a),i=_._config[a],e={type:"propertyEnd",propertyName:a,elapsedTime:u,config:i},i&&i.on&&i.on.end&&i.on.end.call(t.one(o),e),_._count<=0&&(_._end(u),o.style[c]=""))},destroy:function(){var t=this,n=t._node;n&&(n.removeEventListener(s,t._onNativeEnd,!1),t._node=null)}},t.Transition=v,t.TransitionNative=v,t.Node.prototype.transition=function(n,e,i){var o,r,s=v._nodeAttrs[t.stamp(this._node)],a=s?s.transition||null:null;if("string"==typeof n)if("function"==typeof e&&(i=e,e=null),o=v.fx[n],e&&"object"==typeof e){e=t.clone(e);for(r in o)o.hasOwnProperty(r)&&(r in e||(e[r]=o[r]))}else e=o;else i=e,e=n;return a&&!a._running?a.init(this,e):a=new v(this._node,e),a.run(i),this},t.Node.prototype.show=function(n,e,i){return this._show(),n&&t.Transition&&("string"!=typeof n&&!n.push&&("function"==typeof e&&(i=e,e=n),n=v.SHOW_TRANSITION),this.transition(n,e,i)),this},t.NodeList.prototype.show=function(n,e,i){for(var o,r=this._nodes,s=0;o=r[s++];)t.one(o).show(n,e,i);return this};var m=function(t,n,e){return function(){n&&n.call(t),e&&"function"==typeof e&&e.apply(t._node,arguments)}};t.Node.prototype.hide=function(n,e,i){return n&&t.Transition?("function"==typeof e&&(i=e,e=null),i=m(this,this._hide,i),"string"!=typeof n&&!n.push&&("function"==typeof e&&(i=e,e=n),n=v.HIDE_TRANSITION),this.transition(n,e,i)):this._hide(),this},t.NodeList.prototype.hide=function(n,e,i){for(var o,r=this._nodes,s=0;o=r[s++];)t.one(o).hide(n,e,i);return this},t.NodeList.prototype.transition=function(n,e,i){for(var o,r=this._nodes,s=this.size(),a=0,i=i===!0;o=r[a++];)s>a&&i?t.one(o).transition(n):t.one(o).transition(n,e);return this},t.Node.prototype.toggleView=function(n,e,i){return this._toggles=this._toggles||[],i=arguments[arguments.length-1],"string"!=typeof n?(e=n,void this._toggleView(e,i)):("function"==typeof e&&(e=void 0),"undefined"==typeof e&&n in this._toggles&&(e=!this._toggles[n]),e=e?1:0,e?this._show():i=m(this,this._hide,i),this._toggles[n]=e,this.transition(t.Transition.toggles[n][e],i),this)},t.NodeList.prototype.toggleView=function(n,e,i){for(var o,r=this._nodes,s=0;o=r[s++];)o=t.one(o),o.toggleView.apply(o,arguments);return this},t.mix(v.fx,{fadeOut:{opacity:0,duration:.5,easing:"ease-out"},fadeIn:{opacity:1,duration:.5,easing:"ease-in"},sizeOut:{height:0,width:0,duration:.75,easing:"ease-out"},sizeIn:{height:function(t){return t.get("scrollHeight")+"px"},width:function(t){return t.get("scrollWidth")+"px"},duration:.5,easing:"ease-in",on:{start:function(){var t=this.getStyle("overflow");"hidden"!==t&&(this.setStyle("overflow","hidden"),this._transitionOverflow=t)},end:function(){this._transitionOverflow&&(this.setStyle("overflow",this._transitionOverflow),delete this._transitionOverflow)}}}}),t.mix(v.toggles,{size:["sizeOut","sizeIn"],fade:["fadeOut","fadeIn"]})},"3.16.0",{requires:["node-style"]});
;M.add("mt-form",function(e){e.namespace("mt.form");var t=e.mt.util,n=e.Lang.isString,i=e.mt.lang,r=e.Lang.trim,a=e.Lang.isNumber,o=e.Lang.isArray,s=e.Lang.isObject,c=e.Object.isEmpty,u=e.mt.macro,l=encodeURIComponent,f=e.io,d={_setValue:function(e,t,n){var i=e.all(t),a=this;n=r(n),i.each(function(e){var t=e.get("type"),i=e.get("value");switch(t){case"select-one":a._setSelectValue(e,n);break;case"radio":case"checkbox":a._matchValue(i,n)&&e.set("checked","checked");break;default:e.set("value",n)}})},_getValue:function(t,n,i){var a,o=t.all(n),s=[],c=this;return o.each(function(e){var t=e.get("type");if(c._checkType(t))switch(t){case"select-one":a=e.get("value"),s.push(a);break;case"select-multiple":e.get("options").each(function(e){e.get("selected")&&(a=e.get("value")||e.get("text"),s.push(a))});break;case"radio":case"checkbox":e.get("checked")&&(a=e.get("value"),s.push(a));break;default:a=e.get("value"),void 0!==a&&s.push(a)}}),e.Array.each(s,function(e,t){e=r(e),i&&(s[t]=l(e))}),s},_field:function(e,t,n){var i,r,a;if(this._checkValue(n))return this._setValue(e,t,n);if((i=e.one(t))&&(r=i.get("type"),this._checkType(r)))switch(a=this._getValue(e,t),r){case"select-multiple":case"checkbox":return a;default:if(0===a.length)return;return 1===a.length?a[0]:a}},_matchValue:function(e,t,n){return n=n||",",o(t)||(t=t.toString().split(n)),i.inArray(e,t,!1)},_setSelectValue:function(e,t){var n=!1,i=this;return e.get("options").some(function(e){return i._matchValue(e.get("value"),t)?(e.set("selected","selected"),n=!0,!0):void 0}),n},_getFieldsByNames:function(t,i){var r=[];return i?(o(i)?e.Array.each(i,function(e){r.push('[name="'+e+'"]')}):n(i)&&r.push('[name="'+i+'"]'),t.all(r.join(","))):null},_checkValue:function(e){return"undefined"!==e&&(o(e)||n(e)||a(e))},_checkType:function(e){switch(e){case"file":case void 0:case"reset":case"button":return!1;default:return!0}}};e.mt.form={toObject:function(t,n,i,r,a,o){t=e.one(t),i!==!1&&(i=!0);var s=d._getFieldsByNames(t,n);return this._serialize(t,s,o,i,r,a).formObj},toString:function(t,n,i,r,a){t=e.one(t);var o=d._getFieldsByNames(t,n);return this._serialize(t,o,a,i,r).formStr},toJSON:function(t,n,i,r){if(t=e.one(t)){"undefined"==typeof i&&(i=!1),"undefined"==typeof r&&(r=",");var a=this._serialize(t,null,n,i).formObj,s={},c=this;return e.Object.each(a,function(e,t){r&&o(e)&&(e=e.join(r)),c._parseArr(s,t,e)}),s}},field:function(t,n,i){if(t=e.one(t)){var r='[name="'+n+'"]';return d._field(t,r,i)}},fieldBySeletor:function(t,n,i){return(t=e.one(t))?d._field(t,n,i):void 0},setOptions:function(t,n,i,r){var a=r?r.one(t):e.one(t),s=this,u=n.data;if(a){a.empty();var l=e.Node.getDOMNode(a).options;if(i&&l.add(this._buildOption("",i)),o(u)){var f=n.key||n.keyField||"keyField",d=n.value||n.valueField||"valueField";e.Array.each(u,function(e){l.add(s._buildOption(e[f],e[d]))})}else if(!c(u))for(var h in u)u.hasOwnProperty(h)&&l.add(this._buildOption(h,u[h]))}},_buildOption:function(e,t){return new Option(t,e)},getCheckedBoxesAttr:function(t,n,i){n=n||"value",t=t||"input[type=checkbox]";var r=i?e.one(i).all(t):e.all(t),a=[];return r.each(function(e){"checkbox"===e.get("type")&&e.get("checked")&&a.push(e.get(n)||e.getAttribute(n))}),a},getRadioAttr:function(t,n,i){n=n||"value",t=t||'input[type="radio"]';var a=i?e.one(i).all(t):e.all(t),o="";return a.some(function(e){return"radio"===e.get("type")&&e.get("checked")?(o=r(e.get(n))||e.getAttribute(n),!0):void 0}),o},getOptionsText:function(e,t){if(!e)return null;var n=e.all('select[name="'+t+'"]');if(0===n.size())return null;var i=[];return n.each(function(e){e.get("options").some(function(e){return e.get("selected")?(i.push(e.getHTML()||""),!0):void 0})}),1===i.length?i[0]:i},toggleCheckbox:function(t,n,i){t=e.one(t),t&&t.on("click",function(){var r=i?e.one(i).all(n):e.all(n);t.get("checked")?r.set("checked","checked"):r.set("checked",!1)})},stopEnterSubmit:function(e){e.delegate("keydown",function(e){e.keyCode===u.key.ENTER&&e.halt()},"input[type]")},multiAction:function(t,n){function i(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];t.push(i.selector)}return t.join(",")}if(t=e.one(t),t&&n&&e.Lang.isArray(n)&&0!==n.length){var r=i(n);t.delegate("click",function(){for(var e=0;e<n.length;e++){var i=n[e];if(this.test(i.selector))return t.set("action",i.action),void(i.callback&&"function"==typeof i.callback&&i.callback(t,this))}},r)}},AjaxForm:function(t,n){var i=this;if(t=e.one(t)){var a=t.get("action")||n.action,o=n.method||t.get("method")||"POST",s=n.buttonPost?e.one(n.buttonPost):t,c=n.buttonPost?"click":"submit",u=n.multiAction;if(!t.test("form"))throw new Error("请保证你所提交的对象是一个form");if(""===r(a))throw new Error("表单提交地址(action)不能为空");if(u){var l=this._getMultiTriggers(u);t.delegate("click",function(e){e.halt(),i.sendRequest2ActionByTrigger(this,n,o,t)},l)}else s.on(c,function(e){e.halt(),n.beforeAjax?n.beforeAjax()&&i.sendRequest(a,o,n,t):i.sendRequest(a,o,n,t)})}},_getMultiTriggers:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t.join(",")},sendRequest2ActionByTrigger:function(e,t,n,i){var r,a=this,o=t.beforeAjaxs,s=t.multiAction;for(var c in s)s.hasOwnProperty(c)&&e.test(c)&&(r=s[c],o&&o[c]?o[c](e)&&a.sendRequest(r,n,t,i):a.sendRequest(r,n,t,i))},sendRequest:function(n,i,r,a){f(n,{method:i,data:e.mt.util.toPostData(r.query||{}),on:{success:function(n,i){var a=t.getEvalRes(i,"权限不够或者网络有问题，请稍后重试。");a.status?r.handleSuccess&&r.handleSuccess(a):r.handleFail?r.handleFail(a):e.config.win.alert(a.msg)},failure:function(){e.config.win.alert("权限不够或者网络有问题，请稍后重试。")}},form:{id:a.get("id")}})},clear:function(t,n,r){if(t=e.one(t)){var a=["hidden","text","number","email","url","search"];t.all("input,select,textarea").each(function(e){var t=e.get("type"),o=e.get("nodeName").toLowerCase();if(i.inArray(t,a)||"textarea"===o){if(r&&e.test(r))return;e.set("value","")}else n||("checkbox"===t||"radio"===t?e.set("checked",!1):"select"===o&&e.set("selectedIndex",-1))})}},reset:function(t){t=e.one(t),t&&"form"===t.get("nodeName").toLowerCase()&&t.reset()},_nestedObject2Flat:function(t){function n(t,n,i){e.Object.each(n,function(e,n){var a=i?i+"."+n:n;r(t,e,a)})}function i(t,n,i){e.Array.each(n,function(e,n){var a=i+"["+n+"]";r(t,e,a)})}function r(e,t,r){o(t)?i(e,t,r):s(t)?n(e,t,r):e[r]=t}if(!s(t))return t;var a={};return n(a,t),a},fillForm:function(t,n){var i=e.one(t);if(!i||!n)return!1;if(!e.Object.isEmpty(n)){n=this._nestedObject2Flat(n);for(var r in n)n.hasOwnProperty(r)&&this.field(i,r,n[r])}return!0},serialize:function(t,n,i,r){return t instanceof e.Node||(t=e.one("#"+t)),this._serialize(t,null,n,i,r).formStr},_serialize:function(t,n,i,r,a,o){r!==!1&&(r=!0),void 0!==a&&e.Lang.isString(a)||(a="&");var s,c,u,l={},f=[],h={};return n=n||t.all("input, select, textarea"),n.each(function(n){if(s=n.get("name"),u='[name="'+s+'"]',(!n.get("disabled")||i)&&s){if(h[s])return;c=d._getValue(t,u,r),0!==c.length&&(o?(c=c.join(o),f.push(s+"="+c)):e.Array.each(c,function(e){f.push(s+"="+e)}),1===c.length&&(c=c[0]),l[s]=c),h[s]=!0}}),{formStr:f.join(a),formObj:l}},disableSubmit:function(t,n,i){var r={},a={"background-color":"#EEE"},o="";if(t=e.one(t),i=i||{},n||e.mix(i,a),n=n?n:"disabled",t){r.className=n,r.styles="",o=e.Node.getDOMNode(t).getAttribute("style"),"string"==typeof o?r.styles=o:r.styles=o=o?o.cssText:"",t.setData("backupStyles",r),t.setAttribute("disabled","disabled"),t.addClass(n);for(var s in i)i.hasOwnProperty(s)&&(o+=";"+s+":"+i[s]);t.removeAttribute("style"),t.setAttribute("style",o),t._node.style.cssText=o}},enableSubmit:function(t){var n=null;t=e.one(t),t&&(t.removeAttribute("disabled"),n=t.getData("backupStyles"),n&&(t.removeClass(n.className),t.removeAttribute("style"),t.setAttribute("style",n.styles),t._node.style.cssText=n.styles))},_execStr:function(e){for(var t,n=/([\w\u4e00-\u9fa5]+)(["']?)(\]?)(\[?)(["']?)/g,i=[];null!==(t=n.exec(e));)i.push(t),t[3]&&(n.lastIndex=n.lastIndex-t[3].length);return i},_parseArr:function(t,n,i){var r=t;n=n.replace(/\.([\w\u4e00-\u9fa5]+)/g,'["$1"]');var a=this._execStr(n);e.Array.each(a,function(e){var t=e[1],n=/^\s*$/;n.test(t)&&(t=0),void 0===r[t]&&(e[4]&&e[5]?r[t]={}:e[4]?r[t]=[]:r[t]=i||""),r=r[t]})}}},"1.0.0",{requires:["mt-base","io-base","node"]});
;M.add("www-order",function(e){var t=e.io,n=e.UA.gecko,o=e.UA.webkit,i=e.Lang.isFunction,a=e.UA.ie,r=e.Lang.trim,c=e.mt.util,s=e.mt.form,l=e.mt.www,d=c.Cookie,u=e.mt.FormChecker,p=e.mt.Dialog,f=l.Dialog,h=0,g=2,m=3,v=5,y=["美团券","物流","优惠码","二维码","抽奖单","二维码"],w={confirmDialog:null,hasRated:!1,orderId:null,callback:null,ndLink:null,url:null,deleteText:null,checkBoxContainer:null,checkBox:null,showDialog:function(e,t,n){var o,i=n.ancestor("form");this.hasRated=e,this.url=i.get("action"),this.orderId=i.getData("orderid"),this.callback=t,this.ndLink=n,this.confirmDialog||(o='<span class="tip-status tip-status--large dialog-tip"></span><div class="dialog-content">   <p class="dialog-content-title">确定删除订单？</p>   <p class="dialog-content-details">删除后本订单将从订单列表消失，且不能恢复<span class="deleteText">，您将不能再进行申请退款等操作</span>。</p>   <div class="dialog-content-checkbox">       <label><input type="checkbox"/>同时删除我的评价（删除评价不会影响积分）</label>   </div>   <div class="dialog-actions">       <a class="btn J-execute-rights">确定</a>       <a class="btn-normal close">取消</a>   </div></div>',this.confirmDialog=new p({id:"order-delete-confirm-dialog",width:"550px",title:"提示",content:o}),this.deleteText=this.confirmDialog.one(".deleteText"),this.checkBoxContainer=this.confirmDialog.one(".dialog-content-checkbox"),this.checkBox=this.checkBoxContainer.one("input")),this.checkBox.set("checked",!1),n.hasClass("order-delete")?this.deleteText.show():this.deleteText.hide(),this.hasRated?this.checkBoxContainer.show():this.checkBoxContainer.hide(),this.confirmDialog.open(),this._bindEvents()},_confirmBinded:!1,_bindEvents:function(){var e=this,n=!1;this._confirmBinded||(this._confirmBinded=!0,this.confirmDialog.one(".J-execute-rights").on("click",function(){e.confirmDialog.close(),n=e.checkBox.get("checked"),t(e.url,{method:"POST",on:{success:function(t,n){var o=c.getEvalRes(n);o.status&&i(e.callback)?e.callback.call(e.ndLink,e.ndLink):f.alert(o.msg)},failure:function(){}}}),n&&t("/rates/deletefeedback",{method:"POST",data:{orderid:e.orderId},on:{success:function(e,t){var n=c.getEvalRes(t);n.status||f.alert(n.msg)},failure:function(){}}})}))}};e.namespace("mt.www.Order"),e.mt.www.Order={check:function(t,i){function r(){var t=e.one("#J-pay-types"),n=e.one("#J-order-pay-button"),o=e.one("#J-pay-total"),i=o.one(".money"),a=e.one("#J-verify-mobile"),r="确认付款",s="去付款",u="¥",p=c.decodeAttr(C,"params");C&&C.delegate("click",function(){d.set("fromurl",window.location.href,c.Cookie.getExpiresDate(0,0,60),"/","."+M.DOMAIN_HOST)},".rebind-link"),_&&(P&&_.get("checked")&&P.show(),_.on("click",function(){_.get("checked")&&(n.set("value",r),l("show"),a&&(!P||P.one(".J-payment-code").hasClass("payment-code--use-password")?a.show():a.hide()),o.hide(),t.hide())}),window._gaq.push(["_trackEvent","InnerLink","Click","order-check/use-credit-interest"+(P?"/testpayhash":"")])),J&&(J.on("click",function(){J.get("checked")?(i.setHTML(u+p.diff),l("show"),a&&(P?P.one(".J-payment-code").hasClass("payment-code--use-password")&&a.show():a.show())):(i.setHTML(u+p.total),l("hide"),a&&a.hide())}),J.once("click",function(){window._gaq.push(["_trackEvent","InnerLink","Click","order-check/use-credit-interest"+(P?"/testpayhash":"")])})),L&&L.on("click",function(){L.get("checked")&&(n.set("value",s),i.setHTML(u+p.total),l("hide"),a&&a.hide(),o.show(),t.show())})}function l(e){P&&("hide"===e?P.fire("component:hide"):P.fire("component:show"))}function h(){var t=e.one("#J-verify-mobile");P.on("component:pass",function(){m(_&&_.get("checked"))}),P.delegate("click",function(){e.use("www-dialog",function(e){e.mt.www.Dialog.alert("您可以在“我的美团”—“账户设置”—“安全中心”设置支付密码"),l("hide")}),t&&t.show()},".J-skip-payment-code")}function g(n){n.halt();var o=c.data(T,"orderid"),i=null,a=s.field(T,"paytype"),r=e.all(".bank-area"),l=!1,d=_&&_.get("checked");if(d)T.removeAttribute("target");else{if(!a)return f.alert("请选择支付方式"),l=!r.some(function(e){return e.hasClass("bank-area--open")}),void(l&&r.item(0).addClass("bank-area--open"));"tenpay"===a||"alipay"===a||"cmpay"===a?i=a:-1!==a.indexOf("alipay-")?i="alipay-bank":-1!==a.indexOf("tenpay-")&&(i="tenpay-bank"),_gaq&&_gaq.push(["_trackPageview","/order/topay/"+(t?"new/":"")+i])}P&&"none"!==P.one(".J-payment-code").getStyle("display")?P.fire("component:submit"):m(d,o)}function m(e,t){n?(window.setTimeout(function(){T.submit()},300),e||v(t)):o?(T.submit(),window.setTimeout(function(){e||v(t)},300)):(T.submit(),e||v(t))}function v(t){function n(t){function n(){if(!d){var t=e.one("body"),n=t.insertBefore(l.getHTML(),l);if(!n)return;n.plug(e.mt.plugin.Effect);var o=n.delegate("click",function(){n.effect.fadeOutSimple(!0,200),o.detach(),d=!1},".close");n.show(),e.Global.fire("PageHeight:change"),a&&8>a&&c.reflow()}d=!0,window.scrollTo(0,0)}var i=e.one("#"+r),l=e.one("#pay-fail-tips"),d=!1;o=t.appendTrackingParams(o),i.delegate("click",function(e){e.halt(),k.close(),window.location.href=o},".close, .success"),l?i.delegate("click",function(e){e.halt(),k.close(),n()},".fail"):i.delegate("click",function(e){e.halt(),k.close(),window.location.href=o},".fail"),i.delegate("click",function(e){e.halt(),k.close(),w===D&&(y=s&&s.get("value"),window.location.href="/account/chargepay?money="+y)},".back")}var o,i,r="order-pay-dialog",s=c.field(T,"money");I&&I>0?(w=F,o="/cart/check/"+I):t&&t>0?(w=E,o="/order/check/"+t):(w=D,o="/account/credit"),i=e.one("#notice-dialog-markup"),k?k.open():(k=new p({id:r,width:"460px",title:"&nbsp;",content:i.getHTML()}),k.open(),e.use("www-tracker",function(e){n(e.mt.www.tracker)}))}var y,w,k,b,T=e.one("#order-check-type-form"),x=c.field(T,"captcha"),C=e.one("#J-pay-choice"),_=e.one("#J-pay-use-credit"),J=e.one("#J-pay-use-credit-partial"),L=e.one("#J-pay-use-other"),P=e.one(".component-payment-code"),E=0,D=1,F=2,A=c.field(T,"mobile");if(T&&!(0>=i)){if(A&&A.plug(e.mt.plugin.Placeholder),C){if(C.one(".pay-choice-list")){var B=C.one(".J-pay-use-credit");l(B.get("checked")?"show":"hide")}r(),P&&h()}b=new u({form:T,fields:{captcha:{node:x,validateFn:u.CHECK_EMPTY_FN,typeTip:"",errorTip:"请输入验证码"},mobile:{node:A,validateFn:function(e){var t=e.get("value");return!/^1\d{10}$/.test(t)},typeTip:"",errorTip:"请输入正确的手机号"}}});var I=c.data(T,"bigorderid");T.on("submit",g)}},checkWithParams:function(t,n,o){function i(){this._events={},this._props={}}function a(){e.each(o,function(e,t){y.set(t,e)}),r(),g&&l(),p.delegate("click",function(){y.set("highlightBank",!0)},"[name=paytype]"),p.on("submit",u)}function r(){var t=c.decodeAttr(h,"params"),n=function(t){try{e.one("#J-pay-total").one(".money").setHTML("¥"+t)}catch(n){return}};h&&h.delegate("click",function(){d.set("fromurl",window.location.href,c.Cookie.getExpiresDate(0,0,60),"/","."+M.DOMAIN_HOST)},".rebind-link");var o=e.one("#J-pay-use-credit");if(o)return function(){function e(){var e=o.get("checked");y.set("采用余额支付",e)}o.on("click",e),e()}(),void window._gaq.push(["_trackEvent","InnerLink","Click","order-check/use-credit-interest"+(g?"/testpayhash":"")]);var i=e.one("#J-pay-use-credit-partial");return i?(function(){function e(){var e=i.get("checked");n(e?t.diff:t.total),y.set("采用余额支付",e)}i.on("click",e),y.set("highlightBank",!0),e()}(),void i.once("click",function(){window._gaq.push(["_trackEvent","InnerLink","Click","order-check/use-credit-interest"+(g?"/testpayhash":"")])})):(n(t.total),void y.set("采用余额支付",!1))}function l(){g.on("component:pass",function(){w.submitPayForm(y.get("余额足够")&&y.get("采用余额支付"))}),g.delegate("click",function(){e.use("www-dialog",function(e){e.mt.www.Dialog.alert("您可以在“我的美团”—“账户设置”—“安全中心”设置支付密码"),y.set("未设置支付密码但跳过设置",!0)})},".J-skip-payment-code")}function u(e){e.halt();var n=null,o=s.field(p,"paytype"),i=y.get("余额足够")&&y.get("采用余额支付");if(i)p.removeAttribute("target");else{if(!o)return void f.alert("请选择支付方式");"tenpay"===o||"alipay"===o||"cmpay"===o?n=o:-1!==o.indexOf("alipay-")?n="alipay-bank":-1!==o.indexOf("tenpay-")&&(n="tenpay-bank"),_gaq&&_gaq.push(["_trackPageview","/order/topay/"+(t?"new/":"")+n])}y.get("采用余额支付")&&!y.get("未设置支付密码但跳过设置")?g.fire("component:submit"):w.submitPayForm(i)}i.prototype={constructor:i,setExclusive:function(t){var n=this;e.each(t,function(o){n.on("set-"+o,function(){this.get(o)===!0&&e.each(t,function(e){o!==e&&n.set(e,!1)})})})},setBind:function(t,n,o){var i=this;e.each(t,function(e){i.on("set-"+e,function(){var e=n.apply(i);o&&i.set(o,e)})})},set:function(e,t){this._props[e]!==t&&(this._props[e]=t,this.fire("set-"+e))},get:function(e){return this._props[e]},on:function(e,t){this._events[e]?this._events[e].push(t):this._events[e]=[t]},fire:function(t){var n=this,o=this._events[t];o&&e.each(o,function(e){e.apply(n)})}};var p=e.one("#order-check-type-form"),h=e.one("#J-pay-choice"),g=e.one(".component-payment-code"),m=e.one(".component-verify-code");if(p&&!(0>=n)){var v=function(t,n){var o=e.one(t);o&&o[n?"show":"hide"]()},y=new i;y.setExclusive(["余额足够","余额不足","无余额"]),y.setExclusive(["已设置支付密码","未设置支付密码","未设置支付密码但跳过设置"]),y.setBind(["无余额","采用余额支付","未设置支付密码但跳过设置"],function(){var t=!this.get("无余额")&&this.get("采用余额支付")&&!this.get("未设置支付密码但跳过设置");g&&g.fire("component:"+(t?"show":"hide"));var n=e.one(".pay-choice-list .pay-method");return n&&n[t?"addClass":"removeClass"]("active-pay-method"),t},"showPaymentCode"),y.setBind(["风控用户","无余额","未设置支付密码","采用余额支付"],function(){var e=this.get("风控用户")&&!this.get("无余额")&&!this.get("未设置支付密码")&&this.get("采用余额支付");return m&&(m.fire("component:"+(e?"enable":"disable")),m[e?"show":"hide"]()),e},"showVerifyCode"),y.setBind(["showPaymentCode","showVerifyCode"],function(){v(".payment-code-group",this.get("showPaymentCode")||this.get("showVerifyCode"))}),y.setBind(["余额足够","采用余额支付"],function(){var t=this.get("余额足够")&&!this.get("采用余额支付")||!this.get("余额足够");v("#J-pay-types",t),v("#J-pay-total",t);var n=e.one("#J-order-pay-button");n&&n.set("value",t?"去付款":"确认付款")}),y.setBind(["highlightBank"],function(){var t=e.one(".paytype-list"),n=this.get("highlightBank");t&&t[n?"addClass":"removeClass"]("active-method")}),m?m.after("component:ready",function(){m.fire("component:start",{formSelector:p}),a()}):a();var w=this}},submitPayForm:function(t){var i=e.one("#order-check-type-form"),a=this;n?(window.setTimeout(function(){i.submit()},300),t||a.showPayNotice()):o?(i.submit(),window.setTimeout(function(){t||a.showPayNotice()},300)):(i.submit(),t||a.showPayNotice())},_payNoticeDailog:null,showPayNotice:function(){function t(t){function o(){if(!d){var t=e.one("body"),n=t.insertBefore(l.getHTML(),l);if(!n)return;n.plug(e.mt.plugin.Effect);var o=n.delegate("click",function(){n.effect.fadeOutSimple(!0,200),o.detach(),d=!1},".close");n.show(),e.Global.fire("PageHeight:change"),a&&8>a&&c.reflow()}d=!0,window.scrollTo(0,0)}var s=e.one("#"+u),l=e.one("#pay-fail-tips"),d=!1;n=t.appendTrackingParams(n),s.delegate("click",function(e){e.halt(),v.close(),window.location.href=n},".close, .success"),l?s.delegate("click",function(e){e.halt(),v.close(),o()},".fail"):s.delegate("click",function(e){e.halt(),v.close(),window.location.href=n},".fail"),s.delegate("click",function(e){e.halt(),v.close(),r===g&&(i=f&&f.get("value"),window.location.href="/account/chargepay?money="+i)},".back")}var n,o,i,r,s=e.one("#order-check-type-form"),l=c.data(s,"bigorderid"),d=c.data(s,"orderid"),u="order-pay-dialog",f=c.field(s,"money"),h=0,g=1,m=2,v=this._payNoticeDailog;l&&l>0?(r=m,n="/cart/check/"+l):d&&d>0?(r=h,n="/order/check/"+d):(r=g,n="/account/credit"),o=e.one("#notice-dialog-markup"),v?v.open():(this._payNoticeDailog=v=new p({id:u,width:"460px",title:"&nbsp;",content:o.getHTML()}),v.open(),e.use("www-tracker",function(e){t(e.mt.www.tracker)}))},transfersalecancel:function(){function n(e){e.halt();var n,o=this.ancestor("form"),a="转卖取消后，相应美团券可继续使用。\n确认取消转卖？";if(window.confirm(a)){if(n&&n.isInProgress())return;n=t(o.get("action"),{method:"POST",on:{success:function(e,t){var n=c.getEvalRes(t);n.status?(o.replace("<span>取消成功</span>"),window.location.reload()):i.alert(n.msg)},failure:function(){}}})}}var o=e.one("#transfersale-record"),i=e.mt.www.Dialog;l.Util.toggleByLink("#J-order-detail-trigger","#J-order-detail"),o&&o.delegate("click",n,".cancel-transfersale")},refund:function(){function n(e){e.halt();var n,o=this.ancestor("form"),i="退款取消后，相应美团券可继续使用。\n确认取消退款？";if(window.confirm(i)){if(n&&n.isInProgress())return;n=t(o.get("action"),{method:"POST",on:{success:function(e,t){var n=c.getEvalRes(t);n.status?(o.replace("<span>取消成功</span>"),window.location.reload()):f.alert(n.msg)},failure:function(){}}})}}var o=e.one("#refund-record");l.Util.toggleByLink("#J-order-detail-trigger","#J-order-detail"),o&&o.delegate("click",n,".cancel-refund")},editAddress:function(){function t(){return"-1"===r.get("value")?"请选择省份":"-1"===s.get("value")?"请选择城市":"-1"===l.get("value")?"请选择市区":!1}var n=e.one("#edit-address");if(n){var o,i=e.one("#order-address"),a=e.one("#edit-address-form"),r=c.field(a,"adrProvince"),s=c.field(a,"adrCity"),l=c.field(a,"adrDistrict"),d=c.field(a,"adrAddress"),p=c.field(a,"adrZipCode"),f=c.field(a,"adrName"),h=c.field(a,"adrPhone"),g=a.one(".cancel-address");n.on("click",function(e){e.halt(),"none"===a.getStyle("display")?(i.hide(),a.show()):(i.show(),a.hide())}),g.on("click",function(e){e.halt(),i.show(),a.hide()}),o=new u({form:a,fields:{district:{node:l,validateFn:t,typeTip:""},address:{node:d,validateFn:function(){var e=d.get("value");return e.length<5||e.match(/^\d*$/)},typeTip:"",errorTip:"请填写街道地址，最少5个字，最多不能超过60个字，不能全部为数字"},zipcode:{node:p,validateReg:/^\d{6}$/,typeTip:"",errorTip:"邮政编码填写有误，请输入6位邮政编码"},name:{node:f,validateFn:function(){var e=f.get("value");return e.length<2||e.length>15},typeTip:"",errorTip:"请正确填写姓名，最少不能低于2个字，最多不能超过15个字"},phone:{node:h,validateReg:/^.{7,}$/,typeTip:"",errorTip:"电话号码不能少于7位"}},tipClass:u.CLASS_INLINE_TIP,checkEvent:"blur",newStyle:!0})}},editGoods:function(t){function n(){var n={},o={},i=[];""!==v&&e.Array.each(v.split(y),function(e){var t=e.split(w);n[t[0]]=parseInt(t[1],10),k+=n[t[0]]}),e.Array.each(m,function(e,t){n[e.type]&&(e.curnumber-=n[e.type]),b[t]=Math.max(e.maxnumber-e.curnumber,n[e.type]?n[e.type]:0),e.maxnumber&&e.curnumber>.8*e.maxnumber&&(o[t]=b[t])}),i.push('<form action="/order/editgoods" method="post">'),i.push('<div class="type-select-wrapper">'),i.push('<table class="list" id="deal-type-select-list">'),i.push('<tr><th class="type">类型</th><th class="desc">说明</th><th class="quantity">数量</th></tr>'),e.Array.each(m,function(t,a){var r=a%2?' class="alt"':"";i.push("<tr"+r+">"),i.push('<td class="type">'),i.push('<p class="text">'+t.type+"</p>"),e.Object.isEmpty(o)||(void 0===o[a]?i.push('<p class="last">备货充足</p>'):o[a]>0&&i.push('<p class="last">仅剩：<strong>'+o[a]+"</strong></p>")),i.push("</td>"),i.push('<td class="desc">'),i.push('<p class="text">'+t.desc+"</p>"),i.push("</td>"),i.push('<td class="quantity">'),i.push('<p class="input">'),t.maxnumber?b[a]>0?i.push('<input type="text" autocomplete="off" class="f-text" maxlength="4" name="quantity" value="'+(n[t.type]||"")+'" data-type="'+t.type+'" data-max="'+b[a]+'" />'):i.push("卖光了"):i.push('<input type="text" autocomplete="off" class="f-text" maxlength="4" name="quantity" value="'+(n[t.type]||"")+'" data-type="'+t.type+'" />'),i.push("</p>"),i.push('<p class="error"></p>'),i.push("</td>"),i.push("</tr>")}),i.push("</table>"),i.push("</div>"),i.push('<input type="hidden" name="goodsdetail" value="" />'),i.push('<input type="hidden" name="orderid" value="'+t+'" />'),i.push('<p class="act"><input type="submit" class="btn" value="确定" /></p>'),i.push("</form>"),d=new p({id:T,title:"选择类型",width:"470px",content:i.join("")})}function o(){u=d.one("form"),f=d.all("input.f-text"),h=d.one(".body > .error"),g=c.field(u,"goodsdetail"),u.delegate("focus",function(){i(this)},"input.f-text"),u.delegate("blur",function(){i(this)},"input.f-text"),u.on("submit",function(e){e.halt();var t,n=0,o=[];if(t=f.some(function(e){var t;return i(e)?(t=parseInt(e.get("value"),10),t>0&&(n+=t,o.push(e.getAttribute("data-type")+w+t)),!1):(e.focus(),!0)}),!t){if(n!==k)return void h.setHTML("不能更改总数量").show();g.set("value",o.join(y)),u.submit()}})}function i(e){var t=r(e.get("value")),n=e.getAttribute("data-max"),o=/^\d+$/;return t?o.test(t)?n&&(t=parseInt(t,10),n=parseInt(n,10),t>n)?(a(e,"超过了剩余数量"),!1):(s(e),!0):(a(e,"数量必须为数字"),!1):(s(e),!0)}function a(e,t){e.ancestor("td").one(".error").setHTML(t).show()}function s(e){e.ancestor("td").one(".error").hide()}var l=e.one("#edit-goods");if(l){var d,u,f,h,g,m=c.decodeAttr(l,"types"),v=c.data(l,"types-select"),y="，",w="*",k=0,b={},T="type-select-dialog";l.on("click",function(){d?d.open():(n(),d.open(),o())})}},applyWithdraw:function(t){function n(){a.on("submit",function(e){e.halt();var n,o=[];return t&&(n=d.get("value"),""===n||"-1"===n?o.push("请选择银行"):"0"===n&&""===f.get("value")&&o.push("请手工填写银行支行名称"),""===r(h.get("value"))&&o.push("请填写开户人姓名"),""===r(g.get("value"))&&o.push("请填写银行账号")),m&&""===r(m.get("value"))&&o.push("请填写申请理由"),o.length?void v.setStyle("display","block").setHTML(o.join("<br />")):void a.submit()})}function o(){e.Global.on("Cascade.change",function(t){var n,o="/order/listbranch/";t.id===s.get("id")&&2===t.index&&(n=s.all("select"),o+=n.get("value").join("/"),e.Global.fire("AutoComplete.updateData",{id:u.get("id"),action:o}))})}function i(){e.Global.on("AutoComplete.select",function(e){e.id===u.get("id")&&("0"===e.data.id?p.show():(p.hide(),f.set("value","")))})}var a=e.one("#apply-withdraw-form"),s=a.one(".branch-cascade"),d=c.field(a,"bankbranchid"),u=a.one(".auto-complete-bankbranchid"),p=a.one(".no-branch"),f=c.field(a,"bankname"),h=c.field(a,"username"),g=c.field(a,"cardno"),m=c.field(a,"comment"),v=a.one(".error");t&&e.use("w-base","w-autocomplete",function(){o(),i()}),l.Util.toggleByLink("#order-detail-trigger","#order-detail"),n()},list:function(){var n=e.one("#order-list"),o=this;this.initFilter(),n&&(n.delegate("click",function(e){e.preventDefault(),o.cancel(this,function(e){e.ancestor(".J-order-w").hide(200)})},".order-cancel, .order-delete"),n.delegate("click",function(e){e.preventDefault(),o.viewCoupon(e.target)},".J-coupon-send"),n.delegate("click",function(e){e.preventDefault(),o.viewFeedback(e.target)},".J-feedback"),n.delegate("click",function(e){e.halt();var n=c.data(this,"orderid");n&&t("/order/deliverypush/"+n,{method:"POST",on:{success:function(e,t){var n=c.getEvalRes(t);n.status?n.tipped?f.alert("提醒发送成功！\n商家正在积极备货中，请耐心等待。"):f.alert("提醒发送成功！\n商家会在购买成功后2天内发货，3-7天内送到您的手中。"):f.alert("请求失败，请稍候重试。")},failure:function(){f.alert("请求失败，请稍候重试。")}}})},".orders-delivery-push"))},initFilter:function(){var t,n,o=e.one(".J-orders-filter");o&&(t=o.get("options"),o.on("change",function(){n=t.filter('[value="'+this.get("value")+'"]'),n.isEmpty()||(document.location.href=n.item(0).getAttribute("data-url"))}))},cancel:function(e,t){var n,o=e.ancestor(".J-order-w"),i=null;o&&(i=o.one(".order-op input")),o&&(i=o.one(".order-op input")),n=i&&"hasRated"===i.get("value")?!0:!1,w.showDialog(n,t,e)},viewFeedback:function(t){function n(){o=new p({id:i,width:"550px",title:"请注意",content:a.getHTML()}),o.open(),o.one(".J-confirm-feedback").set("href",r)}var o=null,i="order-show-feedback-dialog",a=e.one("#show-feedback-dialog-markup"),r=t.get("href");n()},viewCoupon:function(n){function o(){x=new p({id:J,width:"750px",title:"查看密码",content:_.getHTML()}),x.open(),d=x.one("form"),T=d.one(".J-send-group"),f=x.one(".coupon-list"),w=x.one('input[name="mobile"]'),k=x.one('input[type="submit"]'),d.delegate("click",function(){b&&("none"===T.getStyle("display")?(b.show(),T.show()):(b.hide(),T.hide()))},".J-send-link")}function i(){var e,n="/order/listbyorder/send/";e=t(n+E,{method:"GET",on:{success:function(e,t){var n=c.getEvalRes(t);n.status?a(n.data):f.setHTML(t.msg)},failure:function(){f.setHTML("获取数据失败，请稍后重试")}}})}function a(e){var t="";L===h?(t="/coupon/sms",x.one(".J-info-tip").show()):L===v?t="/order/resendyglz/"+E:L===m?t="/order/resendsms/"+E:L===g&&(t="/coupon/storagesms/"+E),D=e.isValid,f.setHTML(e.content),b=f.all('input[type="checkbox"]'),b.filter(function(e){return!e.getAttribute("disabled")}).isEmpty()&&x.one(".J-send-link").hide(),b.hide(),w.set("value",e.mobile),d.set("action",t),D&&l.disableButton(k,!1),x.set("centered",!0),r(e.mobile)}function r(n){function o(t){var n;return L!==h&&L!==g||(n=t.all("input[type=checkbox]").get("checked"),-1!==e.Array.indexOf(n,!0))?!1:"请选择至少一张"+(L===g?"优惠码":"美团券")}function i(e){var t=e.get("value");return/^\d{11}$/.test(t)||t===n?!1:!0}var a;a=new u({form:d,fields:{coupons:{node:f,validateFn:o,typeTip:""},mobile:{node:w,validateFn:i,typeTip:"",errorTip:"请填写正确的手机号"}},tipClass:u.CLASS_BLOCK_TIP}),f.on("click",function(){a.resetField("coupons")}),d.on("submit",function(e){e.halt();var n;l.disableButton(k,!0),n=t(d.get("action"),{method:"POST",form:{id:d},on:{success:function(e,t){var n=c.getEvalRes(t);n.status?s(!0,"",n.couponcount):s(!1,n.msg)},failure:function(){}}})})}function s(e,t,n){var o,i=5;o=e?{type:"success",title:"短信发送成功！",tip:n>1?"已将<em>"+n+"</em>张"+P+"发送给您。<br />短信可能有延迟，请耐心等待":"短信可能有延迟，请耐心等待"}:{type:"failure",title:"短信发送失败！",tip:t+"。<br />请稍后重新发送短信"},x.showResult(o),x.set("autoHide",i),x.after("close",function(){window.location.reload()})}var d,f,w,k,b,T,x=null,C=c.decodeAttr(n,"params"),_=e.one("#send-sms-dialog-markup"),J="order-send-sms-dialog",L=parseInt(C.couponType,10),P=y[L],E=C.orderId,D=!1;o(),i()},transfersale:function(){function t(){var t,i,r,s,l,d=a.one(".transfersale-count"),u=0;l=o.all("input[type=checkbox]").get("checked"),e.Array.each(l,function(e){e&&u++}),r=c.data(o,"price"),s=c.data(o,"orderprice"),t=r*u,i=s*u-t,0===u&&(t=0,i=0),t=n(t),i=n(i),d.setHTML('<span class="money">¥'+t+"</span>"+(i>0?'<span class="remarks">（转卖金额不包括使用代金券支付的<span class="money">¥'+i+"</span> 元）</span>":""))}function n(e){var t=/\d+\.\d+/;return t.test(e+"")?Number(e).toFixed(2):e}var o,i,a=e.one("#order-apply-transfersale-form");a&&(o=a.one(".coupon-field"),i=c.field(a,"submit"),t(),o.delegate("click",function(){t()},"input"))},viewDetail:function(t){var n=e.one(".J-primary-info"),o=e.one("#J-delivery-info"),i=e.one("#J-toggle-delivery-info"),a=e.one(".J-coupon"),r=this;n&&n.delegate("click",function(e){e.preventDefault(),r.cancel(this,function(){window.location.reload()})},".J-order-cancel"),a.delegate("click",function(e){e.preventDefault(),r.viewCoupon(e.target)},".J-coupon-send"),r.editAddress(),r.editGoods(t),o&&i&&i.on("click",function(){"none"===o.getStyle("display")&&(o.show(),i.hide())})},toggleAftersales:function(){var t=e.one("#content"),n="unfold",o="fold",i="hover";t.delegate({click:function(e){e.halt();var t=this.next(".aftersales-sheet");this.hasClass(o)?(this.replaceClass(o,n),t.show()):(this.replaceClass(n,o),t.hide())},mouseover:function(){this.addClass(i)},mouseout:function(){this.removeClass(i)}},".aftersales-trigger")},checkAftersales:function(t,n){function o(){d.on("change",function(){var e=d.get("value"),t=n[e];m.focus(),"undefined"==typeof t?(p.hide(),h.hide(),l.removeField("refund"),y&&y.hide()):(t.needRefund?(y&&y.show(),h.show(),l.addField("refund",s)):(h.hide(),y&&y.hide(),l.removeField("refund")),p.setHTML(t.desc).show())}),g.on("change",function(){m.focus()})}function i(e){return"-1"===e.get("value")}function a(e){var t=g.get("selectedIndex");return"其他"!==g.get(t).get("text")?!1:""!==e.get("value")?!1:!0}function r(t){var n=t.get("value");return n?e.mt.lang.isNumeric(t.get("value"))?!1:"请输入正确的金额":!0}if(t=e.one(t)){var s,l,d=c.field(t,"type"),p=d.next(".tip"),f=c.field(t,"refund"),h=f.ancestor(".field-group"),g=c.field(t,"reason"),m=c.field(t,"msg"),v=n[d.get("value")],y=e.one(".refund-description-tip");s={node:f,validateFn:r,typeTip:"",errorTip:"请输入退款金额"},o(),l=new u({form:t,fields:{type:{node:d,validateFn:i,typeTip:"",errorTip:"请选择售后服务类型"},reason:{node:g,validateFn:i,typeTip:"",errorTip:"请选择理由"},msg:{node:m,validateFn:a,typeTip:"",errorTip:"请输入描述"}},tipClass:u.CLASS_INLINE_TIP,async:!0}),v&&v.needRefund&&l.addField("refund",s)}},checkGoodsReturn:function(){var t,n=e.one("#goods-return-form"),o=c.field(n,"deliveryno"),i=c.field(n,"deliverycompany");t=new e.mt.FormChecker({form:n,fields:{deliveryno:{node:o,validateFn:u.CHECK_EMPTY_FN,typeTip:"",errorTip:"请填写物流单号"},deliverycompany:{node:i,validateFn:u.CHECK_EMPTY_FN,typeTip:"",errorTip:"请输入物流公司"}},tipClass:u.CLASS_INLINE_TIP,async:!0})},lotteryRemove:function(){var t=e.one("#order-list");t&&t.delegate("click",function(){var t=this,n=t.getData("dealid"),o=t.getData("code"),i="/lottery/delete/"+n+"/"+o,a=window.confirm("删除后本次抽奖将从列表消失，且不能恢复，确定删除？");if(a){var r={method:"POST",on:{success:function(e,n){var o=c.getEvalRes(n);o.status?t.ancestor("tr.lottery-order").remove():l.Dialog.alert(o.msg)}}};e.io(i,r)}},"#J-delete-lottery")}}},"1.0.0",{requires:["www-base","www-dialog","mt-formchecker","transition","mt-form"]});
;M.add("mt-date",function(e){var t=e.Lang.isDate,a=e.Lang.isArray;e.namespace("mt.date"),e.mt.date={getTimeReduction:function(e,a,r){return t(e)&&t(a)?(r&&(e=new Date(e.getFullYear(),e.getMonth(),e.getDate()),a=new Date(a.getFullYear(),a.getMonth(),a.getDate())),a.getTime()-e.getTime()):null},isInRegions:function(e,a,r,n){if(!t(e)||!t(a)||!t(r))return!1;var i=this.getTimeReduction(a,e),o=this.getTimeReduction(e,r);return n?i>0&&o>0:i>=0&&o>=0},equalTime:function(e,t,a){return a?e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate():e.getTime()===e.getTime()},formatDate:function(t,a){if(!e.Lang.isDate(t))return null;var r=t.getFullYear(),n=t.getMonth(),i=t.getDate(),o=n+1,s=i;return 10>o&&(o="0"+o),10>i&&(s="0"+s),a?[r,o,s].join(a):r+"年"+o+"月"+s+"日"},formatDateByString:function(e,t){if(e){var a={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var r in a)new RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?a[r]:("00"+a[r]).substr((""+a[r]).length)));return t}},isPeriodsOverlap:function(t,a){if(e.Lang.isArray(t)){a=a===!1?!1:!0;var r=this;e.Array.each(t,function(t){var a=t[0],n=t[1];e.Lang.isString(a)&&(a=r.buildDateByFormatedString(a)),e.Lang.isString(n)&&(n=r.buildDateByFormatedString(n)),t[0]=a,t[1]=n});var n=!1;return e.Array.each(t,function(e,i){for(var o=i+1;o<t.length;o++){var s=t[o],g=r.isTwoPeriodOverlap(e,s,a);if(g)return void(n=!0)}}),n}},isTwoPeriodOverlap:function(e,t,a){var r=this.getTimeReduction(e[1],t[0]),n=this.getTimeReduction(t[1],e[0]);return a?!(r>=0||n>=0):!(r>0||n>0)},compareByString:function(e,t){var a=this.buildDateByFormatedString(e),r=this.buildDateByFormatedString(t);return this.compareDate(a,r)},compareDate:function(e,t){var a=e.getTime(),r=t.getTime();return a===r?0:r>a?-1:1},buildDateByFormatedString:function(t){if(e.Lang.isString(t)){t=e.Lang.trim(t);var a=t.split(" ")[0],r=t.split(" ")[1],n=a.split("-"),i=parseInt(n[0],10),o=parseInt(n[1],10),s=parseInt(n[2],10),g=0,c=0,u=0;if(r){var l=r.split(":");g=parseInt(l[0]||0,10),c=parseInt(l[1]||0,10),u=parseInt(l[2]||0,10)}return new Date(i,o-1,s,g,c,u)}},getMaxDaysInMonth:function(e,t){t=parseInt(t,10);var a=new Date(e,t,0);return a.getDate()},fillTimeSection:function(t,a,r){a&&e.Lang.isArray(t)&&r&&(a.set("value",t[0]),r.set("value",t[1]))},_replaceOptionString2Node:function(t){for(var a=0;a<t.length;a++){var r=t[a];"string"==typeof r&&(t[a]=e.Node.create(r))}},buildDateSelect:function(t,r){var n=e.one(t);if(n){r=r||{},"undefined"==typeof r.options?r.options=[]:a(r.options)&&this._replaceOptionString2Node(r.options);var i=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],o=r.options;"year"===r.type?r.to=r.to||(new Date).getFullYear():(r.from=r.from||1,r.to=r.to<=12?r.to:12);for(var s=r.from;s<=r.to;s++){var g="",c=s,u="";"year"===r.type?g=s:(g=i[s-1],r.fillZero&&10>s&&(c="0"+s)),r.selectVal&&r.selectVal.toString()===c.toString()&&(u=" selected='selected'"),o.push(e.Node.create('<option value="'+c+'"'+u+">"+g+"</option>"))}n.setHTML(new e.NodeList(o).toFrag())}},calculateDay:function(e,t){var a,r,n;t=t||new Date;var i=[],o=this,s=/^([pnt]{1})(\d*)(\w+)/,g=e.match(s);if(/recentdays/.test(e)&&(n=e.split("-")[1],g=[e,"p",n,"day"]),g){var c=parseInt(g[2],10)||1,u=g[1];switch(g[3].substring(0,3)){case"day":i=o._calcDay(u,c,t);break;case"wee":i=o._calcWeek(u,c,t);break;case"mon":i=o._calcMonth(u,c,t);break;case"qua":i=o._calcQuarter(u,c,t);break;case"yea":i=o._calcYear(u,c,t);break;default:"today"===g[0]&&(a=r=t.getTime())}}if(i.length>0&&(a=i[0],r=i[1]),a>r){var l=a;a=r,r=l}return r=this.formatDate(new Date(r),"-"),a=this.formatDate(new Date(a),"-"),[a,r]},_calcDay:function(e,t,a){var r,n,i=1;switch(e){case"t":i=0;break;case"p":i=-1}return a.setDate(a.getDate()+t*i),r=a.getTime(),a.setDate(a.getDate()-t*i),n=a.getTime(),[r,n]},_calcWeek:function(e,t,a){var r,n,i=1,o=1,s=1,g=0===a.getDay()?7:a.getDay();switch(e){case"t":i=0;break;case"p":i=-1;break;case"n":s=7,o=-1}return a.setDate(a.getDate()+7*t*i-g+s),r=a.getTime(),a.setDate(a.getDate()-7*(t-1)*i+6*o),n=a.getTime(),[r,n]},_calcMonth:function(e,t,a){var r,n,i=1,o=1,s=0;switch(e){case"t":i=0,s=1;break;case"p":i=-1;break;case"n":t+=1,o=0,s=2}return a.setMonth(a.getMonth()+t*i),a.setDate(o),r=a.getTime(),a.setMonth(a.getMonth()-t*i+s),a.setDate(Number(!o)),n=a.getTime(),[r,n]},_calcQuarter:function(e,t,a){var r,n,i,o=1,s=parseInt(a.getMonth()/3,10)+1,g=3*s-2,c=1;switch(e){case"t":o=-1,r=3;break;case"p":o=-1,g-=3*t,r=3*t;break;case"n":g+=3*(t+1),c=0,r=-3*t+1}return a.setMonth(g-1),a.setDate(c),n=a.getTime(),a.setMonth(a.getMonth()+r),a.setDate(Number(!c)),i=a.getTime(),[n,i]},_calcYear:function(e,t,a){var r,n,i=1,o=0,s=1,g=11,c=31;switch(e){case"t":i=0;break;case"p":i=-1;break;case"n":o=g,s=c,g=0,c=1}return a.setFullYear(a.getFullYear()+i*t),a.setMonth(o),a.setDate(s),r=a.getTime(),a.setFullYear(a.getFullYear()-i*t+i),a.setMonth(g),a.setDate(c),n=a.getTime(),[r,n]}}},"1.0.0",{requires:["mt-base","node"]});
;M.add("w-calendar",function(e){function t(){t.superclass.constructor.apply(this,arguments)}var a=e.mt.date,n=e.mt.util,r=e.Lang,l={dayToday:"day--today",dayHover:"day--hover",daySelected:"day--selected",daySelectable:"day--selectable",dayCurMonth:"day--cur-month",dayPrevMonth:"day--prev-month",dayNextMonth:"day--next-month",ctlPrevMonth:"calendar-control--previous",ctlNextMonth:"calendar-control--next",ctlDisabled:"calendar-control--disabled",ctlDisplay:"calendar-control--display"},s={control:'<div class="calendar-controls"><a class="calendar-control {prevMonthClass}" href="javascript:void(0);" title="{prevMonthTitle}">&lsaquo;</a><span class="calendar-control calendar-control--display">{currentMonth}</span><a class="calendar-control {nextMonthClass}" href="javascript:void(0);" title="{nextMonthTitle}">&rsaquo;</a>{extraControlMarkup}</div>',table:'<table class="calendar-table" cellspacing="0" cellpadding="0" border="0"><thead class="calendar-table__header">{header}</thead><tbody class="calendar-table__body">{body}</tbody></table>',cell:'<td class="day {dayClass}" data-day="{day}"><div class="day__wrapper"><span class="day__num">{day}</span></div></td>',cellEmpty:'<td class="day {dayClass}" data-day="{day}"><div class="day__wrapper">&nbsp;</div></td>',cellHeader:'<td class="weekday">{label}</td>'};t.NAME="Calendar",t.CSS_PREFIX="widget-calendar",t.ATTRS={container:{value:null,setter:function(t){return e.one(t)},writeOnce:!0},showPrevMonthDays:{value:!1,writeOnce:!0},showNextMonthDays:{value:!1,writeOnce:!0},extraControlMarkup:{value:"",writeOnce:!0},startOnSunday:{value:!0,writeOnce:!0},minDate:{value:null,setter:"_setMindate"},maxDate:{value:null,setter:"_setMaxdate"}},e.extend(t,e.Widget,{initializer:function(){var e=this,a=e.get("container");if(!a)throw new Error(t.NAME+": 没有设置container或container不存在");e.currentDate=new Date,e.canPrevMonth=!0,e.canNextMonth=!0,e.publish("refresh",{emitFacade:!0,defaultFn:e.refresh}),e.publish("select",{emitFacade:!0,defaultFn:e._defSelectFn}),e.render()},renderUI:function(){this.get("container").setHTML(this._generateHTML())},bindUI:function(){var e=this,t=this.get("container"),a="."+l.daySelectable,r="."+l.ctlPrevMonth,s="."+l.ctlNextMonth;t.delegate("click",function(t){var l=this,o=e.currentDate,d=o.getFullYear(),c=o.getMonth(),i=n.data(l,"day"),u=new Date(d,c,i);l.test(a)?e.fire("select",{ndTarget:l,currentDate:o,selectedDate:u}):l.test(r)?(t.preventDefault(),e.prevMonth()):l.test(s)&&(t.preventDefault(),e.nextMonth())},[r,s,a].join(","))},getSelectable:function(){var e=this,t=e.get("container");return t.all("."+l.daySelectable)},getSelected:function(){var e=this,t=e.get("container");return t.all("."+l.daySelected)},prevMonth:function(){var e=this;e.canPrevMonth&&(e.currentDate.setDate(1),e.currentDate.setMonth(e.currentDate.getMonth()-1),e.canNextMonth=!0,e.fire("refresh",{currentDate:e.currentDate}))},nextMonth:function(){var e=this;e.canNextMonth&&(e.currentDate.setDate(1),e.currentDate.setMonth(e.currentDate.getMonth()+1),e.canPrevMonth=!0,e.fire("refresh",{currentDate:e.currentDate}))},refresh:function(){var e=this,t=e.get("container");t.setHTML(e._generateHTML())},setDate:function(e){var t,a=this,n=a.currentDate,l=!0;r.isDate(e)?t=e:(t=new Date,t.setTime(Date.parse(e))),n.getFullYear()===t.getFullYear()&&n.getMonth()===t.getMonth()&&(l=!1),a.currentDate=t,l&&(a.refresh(),a.fire("refresh",{currentDate:a.currentDate}))},_defSelectFn:function(e){var t=e.ndTarget,a=l.daySelected;t.hasClass(a)?t.removeClass(a):t.addClass(a)},_setMindate:function(e){if(r.isDate(e))return e;if(r.isString(e)){var t=new Date(e);return new Date(t.getFullYear(),t.getMonth(),t.getDate())}return new Date(2010,3,4)},_setMaxdate:function(e){if(r.isDate(e))return e;if(r.isString(e)){var t=new Date(e);return new Date(t.getFullYear(),t.getMonth(),t.getDate())}return new Date(2099,12,31)},_generateHTML:function(){return this._generateCalendarControl()+this._generateCalendarTable()},_generateCalendarControl:function(){var t,a=this,n=s.control,r=a.get("minDate"),o=a.get("maxDate"),d=a.currentDate,c=d.getFullYear(),i=d.getMonth(),u=l.ctlPrevMonth,h=l.ctlNextMonth;return i<=r.getMonth()&&c<=r.getFullYear()&&(u+=" "+l.ctlDisabled,a.canPrevMonth=!1),i>=o.getMonth()&&c>=o.getFullYear()&&(h+=" "+l.ctlDisabled,a.canNextMonth=!1),t={prevMonthTitle:0===i?c-1+"年12月":c+"年"+i+"月",prevMonthClass:u,nextMonthTitle:11===i?c+1+"年1月":c+"年"+(i+2)+"月",nextMonthClass:h,extraControlMarkup:a.get("extraControlMarkup"),currentMonth:c+"年"+(i+1)+"月"},e.mix(t,l),e.Lang.sub(n,t)},_generateCalendarTable:function(){var t,a=s.table;return t={body:this._generateCalendarCells(),header:this._generateCalendarHeader()},e.Lang.sub(a,t)},_generateCalendarHeader:function(){var e=this,t=e.get("startOnSunday"),a=s.cellHeader,n=["一","二","三","四","五","六","日"],l=["<tr>"];t&&n.unshift(n.pop());for(var o=0;7>o;o++)l.push(r.sub(a,{label:n[o]}));return l.push("</tr>"),l.join("")},_generateCalendarCells:function(){var e,t,n,o,d=this,c=d.get("startOnSunday"),i=s.cell,u=s.cellEmpty,h=l.dayToday,M=l.daySelectable,g=l.dayCurMonth,y=l.dayPrevMonth,D=l.dayNextMonth,v=d.get("showPrevMonthDays"),f=d.get("showNextMonthDays"),p=d.get("minDate"),b=d.get("maxDate"),C=d.currentDate,x=C.getFullYear(),w=C.getMonth(),_=new Date(x,w,1),m=_.getDay(),S=new Date,T=_,F=0===w?11:w-1,N=a.getMaxDaysInMonth(x,F+1),P=a.getMaxDaysInMonth(x,w+1),H=P,Y=[];for(e=c?m:m?m-1:6,t=(7-(e+P)%7)%7,Y.push("<tr>"),n=1;e>=n;n++)Y.push(r.sub(v?i:u,{dayClass:y,day:N-e+n}));for(n=1;H>=n;n++)T.setDate(n),o=[g],a.isInRegions(T,p,b)&&o.push(M),0===a.getTimeReduction(T,S,!0)&&o.push(h),Y.push(r.sub(i,{dayClass:o.join(" "),day:n})),(n+e)%7===0&&H>n&&Y.push("</tr><tr>");for(n=1;t>=n;n++)Y.push(r.sub(f?i:u,{dayClass:D,day:n}));return Y.push("</tr>"),Y.join("")}}),e.mt.widget.Calendar=t},"1.0.0",{requires:["mt-base","widget","mt-date","node"]});
;M.add("www-travel-appoint",function(e){function t(e){return("0"+(e+1)).slice(-2)}function a(e){return 10>e?"0"+e:e}function n(e){e=e.toString();var t=e.substring(0,4),a=e.substring(4,6),n=e.substring(6,8);return t+"-"+a+"-"+n}function i(e){e=e.replace(/-/g,"/");var t=new Date(e),a=new Date,n=["周日","周一","周二","周三","周四","周五","周六"],i=(a.getTime()-t.getTime())/864e5;return i>=0&&1>i?"今天":n[t.getDay()]}var r=e.mt.util,l=e.io,o=e.mt.www;e.namespace("mt.www.TravelAppoint"),o.TravelAppoint=function(){var s;return{init:function(){function l(){if(s.on("submitFailure",h),s.on("submitSuccess",h),U&&Q){C.delegate("click",function(){U.show()},".J-travel-checkin"),Q.after("refresh",o),Q.on("select",v),U.delegate("click",function(){U.hide()},".day--selectable"),e.one("body").on("click",function(e){var t=e.target;t===w||t.hasClass("calendar")||t.hasClass("calendar-control")||t.hasClass("arrow")||U.contains(t)||t.hasClass("time-info")||U.hide()});var t=e.one(".J-travel--tips");if(t){var a=t.one(".J-long--info"),n=t.one(".J-short--info");t.delegate("click",function(){"none"===n.getStyle("display")?(n.show(),a.hide()):(n.hide(),a.show())},".J-toggle-info")}}}function o(e){var a=e.currentDate,n=a.getFullYear(),i=t(a.getMonth());c(n,i)}function c(e,t){var n=U.all(".day--selectable");n.each(function(n){var i=a(n.getData("day")),r=""+e+t+i,l=A[r];if(l){var o=l.stock;o>=10?d(n,l,!0):o>0?d(n,l):u(n)}else u(n)})}function d(e,t,a){var n=a?"":"<p>剩"+t.stock+"</p>";n+='<p class="day__title">'+e.getData("day")+"</p>",n+='<p>¥<span class="J-travel-buy-price">'+t.price+"</span></p>",n+='<span class="J-travel-buy-calendarid" style="display: none;">'+t.calendarID+"</span>",e.addClass("day--enable").setHTML(n)}function u(e){e.removeClass("day--enable").removeClass("day--selectable").addClass("day--full").addClass("day--unavailable").setHTML('<p class="day__title">'+e.getData("day")+"</p><p>不可约</p>")}function v(e){var t=e.selectedDate.getFullYear(),r=e.selectedDate.getMonth()+1,l=a(r),o=e.selectedDate.getDate(),s=a(o),c=""+t+l+s;w.set("value",n(c)),k.set("value",e.ndTarget.one(".J-travel-buy-calendarid").get("text")),V.setHTML(i(n(c)));var d=e.ndTarget.one(".J-travel-buy-price");if(d){p(d),R=A[c].stock;var u=parseInt(x.get("value"),10);u>R&&(x.set("value",R),m(u,R))}}function p(e){var t=e.get("text"),a=x.get("value");j=t*a,F.set("text",t),M.set("text",j),j>=500?L.show():L.hide()}function g(){U=e.one("#J-hotel-calendar"),U&&(Q=new e.mt.widget.Calendar({container:U,startOnSunday:!0,minDate:O.replace(/-/g,"/"),maxDate:z.replace(/-/g,"/")}),c(Y.getFullYear(),t(Y.getMonth())))}function f(){function e(e,a){if(isNaN(e))return t.setHTML("请输入正确的购买数量"),!1;if(t.getHTML().length&&t.setHTML(""),0===a)return x.set("value",0),t.setHTML("此单不可预约"),!1;if(1>e)return x.set("value",1),t.setHTML("最少预约1张券"),setTimeout(function(){t.setHTML("")},3e3),!1;if(e>a){var n="最多预约"+a+"张券";return x.set("value",a),t.setHTML(n),setTimeout(function(){t.setHTML("")},3e3),!1}return!0}if(C&&x){var t=C.one(".J-component-quantity-warning"),a=-1;if(x.test('input[type="text"]')){var n=x.previous(".minus"),i=x.next(".plus");n.on("click",function(t){t.halt();var a=parseInt(x.get("value"),10),n=a+1;e(a,R)&&m(n,a)}),i.on("click",function(t){t.halt();var a=parseInt(x.get("value"),10),n=a-1;e(a,R)&&m(n,a)})}x.on("blur",function(){var t=x.get("value")-0;e(t,R)}),x.on("focus",function(){setTimeout(function(){x.select()},50)}),x.on("valuechange",function(e){var t=e.newVal,n=e.prevVal;""!==n&&""!==t&&(parseInt(t,10)>=R&&(t=R),m(n,t)),""===t&&(a=n),""===n&&m(a,t)})}}function m(t,a){var n=!1;if(K&&(n=K.name&&K.name.required||K.credentials&&K.credentials.required||K.mobile&&K.mobile.required||K.pinyin&&K.pinyin.required),n){var i=a-t;if(0!==i){if(i>0){for(var r=0;i>r;r++){var l=e.Lang.sub(G,{number:+t+r});S.appendChild(l)}I.initValuateForm(t,a)}else for(I.initValuateForm(t,a),i=-i;i>0;){var o=e.all(".J-travel-others-cells"),s=o.size(),c=o.item(s-1);if(!c)return;c.get("parentNode").removeChild(c),i--}var d="others-form--content__lastChild";e.one("."+d)&&e.one("."+d).removeClass(d),S.get("lastChild")&&S.get("lastChild").addClass(d),a>=2?e.one(".J-travel-others").setStyle("display","block"):e.one(".J-travel-others").setStyle("display","none")}}}function h(t){if(t.preventDefault(),(!W||!W.isInProgress())&&(!s||s.check())){e.one(".J-submit").addClass("btn-disabled").setAttribute("disabled",!0);var a,n,i=T(),l=y(),o={bookDate:w.get("value"),couponNum:x.get("value"),couponPrice:F.get("text"),firstVisitor:l};i.length>0&&(o.otherVisitors=i);var c=k.get("value"),d=r.field(D,"dealgoodsid").get("value"),u="quantity-"+_+"-"+c+"-"+d;x.set("name",u),r.field(D,"appointInfo").set("value",r.objToString(o,"deep")),a='<h2 class="tip">   申请预约中，请耐心等待<span class="loading-surround cancel-loading"></span></h2>',n=new e.mt.Dialog({id:"loading-dialog",width:"270px",content:a}),n.open(),window._gaq.push(["_trackEvent","InnerLink","Click","travel/appoint/submit"]),D.submit()}}function b(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function y(){var t={},a=".J-travel-firstVisitor-";return e.each(["name","pinyin","mobile","credentials","credentialsType"],function(n){var i=e.one(a+n);i&&(t[n]=i.get("value"))}),b(t)?[]:t}function T(){function t(e){return e.size()>0}var a=e.all(".J-travel-others-cells").size(),n=[],i=e.Lang.trim;if(0===a)return n;var r=e.all(".J-other-visitors-name"),l=e.all(".J-other-visitors-pinyin"),o=e.all(".J-other-visitors-mobile"),s=e.all(".J-other-visitors-credit"),c=e.all(".J-other-visitors-creditialType"),d=t(r),u=t(l),v=t(o),p=t(s);if(0===a)return n;for(var g=0;a>g;g++){var f={};d&&(f.name=i(r.item(g).get("value"))),u&&(f.pinyin=i(l.item(g).get("value"))),v&&(f.mobile=i(o.item(g).get("value"))),p&&(f.credentials=i(s.item(g).get("value")),f.credentialsType=i(c.item(g).get("value"))),n.push(f)}return n}var C=e.one(".J-travel-order");if(C){var J,w=e.one("#J-start-date"),D=e.one("#deal-buy-form"),x=C.one(".J-cart-quantity"),k=r.field(D,"calendarid"),V=D.one(".J-checkin-info"),F=e.one("#deal-buy-price"),M=e.one("#deal-buy-total-t"),L=e.one("#big-deal-tips"),S=e.one(".J-travel-others-form"),I=this,H=C.getData("params"),N=r.decodeJSON(H),_=N.dealid,q=N.travelAppointFields,A=N.priceCalendarArr,P=N.startDate,E=N.minValidDate?N.minValidDate:P,R=A[E].stock,O=n(P),$=n(E),z=n(N.endDate),Y=new Date(O.replace(/-/g,"/")),B=N.selectDate;B?(J=n(B),P=B):J=null;var j=A[P].price*x.get("value"),G=e.one("#travel-others-markup").getHTML(),K={},Q=null,U=null,W=null;q&&q.otherVisitor&&(K=q.otherVisitor),J&&($=J),w.set("value",$),V.setHTML(i($)),k.set("value",A[E].calendarID),x.setAttribute("readonly","true"),M.set("text",j),j>=500&&L.show(),g(),I.initFirstVisitorValuateForm(D),f(),m(1,parseInt(x.get("value"),10)),l()}},initFirstVisitorValuateForm:function(t){e.use("mt-formchecker",function(e){var a=e.mt.FormChecker,n=t.one(".J-travel-firstVisitor-name"),i=t.one(".J-travel-firstVisitor-pinyin"),r=t.one(".J-travel-firstVisitor-mobile"),l=t.one(".J-travel-firstVisitor-credentials");s=new a({form:t,fields:{visitorName:{node:n,validateFn:function(){var e=n.get("value");return e.length<2||e.length>15},typeTip:"",errorTip:"请正确填写名字，最少不能低于2个字，最多不超过15个字"},visitorPinyin:{node:i,validateFn:function(){var e=i.get("value");return e.length<2||e.length>15},typeTip:"",errorTip:"请正确填写拼音"},visitorMobile:{node:r,validateReg:/^.{7,}$/,typeTip:"",errorTip:"电话号码不能少于7位"},visitorCredentials:{node:l,validateFn:function(){var e=l.get("value");return e.length<9},typeTip:"",errorTip:"请正确填写证件号码，最少不能低于9个字"}},tipClass:a.CLASS_INLINE_TIP,checkEvent:"blur",async:!0})})},initValuateForm:function(t,a){var n,i,r,l,o,c,d,u,v,p=a-t,g={},f=e.all(".J-travel-others-cells").size();p>0?v=1:(v=a,f=t-1);for(var m=e.all(".J-other-visitors-name"),h=e.all(".J-other-visitors-pinyin"),b=e.all(".J-other-visitors-mobile"),y=e.all(".J-other-visitors-credit");f>=v;v++){if(n=m.item(v-1),i=h.item(v-1),r=b.item(v-1),l=y.item(v-1),n){o={node:n,validateReg:/^.{2,}$/,typeTip:"",errorTip:"请正确填写名字，最少不能低于2个字"};var T="otherVisitorName-"+v;p>0?g[T]=o:s.removeField(T)}if(i){c={node:i,validateReg:/^.{4,}$/,typeTip:"",errorTip:"请正确填写姓名拼音，最少不能低于4个字母"};var C="otherVisitorPinyin-"+v;p>0?g[C]=c:s.removeField(C)}if(r){d={node:r,validateReg:/^.{7,}$/,typeTip:"",errorTip:"请正确填写电话号码，不能少于7位数"};var J="otherVisitorMobile-"+v;p>0?g[J]=d:s.removeField(J)}if(l){u={node:l,validateReg:/^.{9,}$/,typeTip:"",errorTip:"请正确填写证件号码，最少不能低于9位数"};var w="otherVisitorCredentials-"+v;p>0?g[w]=u:s.removeField(w)}}p>0&&s.addFields(g)},cancelAppoint:function(){var t=e.one("body");t&&t.delegate("click",function(t){e.use("mt-dialog",function(e){var a,n,i,s,c=t.target,d=r.decodeJSON(c.getData("params")),u=c.getData("isEventBinded"),v=c.getData("title"),p=d.firstVisitor,g="/travel/cancelAppoint/"+d.orderId+"/"+d.bookId,f=e.one("#travel-cancel-appoint-markup").getHTML(),m={title:v,couponNum:d.couponNum,bookDate:d.bookDate},h="",b="",y="",T={nameContext:{label:"取票人",placeholder:"取票人姓名"},mobileContext:{label:"手机号",placeholder:"用于接收确认短信"},credentialsContext:{label:"证件号",placeholder:"用于确认身份"}};p=e.merge(T,p),p.nameContext&&(p.mobileContext?p.credentialsContext?(h="<td>"+p.nameContext.label+" ："+p.nameContext.dataStr+"</td>",b="<td>"+p.mobileContext.label+" ："+p.mobileContext.dataStr+"</td>",y='<td class="td--last">'+p.credentialsContext.label+" ："+p.credentialsContext.dataStr+"</td>"):(h="<td>"+p.nameContext.label+" ："+p.nameContext.dataStr+"</td>",b='<td class="td--last" colspan="2">'+p.mobileContext.lable+" ："+p.mobileContext.dataStr+"</td>"):p.credentials&&(h="<td>"+p.nameContext.label+" ："+p.nameContext.dataStr+"</td>",y='<td class="td--last" colspan="2">'+p.credentialsContext.label+" ："+p.credentialsContext.dataStr+"</td>")),m.name=h,m.mobile=b,m.credentials=y,s=e.Lang.sub(f,m),a||(a=new e.mt.Dialog({id:"cancel-appoint-dialog",width:"600px",title:"申请取消预约",content:s})),a.open(),i='<div class="J-cancel-loading-dialog">    <h2 class="tip">    退款页面跳转中，请耐心等待<span class="loading-surround cancel-loading"></span>    </h2></div>',"false"===u&&(c.setData("isEventBinded","true"),e.one("#cancel-appoint-dialog").delegate("click",function(){a.close(),n=new e.mt.Dialog({id:"cancel-loading-dialog",width:"270px",content:i}),n.open(),l(g,{method:"POST",on:{success:function(e,t){var a=r.getEvalRes(t);1===a.status?(n.close(),o.Dialog.alert("操作成功!")):(n.close(),o.Dialog.alert(a.errMsg)),setTimeout(function(){window.location.reload()},2e3)}}})},".J-confirm"),e.one("#cancel-appoint-dialog").delegate("click",function(){a.close()},".J-cancel"))})},".J-cancel-appoint")}}}()},"1.0.0",{requires:["www-base","www-dialog","w-calendar"]});
;