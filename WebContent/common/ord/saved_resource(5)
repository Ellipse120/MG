M.add("www-account",function(e){var t=e.io,n=e.Lang.trim,i=e.mt.lang.getLength,o=e.mt.util,a=e.mt.www,s=a.REG,r=e.mt.Dialog,l=e.mt.FormChecker;e.namespace("mt.www.Account"),e.mt.www.Account={charge:function(){function t(e){var t=e.get("value");return t===u?f:!h.test(t)||.01>t?p:!1}var n=e.one("#account-charge-form"),i=e.one(".component-payment-code");if(n){var s,r,c=500,d='<i class="tip-status"></i>提示：充值金额超出部分银行单笔支付额度，建议每次充值小于499元',u="",f="充值金额不能为空",p="请输入正确的充值金额",m=o.field(n,"money"),g=n.one("#account-charge-tip"),h=/^\d+(\.\d+)?$/,v=window.location.hash;v&&(v=v.replace("#",""),s=parseFloat(v),s&&m.set("value",s)),m.focus(),r=new l({form:n,fields:{money:{node:m,validateFn:t,typeTip:""}}}),m.on("keyup",function(){var e=this.get("value");h.test(e)&&(e>=c?g.set("innerHTML",d).setStyle("display",""):g.setStyle("display","none"))}),a.Util.initMobileBind(n),a.Dialog.Mobile.initSmsUpBind(n),n.on("submit",function(e){e.halt(),i?(i.on("component:pass",function(){n.submit()}),i.fire("component:submit")):n.submit()})}},payhash:function(){function t(){m&&(c=m.one(".J-origin-pwd"),d=m.one(".J-payment-pwd"),u=m.one(".J-repeat-pwd"),f=m.one(".J-verify-code"),p=m.one(".J-mobile")),c&&n()}function n(){i(),m.delegate("click",function(){m.one(".message-tip").toggleView()},".J-no-message-tip"),m.delegate("click",function(){var t=1,n="/account/setsmscode",i=m.one(".J-send-verify-code"),a=f.next(".J-error-tip"),s=1e3;e.io(n,{method:"POST",on:{success:function(e,t){var n=o.getEvalRes(t);r(n)},failure:function(){}},data:e.mt.util.toPostData({mobile:p.getHTML()})});var r=function(e){1===e.status?(i.addClass("btn-disabled"),i.next(".J-sended-tip").show(),i.set("value","重新获取（"+(60-t)+"）"),i.setAttribute("disabled","disabled"),setTimeout(function(){60>t?setTimeout(function(){r(e)},s):(i.removeClass("btn-disabled"),i.set("value","获取验证码"),i.removeAttribute("disabled"),i.next(".J-sended-tip").hide()),t++},s)):(a.one("span").setHTML(e.msg),a.show(),f.ancestor(".form-field").addClass("form-field--error"))}},".J-send-verify-code"),m.delegate("click",function(t){var n={currentpassword:c.get("value"),password:d.get("value"),password2:u.get("value")},i="/account/payhash",a='<h3 class="payment-code__tip">    <i class="icon tip-status tip-status--large--success"></i>    <span class="tip__title">支付密码修改成功！</span>    <a href="/account/security">返回安全中心</a></h3>';p&&f&&("INPUT"===p.get("tagName")?n.mobile=p.get("value"):n.mobile=p.getHTML(),n.verifycode=f.get("value")),t.halt(),e.Global.fire("Password.check"),e.Global.fire("Password2.check"),d.ancestor(".form-field").hasClass("form-field--ok")&&u.ancestor(".form-field").hasClass("form-field--ok")&&e.io(i,{method:"POST",on:{success:function(t,n){var i=o.getEvalRes(n);if(1===i.status)m.addClass("payment-code--modify--success"),m.setHTML(e.Lang.sub(a,{password:d.get("value")})),m.one(".payment-code__tip").one(".tip-status").addClass("tip-status--large").addClass("tip-stauts--large--success");else{var s=m.one(".J-submit-payhash").ancestor(".form-field");s.one(".tip-status").addClass("tip-status--error"),s.one(".inline-tip").one("span").setHTML(i.msg),s.one(".inline-tip").show()}}},data:e.mt.util.toPostData(n)})},".J-submit-payhash")}function i(){m.delegate("focus",function(){d.ancestor(".form-field").hasClass("form-field--ok")||(d.next(".inline-tip").one("span").setHTML(k),d.next(".inline-tip").show())},".J-payment-pwd"),m.delegate("blur",function(){a(!1)},".J-payment-pwd"),m.delegate("keyup",function(){a(!0),0!==u.get("value").length&&s(!0)},".J-payment-pwd"),e.Global.on("Password.check",function(){a(!1)}),m.delegate("focus",function(){u.ancestor(".form-field").hasClass("form-field--ok")||(u.next(".inline-tip").one("span").setHTML(C),u.next(".inline-tip").show())},".J-repeat-pwd"),m.delegate("blur",function(){s(!1)},".J-repeat-pwd"),m.delegate("keyup",function(){s(!0)},".J-repeat-pwd"),e.Global.on("Password2.check",function(){s(!1)}),m.delegate("focus",function(){this.next(".inline-tip").show(),this.next(".inline-tip").one("span").setHTML("请输入验证码")},".J-verify-code")}function a(e){var t,n=/^\d{6}$/;t=e?d.get("value").length>=6&&!n.test(d.get("value"))?g:6===d.get("value").length?h:v:n.test(d.get("value"))?h:g,r(t)}function s(e){var t;t=e?u.get("value").length<6?w:u.get("value")===d.get("value")?b:T:0===d.get("value").length?y:u.get("value")===d.get("value")?b:y,r(t)}function r(e){var t,n,i,o="";switch(t=-1!==e.indexOf("Password2")?u:d,n=t.ancestor(".form-field"),i=t.next(".inline-tip"),e){case w:case y:o=C;break;case T:o=M;break;case b:case h:o="";break;default:o=k}i.one("span").setHTML(o),i.show(),-1!==e.indexOf("wrong")?(n.addClass("form-field--error"),n.removeClass("form-field--ok"),i.one(".tip-status").replaceClass("tip-status--success","tip-status--error")):(n.removeClass("form-field--error"),i.one(".tip-status").removeClass("tip-status--error"),-1!==e.indexOf("right")?(n.addClass("form-field--ok"),i.one(".tip-status").addClass("tip-status--success")):(n.removeClass("form-field--ok"),i.one(".tip-status").removeClass("tip-status--success"))),l(e)}function l(e){switch(e){case h:u.removeAttribute("disabled");break;case g:case v:u.setAttribute("disabled","disabled")}}var c,d,u,f,p,m=e.one(".payment-code"),g="Password.wrong",h="Password.right",v="Password.undone",w="Password2.undone",b="Password2.right",y="Password2.wrong",T="Password2.wrong.reinput",k="支付密码必须是6位数字，且不同于登录密码",C="请再次输入支付密码",M="密码不一致，请重新输入";t()},cardCharge:function(){function n(){return w||m.hasClass("show")}function i(e,t){var n=o.getEvalRes(e);n.status?(l.addClass("isvalid"),d.set("disabled",!0),c.set("value",t),h.set("value","充值"),p.set("innerHTML",n.msg).setStyle("display","block"),v.setStyle("display",""),l.get("token").set("value",n.data.token),w=n.data.needCaptcha,w||m.removeClass("show")):(p.set("innerHTML",n.msg).setStyle("display","block"),d.focus(),n.data&&n.data.needCaptcha&&(m.addClass("show"),w=!0,s()))}function s(){var e;n()&&(e=g.getAttribute("surl")+"?"+Math.random(),g.set("src",e))}var r="/card/chargecheck",l=e.one("#credit-card-form"),c=l.get("cardcode"),d=l.get("cardcodefake"),u=e.one("#credit-card-link"),f=l.one("#credit-card-enter"),p=l.one("#credit-card-notice"),m=l.one("#credit-card-captcha"),g=l.one("#credit-card-captcha-img"),h=l.one("#credit-card-submit"),v=l.one("#credit-card-cancel"),w=!1;a.refreshCaptcha(l),u.on("click",function(){"none"===f.getStyle("display")?(f.setStyle("display","block"),d.focus()):f.setStyle("display","none")}),l.on("submit",function(e){var a,s,c=l.hasClass("isvalid"),u={};if(e.halt(),c)window.setTimeout(function(){l.submit()},10);else if(a=d.get("value"),""===a)d.focus();else{if(u.cardcode=a,s=l.get("captcha").get("value"),n()&&""===s)return void l.get("captcha").focus();u.captcha=s,t(r,{method:"POST",on:{success:function(e,t){i(t,a)}},data:o.toPostData(u)})}}),v.on("click",function(){l.removeClass("isvalid"),p.setStyle("display","none"),d.set("disabled",!1).focus(),c.set("value",""),h.set("value","确定"),v.setStyle("display","none"),n()&&m.addClass("show"),s()})},bindMobile:function(t,i){function a(){"account"===i?(l=o.field(t,"userid"),r=new e.mt.MobileBinder({action:"/account/checkmobile",ndOldMobile:c,ndMobile:d,ndVerify:"#mobile-verify",ndOldMsg:"#old-mobile-tip",ndMsg:"#mobile-tip",ndVerifyMsg:f,processPostDataFn:function(e){e.userid=l.get("value")}})):r=new e.mt.MobileBinder({ndOldMobile:c,ndMobile:d,ndVerify:"#mobile-verify",ndOldMsg:"#old-mobile-tip",ndMsg:"#mobile-tip",ndVerifyMsg:f})}function s(){t.on("submit",function(i){i.halt();var o=r.check();return o?void(r.get("status")===e.mt.MobileBinder.STATUS_OLD_MOBILE_INVALID?c.focus():r.get("status")===e.mt.MobileBinder.STATUS_MOBILE_INVALID&&d.focus()):u&&""===n(u.get("value"))?(r.setMsg(f,"请输入验证码",!0),void u.focus()):void t.submit()})}if(t=e.one(t)){var r,l,c=o.field(t,"oldmobile"),d=o.field(t,"mobile"),u=o.field(t,"verifycode"),f=t.one("#verify-tip");e.use("mt-mobilebinder",function(){a(),s()})}},autoRedirect:function(t,n){if(t=e.one(t)){var i=parseInt(t.get("innerHTML"),10);window.setInterval(function(){i?(i-=1,t.set("innerHTML",i)):window.location.href=n},1e3)}},captchaFocus:function(t){if(t=e.one(t),t&&t.get("captcha")){var n=t.get("captcha"),i=t.all(".captcha-refresh");i.on("click",function(){n.set("value","").focus()})}},initComplaintVerify:function(t){function n(){var e=d.get("value");return""===e?"请输入邮箱":s.email.test(e)?!1:"邮箱格式错误，请重新输入"}function i(){return!/^\d{11}$/.test(u.get("value"))}function a(){var e=m.get("value");return""===e?"请输入验证码":4!==e.length?"验证码输入错误，请重新输入":!1}var r=e.one(t);if(r){var c,d=o.field(r,"email"),u=o.field(r,"mobile"),f=o.field(r,"comment"),p=o.field(r,"name"),m=o.field(r,"captcha"),g=o.field(r,"password"),h=e.one("#signup-captcha-img");r.delegate("click",function(e){e.halt();var t=h.getAttribute("src").replace(/(\?0\.\d+)?$/,"");h.setAttribute("src",t+"?"+Math.random())},"#signup-captcha-img, .captcha-refresh"),c=new l({form:r,fields:{email:{node:d,validateFn:n,typeTip:""},mobile:{node:u,validateFn:i,typeTip:"",errorTip:"请输入11位手机号"},comment:{node:f,validateFn:l.CHECK_EMPTY_FN,typeTip:"",errorTip:"请输入您要申请的理由"},name:{node:p,validateFn:l.CHECK_EMPTY_FN,errorTip:"请输入您的真实姓名",typeTip:""},captcha:{node:m,validateFn:a,typeTip:""},password:{node:g,validateFn:l.CHECK_EMPTY_FN,typeTip:"",errorTip:"请输入密码"}},tipClass:l.CLASS_INLINE_TIP,checkEvent:"blur"})}},initFocus:function(t){t=e.one(t),t&&!t.get("value")&&t.focus()},login:function(t,n){if(t=e.one(t)){var i=t.get("email"),o=t.get("password"),a=t.get("commit");n||(i.get("value")?o.focus():i.focus()),this.captchaFocus(t),t.on("submit",function(){a.set("disabled",!0)})}},setAddress:function(){function n(e){return o.decodeAttr(e.ancestor(".action"),"params")}function i(e,n){t(e,{method:"POST",on:{success:function(e,t){var i=o.getEvalRes(t);i.status?_(n,!0):_(n,!1,i.msg)}}})}function a(t,n){var i,o;n?(o="添加地址",i="/account/addaddress"):(o="修改地址",i="/account/editaddress/"+t.id),p?(f.resetAllFields(),p.set("title",o),p.one(".body").append(w)):(p=new e.mt.Dialog({id:"address-dialog",title:o,width:680,content:""}),p.one(".body").append(w),w.show(),s()),d(i,t,n),c(),p.open()}function s(){f=new l({form:w,fields:{district:{node:T,validateFn:u,typeTip:""},address:{node:k,validateFn:function(){var e=k.get("value");return e.length<5||e.match(/^\d*$/)},typeTip:"",errorTip:"请填写街道地址，最少5个字，最多不能超过60个字，不能全部为数字"},zipcode:{node:C,validateReg:/^\d{6}$/,typeTip:"",errorTip:"邮政编码填写有误，请输入6位邮政编码"},name:{node:M,validateFn:function(){var e=M.get("value");return e.length<2||e.length>15},typeTip:"",errorTip:"请正确填写姓名，最少不能低于2个字，最多不能超过15个字"},phone:{node:L,validateFn:function(){var e=L.get("value");return 11===e.length?!/^1[34578]\d(\*{4}|\d{4})\d{4}$/.test(e):!/^\+?[\-0-9]{7,}$/.test(e)},typeTip:"",errorTip:"请填写正确的电话号码或手机号"}},tipClass:l.CLASS_INLINE_TIP,checkEvent:"blur",newStyle:!0}),y.on("change",function(){T.focus()}),w.on("submit",function(e){P.set("disabled",!0),e.halt(),t(w.get("action"),{method:"POST",form:{id:w},on:{success:function(e,t){var n=o.getEvalRes(t);n.status?window.location.reload():(r(n.msg),P.set("disabled",!1))}}})}),w.delegate("click",function(){L.set("disabled",!1).set("value",""),this.remove()},".J-phone-disable-btn"),S.on("click",function(e){e.halt(),p.close()})}function r(e){p.one(".error").setHTML(e).show()}function c(){p.one(".error").setHTML("").hide()}function d(t,n,i){var a=w.one("[data-widget=cascade]"),s=w.one(".J-phone-disable-btn");n=e.mix(n,{adrProvince:"-1",adrCity:"-1",adrDistrict:"-1",adrAddress:"",adrName:"",adrZipCode:"",adrPhone:""}),e.Global.fire("Cascade.set",{id:a.get("id"),setting:[n.adrProvince,n.adrCity,n.adrDistrict]}),w.set("action",t),e.Object.each(n,function(e,t){o.field(w,t,e)}),i?s&&s.remove():s||L.insert('<div class="J-phone-disable-btn address-phone-close common-close common-close--small"></div>',"after")}function u(){return"-1"===b.get("value")?"请选择省份":"-1"===y.get("value")?"请选择城市":"-1"===T.get("value")?"请选择市区":!1}var f,p,m="你确定删除这个地址吗？",g=e.one("#address-table"),h=e.one(".J-add"),v=g&&g.all(".J-default"),w=e.one("#address-form"),b=o.field(w,"adrProvince"),y=o.field(w,"adrCity"),T=o.field(w,"adrDistrict"),k=o.field(w,"adrAddress"),C=o.field(w,"adrZipCode"),M=o.field(w,"adrName"),L=o.field(w,"adrPhone"),P=o.field(w,"commit"),S=w.one(".address-cancel"),_=e.mt.www.Account.showResult;g&&(g.delegate("click",function(){i("/account/setaddress/"+n(this).id,"默认地址")},".J-default"),g.delegate("click",function(){window.confirm(m)&&i("/account/deladdress/"+n(this).id,"删除地址")},".J-delete"),g.delegate("click",function(){a(n(this),!1)},".J-edit"),g.delegate("hover",function(){var e=this.one(".J-default");v&&v.hide(),e&&e.show()},function(){var e=this.one(".J-default");e&&e.hide()},".table-item")),h&&h.on("click",function(){a({},!0)})},reset:function(t){if(t=e.one(t)){var n;n=new l({form:t,fields:this.getPassWordCheckerFields(t),tipClass:l.CLASS_INLINE_TIP})}},getPassWordCheckerFields:function(t,n){function i(){var e=a.get("value");return""===e?"请输入密码":6>e.length?"请至少设置6个字符":!1}function o(){var e=a.get("value"),t=s.get("value");return""===t?"请再次输入密码":e!==t?"两次输入的密码不一致，请重新输入":!1}var a,s;return(t=e.one(t))?(n=e.one(n)||t,a=n.one('[name="password"]'),s=n.one('[name="password2"]'),{password:{node:a,validateFn:i,typeTip:"至少6个字符"},password2:{node:s,validateFn:o,typeTip:""}}):null},bind:function(t){function n(e){var t=e.get("value");return""===t?"请填写邮箱地址":s.email.test(t)?!1:"邮箱格式错误，请重新输入"}if(t=e.one(t)){var i,a=t.one("#bind-signup-form"),r=t.one('.current [name="email"]'),c=o.field(a,"email"),d=e.one("#signup-captcha-img");r.focus(),i=new l({form:a,checkEvent:"blur",showOkTip:!0,fields:e.merge({email:{node:c,validateFn:n,typeTip:""}},this.getPassWordCheckerFields(a))}),e.delegate("click",function(e){var t,n,i,o=e.target,a=e.container,s=o.ancestor(".bind-box"),r=a.all('[name="signuped"]'),l=a.one(".current"),c=e.currentTarget.one('[name="signuped"]');for(n=0;n<r.size();n++)i=r.item(n),i!==c&&i.set("checked",!1),null===o.ancestor("label")&&c.set("checked",!0);s.hasClass("current")||(l.one(".content").transition({height:0,opacity:0}),l.removeClass("current"),s.addClass("current"),t=s.one(".content"),t.transition({height:t.get("scrollHeight")+"px",opacity:1}))},t,".bind-box h3",this),t.delegate("click",function(e){e.halt();var t=d.getAttribute("src").replace(/(\?0\.\d+)?$/,"");d.setAttribute("src",t+"?"+Math.random())},"#signup-captcha-img, .captcha-refresh")}},fetchPassword:function(){var t=e.one("#resetreq-form");if(t){var n,i=o.field(t,"email"),s=o.field(t,"captcha");a.refreshCaptcha(t),i.plug(e.mt.plugin.Placeholder),n=new l({form:t,fields:{email:{node:i,validateFn:l.CHECK_EMPTY_FN,typeTip:"",errorTip:"请输入正确的邮箱、手机号"},captcha:{node:s,validateFn:l.CHECK_EMPTY_FN,typeTip:"",errorTip:"请输入验证码"}}})}},verifyResetPassword:function(){function t(){var e,t=u.get("value"),n=f.get("value");return""===t?"最少 6 个字符":t.length<6?"密码太短，至少6个字符":t.length>32?"密码太长，最多32个字符":s.password.test(t)?(""!==n&&(e=r.get("fields").password2,r.checkField(e)),!1):"请输入正确的密码"}function n(){var e=u.get("value"),t=f.get("value");return""===t?"请再次输入密码":e!==t?"两次输入的密码不一致，请重新输入":!1}var i=e.one("#resetverify-form");if(i){var r,c=o.field(i,"captcha"),d=o.field(i,"verifycode"),u=o.field(i,"password"),f=o.field(i,"password2");a.refreshCaptcha(i),r=new l({form:i,fields:{verifycode:{node:d,validateFn:l.CHECK_EMPTY_FN,typeTip:"请填入您收到短信中的验证码",errorTip:"请填入您收到短信中的验证码"},password:{node:u,validateFn:t,typeTip:"最少 6 个字符"},password2:{node:f,validateFn:n,typeTip:"请再次输入密码"},captcha:{node:c,validateFn:l.CHECK_EMPTY_FN,typeTip:"请输入验证码",errorTip:"请输入验证码"}},checkEvent:"blur"})}},settings:function(t,n){t=e.one(t);var i=o.field(t,"currentpassword"),s=o.field(t,"password"),r=o.field(t,"password2"),l=/^[\x21-\x7e]{6,32}$/i,c={username:"用户名限4-16个字符，一个汉字为两个字符，必须以中文或英文字母开头",thesamepwd:"当前密码和新密码一致，请重新输入",currentpwd:"当前密码不能为空",whitespace:"密码中不能包含空格",password:"建议使用与您其它账户不同的密码",password2:"请再次输入密码以确认",notequal:"密码不一致，请重新输入"};t.on("submit",function(e){e.halt();var o,d,u;if(i&&(o=i.get("value")),d=s.get("value"),u=r.get("value"),""!==d||""!==u){if(""===o)return a.Dialog.alert(c.currentpwd),void i.focus();if(""===d||/\s/.test(d))return a.Dialog.alert(c.whitespace),void s.focus();if(!l.test(d))return a.Dialog.alert(c.password),void s.focus();if(""===u)return a.Dialog.alert(c.password2),void r.focus();if(d!==u)return a.Dialog.alert(c.notequal),void r.focus();if(o&&o===d)return a.Dialog.alert(c.thesamepwd),void s.focus()}return!n||(!i||o)&&d&&u?void t.submit():void a.Dialog.alert("密码不能为空，请输入密码")})},initSettings:function(s){function c(){function t(e){var t=n(e.get("value")),o=i(t);return""===t?"请填写新用户名":4>o?"用户名太短，至少4个字符":o>16?"用户名太长，最多16个字符":/^[a-zA-Z\u4e00-\u9fa5]/.test(t)?!1:"用户名必须以中文或英文字母开头"}var o,a,s,c=null,d=e.one("#username-reset-dialog-markup"),u="settings-username-reset-dialog";d&&(c=new r({id:u,width:"520px",title:"修改用户名",content:d.getHTML()}),c.open(),o=c.one("form"),s=o.one("#new-username"),a=new l({form:o,fields:{"new-username":{node:s,validateFn:t,typeTip:"以中文或英文字母开头，限4-16个字符，一个汉字为两个字符"}},tipClass:l.CLASS_BLOCK_TIP}))}function d(){var e=h.ancestor(".email-verify-container"),n=e.one(".unverified"),i=e.one(".verify-sending"),a=e.one(".verify-success"),s=e.one(".verify-failure");n.hide(),i.show(),t("/account/verifyemail",{method:"POST",on:{success:function(e,t){var n=o.getEvalRes(t);i.hide(),n.status?(a.one("a").setAttribute("href",n.url),a.show()):(n.msg&&s.setHTML(n.msg),s.show())},failure:function(){i.hide(),s.show()}}})}if(s=e.one(s)){var u=a.Dialog.Mobile,f=s.one("#settings-username-reset"),p=s.one("#settings-password-reset"),m=s.one("#email-bind"),g=s.one("#email-modify"),h=s.one("#email-verify"),v=s.one("#password-set"),w=s.one("#settings-mobile-bind"),b="true"===o.data(s,"needSmsUp");f&&f.on("click",function(e){e.halt(),c()}),p&&p.on("click",function(e){e.halt(),a.Dialog.Password.reset()}),m&&m.on("click",function(e){e.halt(),a.Dialog.Email.bind()}),g&&g.on("click",function(e){e.halt(),a.Dialog.Email.bind(!0,!!o.data(this,"verified"))}),h&&h.on("click",function(e){e.halt(),d()}),v&&v.on("click",function(e){e.halt(),a.Dialog.Password.set()}),w&&w.on("click",function(e){e.halt(),u.bind(null,b)})}},initSecurity:function(n){function i(){var e=c.ancestor(".security-lists__item__col"),n=e.one("#J-email-verifie"),i=e.one("#J-email-bind"),a=e.one("#J-email-sending"),s=e.one("#J-email-sended"),r=e.one("#J-email-check"),l=e.one("#J-email-failed");n.hide(),i.hide(),a.show(),t("/account/verifyemail",{method:"POST",on:{success:function(e,t){var n=o.getEvalRes(t);a.hide(),n.status?(r.setAttribute("href",n.url),s.show(),r.show()):(n.msg&&l.setHTML(n.msg),l.show())},failure:function(){a.hide(),l.show()}}})}if(n=e.one(n)){var s=a.Dialog.Mobile,r=e.one("#J-change-passwd"),l=e.one("#J-mobile-bind"),c=e.one("#J-email-verifie"),d=e.one("#J-email-bind"),u=e.one("#J-set-password"),f=e.one("#J-mobile-check"),p="true"===o.data(n,"needSmsUp");r&&r.on("click",function(e){e.halt(),a.Dialog.Password.reset()}),l&&l.on("click",function(e){e.halt(),s.bind(null,p)}),f&&l&&f.on("click",function(e){a.Dialog.alert("请先绑定手机号再进行设置!"),e.halt()}),u&&u.on("click",function(e){e.halt(),a.Dialog.Password.set()}),d&&d.on("click",function(e){e.halt(),a.Dialog.Email.bind()}),c&&c.on("click",function(e){e.halt(),i()})}},initUserexinfo:function(){function t(){function e(e){var t,n="<option>--</option>";for(t=1;e>=t;t++)n+=""!==s&&s===t?'<option selected="selected">'+t+"</option>":"<option>"+t+"</option>";return n}var t=i.get("value"),n=o.get("value"),r=e(31),l=e(30),c={1:r,3:r,4:l,5:r,6:l,7:r,8:r,9:l,10:r,11:l,12:r};t%4===0&&t%100!==0||t%400===0?c[2]=e(29):c[2]=e(28),"--"!==t&&"--"!==n&&a.setHTML(c[n])}var n=e.one("#J-userexinfo-form"),i=n.one("#J-userexinfo-birthday-year"),o=n.one("#J-userexinfo-birthday-month"),a=n.one("#J-userexinfo-birthday-day"),s=parseInt(a.get("value"),10);n&&(""!==s&&t(),o.on("change",t),i.on("change",t),a.on("change",function(){var e=a.get("value");s="--"===e?1:parseInt(e,10)}),n.on("submit",function(t){function s(e){e.get("checked")&&(m=!0)}var r=n.all('[name="gender"]'),l=n.all('[name="identity"]'),c=n.all('[name="merriage"]'),d=n.all('[name="interest[]"]'),u="--"===i.get("value")?!1:!0,f="--"===o.get("value")?!1:!0,p="--"===a.get("value")?!1:!0,m=!1;!(u||f||p)||u&&f&&p||(t.halt(),e.use("www-tips",function(e){e.mt.www.SysMsg.show("error","请填写完整的生日信息")})),r.each(s),l.each(s),c.each(s),d.each(s),m||(t.halt(),e.use("www-tips",function(e){e.mt.www.SysMsg.show("error","请至少填写一项信息")}))}))},manageSubscription:function(){function n(e){return!y.get("checked")&&e.all("."+C+" .existent").isEmpty()?"请添加您想订阅的城市":!1}function i(e,t){var n=u.all("."+t),i=!1;return n.some(function(t){var n=t.one(".existent"),a=o.data(n,"cityid");return a===e?(i=t,!0):void 0}),i}function s(t){var n=e.one(t),i=!1,o=[];return n?(n.get("multiple")||(i=!0),n.get("options").each(function(e){e.get("selected")&&o.push(e.get("text")),!i}),o.length>1?o:o.join("")):o.join("")}var r=e.one(".subscription-form");if(!r){var c=e.one("#J-email-bind");return void c.on("click",function(e){e.halt(),a.Dialog.Email.bind()})}var d,u=r.one(".city-wrapper"),f=r.one(".more"),p=f.one("a"),m=r.one(".add-city"),g=m.one(".add"),h=m.one(".error"),v=o.field(r,"province"),w=r.one(".operate"),b=u.one(".no-subscribe"),y=r.one("#frequency-0"),T=r.one(".frequency-list"),k=o.field(r,"city"),C="subscribe-list-item",L="unsubscribe-list-item",P="isnosubscribechosen";p.on("click",function(e){e.halt(),f.hide(),m.show()}),k.on("change",function(){h.hide()}),v.on("change",function(){h.hide()}),d=new l({form:r,fields:{"city-wrapper":{node:u,validateFn:n,typeTip:""}},tipClass:l.CLASS_INLINE_TIP}),r.on("submit",function(n){n.halt();var i,a,s,l=[];y.get("checked")?(s=u.all(".item .old-list-item"),s.isEmpty()||s.each(function(e){l.push('<input type="hidden" name="cityUnsubList[]" value="'+o.data(e,"cityid")+'" />')}),o.Cookie.set(P,"1",o.Cookie.getExpiresDate(365,0,0),"/",M.DOMAIN_HOST)):(a=u.all("."+L+" .old-list-item"),a.isEmpty()||a.each(function(e){l.push('<input type="hidden" name="cityUnsubList[]" value="'+o.data(e,"cityid")+'" />')}),i=u.all("."+C+" .existent"),i.isEmpty()||i.each(function(e){l.push('<input type="hidden" name="citySubList[]" value="'+o.data(e,"cityid")+'" />')}),o.Cookie.set(P,"0",o.Cookie.getExpiresDate(365,0,0),"/",M.DOMAIN_HOST)),w.append(l.join(""));var c=e.mt.www.Account.showResult;t(r.get("action"),{method:"POST",form:{id:r},on:{success:function(e,t){var n=o.getEvalRes(t);n.status?c("邮件订阅设置",!0):c("邮件订阅设置",!1,n.msg)},failure:function(){c("邮件订阅设置",!1)}}})}),T.on("click",function(){y.get("checked")&&d.resetField("city-wrapper")}),g.on("click",function(){var t,n,o=k.get("value"),a=s(k);return y.get("checked")&&e.one("#frequency-1").set("checked",!0),"-1"===o?(h.set("innerHTML","请选择城市"),void h.show()):i(o,C)?(h.set("innerHTML","该城市已在您的订阅列表中。"),void h.show()):(b.hide(),n=i(o,L),d.resetField("city-wrapper"),n?(n.replaceClass(L,C),f.insert(n,"before"),void n.show()):(t=e.Lang.sub(e.one("#subscribe-city-item-markup").getHTML(),{itemClass:C,cityId:o,cityName:a}),void f.insert(t,"before")))}),u.delegate("click",function(){var e,t=this.ancestor(".item");t.hide(),t.replaceClass(C,L),e=u.all("."+C),0===e.size()&&(b.setHTML("暂未订阅任何城市"),b.show()),h.hide()},"span.close")},showResult:function(e,t,n){var i,o=null,a="subscribe-setting-dialog";i=t?{type:"success",title:"操作成功",tip:""}:{type:"failure",title:"操作失败",tip:n||"网络错误，请稍候重试"},o=new r({id:a,width:"420px",title:e,content:""}),o.showResult(i),o.open(),o.set("autoHide",2),o.after("close",function(){t&&window.location.reload()})},repeatVerifyMail:function(t){var n=e.one(t),i=n.next(),o=n.getAttribute("data-email"),a="disabled",s="color",r="red",l="green",c="text";n.on("click",function(t){t.halt(),n.getAttribute(a)||(n.setAttribute(a,a),i.setStyle(s,l).set(c,"发送中..."),e.io("/account/resendSignupMail",{method:"POST",data:{email:o},on:{success:function(t,o){var l=e.JSON.parse(o.responseText),d=l.status;0===d?(i.setStyle(s,r).set(c,"邮件发送失败，请稍后重试。"),n.removeAttribute(a)):1===d?(i.set(c,"发送成功。"),n.removeAttribute(a)):2===d&&(n.hide(),n.previous().hide(),i.setStyle(s,r).set(c,"您发送次数过多，请到邮箱查阅。"))},failure:function(){i.setStyle(s,r).set(c,"网络繁忙请稍后重试！"),n.removeAttribute(a)}}}))})},withdraw:function(t,n){function i(){var e=parseFloat(s.get("value")),n=parseFloat(t);return!m.test(e)||e>n||.01>e?"提现金额输入错误，请检查":!1}function a(t){function n(){var e=c.one(".confirm"),t=c.one(".cancel");e.on("click",function(e){e.halt(),c.close(),f.submit()}),t.on("click",function(e){e.halt(),c.close()})}t.halt();var i=s.get("value"),o=e.one("#dialog-withdraw-markup");c?(c.set("content",e.Lang.sub(o.getHTML(),{amount:i})),c.open()):(c=new r({id:p,title:"提现",width:"320px",content:e.Lang.sub(o.getHTML(),{amount:i})}),c.open()),n()}var s,c,d,u,f=e.one("#account-withdraw-form"),p="withdraw-promt-dialog",m=/^(([1-9]\d*)|0)(\.\d{1,2})?$/;if(f){var g=e.one("#apply-cardno"),h=e.one("#cardno-tip");g&&h&&(g.on("focus",function(){h.show()}),g.on("blur",function(){h.hide()})),s=o.field(f,"value"),d={node:s,validateFn:i,typeTip:"需在0.01元到"+t+"元之间，最多精确到2位小数"},n?(u=e.mt.www.Account.initBankInfo(f),u.addField("money",d)):(u=new l({form:f,fields:{money:d},tipClass:l.CLASS_INLINE_TIP}),f.on("submit",a))}},initWithdrawMobileVerify:function(t){function n(e){return i(c)?(a.Dialog.alert("请输入手机验证码。"),void e.halt(!0)):h?void 0:(a.Dialog.alert("请获取手机验证码。"),void e.halt(!0))}function i(e){return""===e.get("value")}function s(){p&&p.isInProgress()||(p=e.io(m,{method:"POST",on:{success:function(e,t){var n=o.getEvalRes(t);n.status?(r(n),h=!0):(l(n),h=!1)},failure:function(){d.set("disable",!1),h=!1}}}))}function r(){var e,t=60;d.set("value","重新获取("+t+")").set("disabled",!0),e=window.setInterval(function(){t-=1,t?d.set("value","重新获取("+t+")"):(window.clearInterval(e),d.set("value","重新获取").set("disabled",!1),u.setHTML("").removeClass(g))},1e3)}function l(e){u.setHTML(e.msg).addClass(g).setStyle("zoom",1)}var c,d,u,f,p,m="/account/sendwithdrawverifycode",g="error",h=!1;t=e.one(t),t&&(c=o.field(t,"verifycode"),d=t.one(".verify-btn"),u=t.one(".verify-tip"),f=t.one("#J-rebind-mobile"),c&&d&&(t.on("submit",n),d.on("click",function(){s()})),f&&f.on("click",function(){o.Cookie.set("fromurl",window.location.href,o.Cookie.getExpiresDate(0,0,60),"/","."+M.DOMAIN_HOST)}))},initBankInfo:function(t){function i(){e.Global.on("Cascade.change",function(t){var n,i="/order/listbranch/";t.id===u.get("id")&&2===t.index&&(n=u.all("select"),i+=n.get("value").join("/"),e.Global.fire("AutoComplete.updateData",{id:p.get("id"),action:i}))})}function a(){e.Global.on("AutoComplete.select",function(e){e.id===p.get("id")&&("0"===e.data.id?m.show():(m.hide(),g.set("value","")))})}function s(){var e=f.get("value");return""===e||"-1"===e?"请选择银行":"0"===e&&""===g.get("value")?"请手工填写银行支行名称":!1}function r(){return""===n(h.get("value"))?"请填写开户人姓名":!1}function c(){return""===n(v.get("value"))?"请填写银行账号":!1}if(t=e.one(t),!t)return null;var d,u=t.one(".branch-cascade"),f=o.field(t,"branchid"),p=t.one(".auto-complete-branchid"),m=t.one(".no-branch"),g=o.field(t,"branchname"),h=o.field(t,"username"),v=o.field(t,"cardno");return e.use("w-base","w-autocomplete",function(){i(),a()}),d=new l({form:t,fields:{branch:{node:p,validateFn:s,typeTip:""},userName:{node:h,validateFn:r,typeTip:""},cardno:{node:v,validateFn:c,typeTip:""}},tipClass:l.CLASS_BLOCK_TIP}),e.all([p,g]).on("blur",function(){d.get("fields").branch.status=l.STATUS_INIT}),d},initGrowth:function(n){var i=e.one("body"),a=new e.mt.Dialog({id:"growth-upgrade-dialog",width:"420px",title:"领取成长值",content:"",onClose:function(){window.location="/account/growth"}});if(i.delegate("click",function(e){var n=this.getData("type");e.halt(),t("/account/addgrowthonce",{method:"POST",data:{type:n},on:{success:function(e,t){var n=o.getEvalRes(t);n.status?(n.growth?a.showResult({type:"success",title:"操作成功",tip:'您已获得<span class="growth-dialog-focus">'+parseInt(n.growth,10)+"个成长值</span>"}):a.showResult({type:"failure",title:"领取失败",tip:"你已经领取过了！"}),a.open()):(a.showResult({type:"failure",title:"领取失败",tip:"后端无法响应，请稍后重试！"}),a.open())},failure:function(){a.showResult({type:"failure",title:"领取失败",tip:"网络异常，请稍后重试"}),a.open()}}})},".growth-award-get"),n){var s=e.one(n.dialogMarkupID),r=new e.mt.Dialog({id:"growth-upgrade-dialog",width:"420px",content:s.getHTML(),onClose:function(){window.location="/account/growth"}});r.open()}},initVipRewards:function(n){function i(){var e=u.one(".J-confirm");e.on("click",function(){u.close(),a(s)})}function a(i){u.set("title",""),u.on("close",function(){window.location.reload()}),t(n.fetchUrl,{method:"POST",data:{marketingid:i.marketingid},on:{success:function(t,n){var i=o.getEvalRes(n),a="";i.status?(a=e.Lang.sub(c.getHTML(),{cardvalue:i.cardvalue,endtime:i.endtime,minmoney:i.minmoney}),u.set("content",a),u.open()):(u.showResult({type:"failure",title:"兑换失败",tip:i.errinfo}),u.open())},failure:function(){u.showResult({type:"failure",title:"兑换失败",tip:"网络异常，请稍后重试"}),u.open()}}})}var s,l=e.one(n.cardList),c=e.one(n.fetchDialog),d=e.one(n.confirmDialog),u=null;l&&(u=new r({id:"magiccard-fetch-dialog",width:"440px"}),l.delegate("click",function(t){t.halt();var n=d.getHTML(),a=o.decodeAttr(this,"params");a.totalPoint&&a.needPoint&&a.marketingid&&(0===a.minMoney?a.minMoney="":a.minMoney='<li class="dialog__msg-item">购物满<em class="em-red">'+a.minMoney+"</em>元可用</li>",a.isMobileCard?a.mobileTip='<li class="dialog__msg-item">限在<em class="em-red">美团手机客户端</em>上使用（含iPhone/Android/iPad/WP）</li>':a.isMaoyanCard?a.mobileTip='<li class="dialog__msg-item">仅限<em class="em-red">猫眼电影选座</em>业务中使用，使用平台： 猫眼App/美团主站/团购App/猫眼wap版</li><li class="dialog__msg-item">不限影片</li><li class="dialog__msg-item">万达影院、特惠场次不可使用</li>':a.categoryTip?a.mobileTip='<li class="dialog__msg-item dialog__msg-item--important">仅限'+a.categoryTip+"类目使用！其他品类无法使用！</li>":a.mobileTip="",s=a,u.set("title","温馨提示"),u.set("content",e.Lang.sub(n,a)),u.open(),i())},n.fetchBtn))},initUploadAvatar:function(){e.use("uploader","w-image-cropper",function(e){function n(e){alert(e)}function i(){var t,n=["image/*"],i=[{description:"Images",extensions:"*.jpg;*.png;*.gif;*.bmp;*.jpeg"}],o={appendNewFiles:!1,fileFieldName:"userfile",swfURL:"http://s0.meituan.net/vendor/assets/flashuploader.swf",uploadURL:f};t="html5"===e.Uploader.TYPE?n:i,o.fileFilters=t,l=new e.Uploader(e.mix({selectFilesButton:s},o)).render(a)}var a=e.one(".J-upload-avatar-w"),s=a.one(".J-upload-avatar");if("none"===e.Uploader.TYPE)return void s.on("click",function(){n("您的浏览器不支持flash，不支持上传")});var l,c,d,u,f="/account/uploaduseravatar",p="/account/resizeuseravatar",m="user-avatar-dialog",g=new r({id:m,title:"上传头像",width:"512px"}),h=new r({id:"upload-fail-dialog"});i(),l.on("fileselect",function(t){return t.fileList[0].get("size")>5242880?(h.showResult({width:"400px",type:"failure",title:"您上传的图片超过了5M，请重新选择"}),void h.open()):(g.set("content",e.Lang.sub(e.one("#user-avatar-dialog-markup").getHTML(),{src:"http://s0.meituan.net/www/img/lazyloading-srcimg.png"})),g.open(),g.one(".J-uploading").show(),void l.uploadThese(t.fileList))}),l.on("uploadcomplete",function(t){if(!t.data)return g.close(),void n("网络错误，请稍后再试");var i=e.JSON.parse(t.data);if(!i.status){g.close();var o={tip:i.error||"上传头像失败",type:"failure"},a=new e.mt.Dialog(o);return a.open(),void a.showResult(o)}var s=i.url,r=i.size,l=Math.min(r.width,r.height,180);s&&(g.set("content",e.Lang.sub(e.one("#"+m+"-markup").getHTML(),{src:s})),u=g.one(".J-avatar"),d=u.one("img"),d.on("load",function(){c=new e.mt.widget.ImageCropper({srcNode:u,constrainNode:".avatar-content ",source:s,minResizeWidth:l,minResizeHeight:l,previewArea:".J-preview-area"}),c.render()}),d.set("src",s),d.show())}),e.one("#"+m).delegate("click",function(){if(c){var i=c.getCropperInfo();i.userfile=d.get("src"),t(p,{method:"POST",data:i,on:{success:function(t,i){var a=o.getEvalRes(i);if(a.status&&a.url){g.close();var s={autoHide:2,tip:"上传头像成功",type:"success"},r=new e.mt.Dialog(s);r.open(),r.showResult(s),window.setTimeout(function(){document.location.href=document.location.href;
},2e3)}else g.close(),n("网络错误，请稍后再试")},failure:function(){g.close(),n("网络错误，请稍后再试")}}})}},".submit"),l.on("uploaderror",function(){g.close(),n("网络错误，请稍后再试")})})},QuestionStick:{init:function(t){var n=t.one(".question-enter"),i=t.one(".questions");e.use("uix-sticky",function(e){new e.mt.uix.Sticky(t,{canDisappear:!0,mainAreaWidth:980,bottomEdge:".site-info-w",hAlign:"right",vAlign:"bottom",vMinScrollTop:0,vBottomOffset:180})}),t.on("hover",function(){n.hide(),i.show()},function(){i.hide(),n.show()})}}}},"1.0.0",{requires:["www-base","www-dialog","mt-formchecker","transition"]});
;