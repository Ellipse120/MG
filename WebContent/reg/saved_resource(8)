M.add("uix-sticky",function(e){function t(t,n){var i={mainAreaWidth:980,hideWhenTooNarrow:!1,canDisappear:!1,hAlign:"left",hLeftOffset:10,hRightOffset:10,vAlign:"top",vTopOffset:0,vBottomOffset:0,vMinScrollTop:0,topEdge:null,isStaticBottomEdge:!1,bottomEdge:"#ft",side:"right"};if(n.topEdge&&e.Lang.isNumber(n.topEdge)===!1){var a=e.one(n.topEdge);a&&(this._topEdgeNode=a,n.topEdge=a.getY())}if(this.ndHost=e.one(t),this.config=e.merge(i,n),!this.ndHost)throw new Error("Y.mt.uix.Sticky: 没有设置ndHost或ndHost不存在");if(e.Lang.isNumber(this.config.bottomEdge)&&!this.config.isStaticBottomEdge)throw new Error("Y.mt.uix.Sticky: isStaticBottomEdge为false时，bottomEdge不能为数字");var o=e.mt.UIUtil.getDimensions(t);this._hostHeight=o.offsetHeight,this._hostWidth=o.offsetWidth,this._topEdge=this.config.topEdge,this._delta=10,this.shouldShow={horizontal:!0,vertical:!0},this._handlers={},this._bindEvent()}var n=e.mt.util,i=6===e.UA.ie,a="px";t.prototype={_bindEvent:function(){function t(){a._destroy||(a._handleDisplay(),a._alignVertical())}function i(){a._destroy||(a._handleDisplay(),a._alignVertical(),a._alignHorizontal())}var a=this;a._align(),a._handleDisplay(),e.Global.on("PageHeight:change",function(){window.setTimeout(function(){a.config.isStaticBottomEdge&&a._getBottomEdge(!0),t()},50)}),window.setTimeout(i,200),e.mt.util.addLoadListener(function(){a._getBottomEdge(!0)});var o=e.one(window);this._handlers.scroll=o.on("scroll",n.throttle(t)),this._handlers.resize=o.on("resize",n.throttle(i))},isVisible:function(){var e=this;return e.shouldShow.vertical&&e.shouldShow.horizontal},_hideCanDisappear:function(){if(this.config.canDisappear){var e=this.ndHost,t=this.config.vMinScrollTop,n=parseInt(e.get("docScrollY"),10);this.shouldShow.vertical=n>=t}},_hideWhenNarrow:function(){if(this.config.hideWhenTooNarrow){var t,n=this._hostWidth,i=e.one(window).get("winWidth"),a=this.config,o=parseInt(a.mainAreaWidth,10),r=parseInt(a.hLeftOffset,10),s=parseInt(a.hRightOffset,10);t="right"===a.hAlign?s:r,this.shouldShow.horizontal=(i-o)/2>=n+t}},_handleDisplay:function(){var e=this.ndHost;this._hideCanDisappear(),this._hideWhenNarrow(),this.isVisible()?e.show():e.hide()},_alignHorizontal:function(){if(this.isVisible()){var t=this,n=t.ndHost,i=t.config,o=parseInt(i.mainAreaWidth,10),r=parseInt(i.hLeftOffset,10),s=parseInt(i.hRightOffset,10),u=e.one(window),l=u.get("winWidth"),c=t._hostWidth;"right"===i.side?"right"===i.hAlign?n.setStyle("right",i.hRightOffset+a):c+r>(l-o)/2?n.setStyle("left",l-c-r+a):n.setStyle("left",(l+o)/2+r+a):"left"===i.hAlign?n.setStyle("left",r+a):c+s>(l-o)/2?n.setStyle("right",l-c-s+a):n.setStyle("right",(l+o)/2+s+a)}},_alignVertical:function(){if(this.isVisible()){var t,n,o=this,r=this.config,s=this.ndHost,u=e.one(window),l=u.get("winHeight"),c=parseInt(r.vBottomOffset,10),h=r.vAlign,d=s.get("docScrollY"),g=parseInt(o._getBottomEdge(),10),f=o._topEdge,p=o._topEdgeNode,m=o._delta,v=o._hostStyleTop,y=o._hostHeight;p&&(f=p.getY());var b=d+l-g;i?("bottom"===h?(t=d+l-(c+y),f&&f>t?t=f:b>0&&(t-=b)):(t=d+v,g&&y+t+c>g?t=g-y-c:f&&f>t?t=f:b>0&&t+y>g&&(t=g-y-m)),s.setStyle("top",t+a)):"bottom"===h?(n=c,f&&f-d>l-(y+n)?n=l-(f-d)-y:b>0&&(n+=b),s.setStyle("bottom",n+a)):(t=v,g&&d+y+t+c>g?t=g-d-y-c:f&&f>d+t?t=f-d:b>0&&d+t+y>g&&(t=g-d-y-m),s.setStyle("top",t+a))}},_align:function(){var t=this,n=t.config,i=t._delta,a=parseInt(n.vTopOffset,10),o=a,r=e.one(window),s=r.get("winHeight"),u=t._hostHeight;o&&(o=a+u>s?s-u-i:a),t._hostStyleTop=o,t._alignVertical(),t._alignHorizontal()},_getBottomEdge:function(t){var n=this,i=this.config,a=i.bottomEdge,o=i.isStaticBottomEdge,r=n.ndHost.get("docHeight"),s=e.one(a),u=a;if(o){if(n._staticBottomEdge&&!t)return n._staticBottomEdge;u=e.Lang.isNumber(a)?parseInt(a,10):s?s.getY():r,n._staticBottomEdge=u}else u=s?s.getY():r;return u},destroy:function(){this._destroy=!0,n.detachHandle(this._handlers)}},e.namespace("mt.uix"),e.mt.uix.Sticky=t},"1.0.0",{requires:["mt-base","mt-uiutil","node"]});
M.add("crm-business-opportunity/gotop",function(e){function t(e){this.container=e.container,this.refNode=e.refNode,this.initializer()}var n=e.config.win,i=n.document;t.NAME="GOTOP",t.prototype={initializer:function(){this.goTopBtnEvt(),this.changeLeftVal(),this.showGoTopW(),this.onResizeEvt(),this.onScrollEvt()},onResizeEvt:function(){var e=this;n.onresize=function(){e.changeLeftVal()}},onScrollEvt:function(){var t=this.container;new e.mt.uix.Sticky(t,{canDisappear:!0,bottomEdge:".ftw",hAlign:"right",vAlign:"bottom",vMinScrollTop:0,vBottomOffset:20}),n.onscroll=function(){var e=i.documentElement.scrollTop||n.pageYOffset||i.body.scrollTop;e>0?t.show():t.hide()}},goTopBtnEvt:function(){var e=this.container.one(".go-top");e&&e.on("click",function(){i.documentElement.scrollTop=0,i.body.scrollTop=0})},showGoTopW:function(){var e=this.container,t=i.documentElement.scrollTop||n.pageYOffset||i.body.scrollTop;t>0&&e.show()},changeLeftVal:function(){var e=this.container,t=this.refNode,n=t.getX()+t.get("offsetWidth"),i=e.get("winWidth")-60;n>i&&(n=i),e.setStyle("left",n)}},e.namespace("mt.crm.businessopportunity").GoTop=t},"1.0.0",{requires:["uix-sticky","event-synthetic"]});
M.add("crm-business-opportunity/create-entity",function(e,t){function n(){return this instanceof n?(this.initEntityTextAreaTip(),this.submitEntityFormEvt(),this.initEntityCity(100),a.initCategory(i,3),new e.mt.crm.businessopportunity.FeedBack({ndTrigger:".add-feedback",fbContainer:e.one(".feedback-container")}),new e.mt.crm.businessopportunity.GoTop({container:e.one(".go-top-w"),refNode:e.one(".boform-info")}),void a.initOpportunityTypeTip(".opportunity-type-tip")):new n}var i=e.one("#feedback-form"),a=e.mt.crm.businessopportunity.common,o=e.mt.City,s=e.mt.BusinessArea,r=e.Lang.trim,l=e.mt.crm.util,u=e.mt.util,c=e.config.win,d=null,h=null,g=null,f=e.namespace("mt.crm.businessopportunity");n.prototype={constructor:n,initEntityTextAreaTip:function(){var t="产品品牌:\n\n产品链接:\n\n美团价:\n\n供货价:\n\n库存量:\n\n其他介绍:";e.one("#suggest").set("value",t)},initEntityCity:function(t){var n=i.one(".city-id"),s=i.one(".city-name"),l=this;o.init(function(i){a.deleteYiWuCity(i);var o=new e.mt.widget.AutoCompleteList({node:s,listParam:"name",objList:i,showMax:"10",width:t,callback:function(){var e=n.get("value");""!==e&&"-1"!==e&&l.initEntityDistrict(e,t)}});s.on("blur",function(){if(d){var i=r(s.get("value"));e.Array.some(d,function(e){return""!==i&&-1!==e.name.indexOf(i)?(n.set("value",e.id),l.initEntityDistrict(e.id,t),!0):!1})}}),o.on("beforeShowResultBox",function(e){d=e.objList})})},initEntityDistrict:function(t,n){var a=i.one(".district-name"),o=i.one(".district-id");s._initData(t,function(t){g?g.updateData({data:t}):(g=new e.mt.widget.AutoCompleteList({objList:t,listParam:"name",node:a,showMax:"10",width:n||90,callback:function(){}}),a.on("blur",function(){var t=r(a.get("value"));h&&e.Array.some(h,function(e){return""!==t&&-1!==e.name.indexOf(t)?(o.set("value",e.id),!0):!1})}),g.on("beforeShowResultBox",function(e){h=e.objList}))})},submitEntityFormEvt:function(){var t=i.one(".submit-btn"),n=this;i.on("submit",function(o){if(o.halt(!0),n.checkEntityForm()){var s=l.tipLoading();l.toggleDisabled(t),e.io(i.get("action"),{method:"POST",form:{id:"feedback-form"},on:{success:function(e,n){s.close(),l.toggleDisabled(t);var o=u.decodeJSON(n.responseText);o&&200===o.status?location.href="/crmopen/business/opportunity/embed/addSuccess?handleDay=3":o&&o.status?a.showErrorTip(i,o):l.tipFn("<p>服务器异常，提交失败，请稍候重试</p>","300")},failure:function(){s.close(),l.toggleDisabled(t),l.tipFn("<p>意外错误，请刷新后重试</p>","300")}}})}})},checkEntityForm:function(){var e=i.one(".user-name"),t=r(e.get("value")),n=i.one(".mobile"),a=r(n.get("value")),o=i.one(".qq"),s=r(o.get("value")),l=i.one(".email"),u=r(l.get("value")),d=i.one(".company-name"),h=r(d.get("value")),g=i.one(".online-address"),f=r(g.get("value")),p=i.one(".cat-id"),m=i.one(".cat-name"),v=r(p.get("value")),b=i.one(".city-name"),y=i.one(".city-id"),w=r(y.get("value")),_=i.one(".district-name"),C=i.one(".district-id"),x=r(C.get("value")),T=i.one(".address"),S=r(T.get("value")),k=new RegExp(/^([\u4e00-\u9fa5]|[a-zA-Z]|[0-9])+$/);if(""===t)return c.alert("请填写您的姓名"),e.focus(),!1;if(!k.test(t))return c.alert("姓名只支持中英文和数字"),e.focus(),!1;if(t.length>30)return c.alert("姓名长度过长，请不要超过30个字符"),e.focus(),!1;var A=new RegExp(/^\d+$/);if(""===a)return c.alert("请填写手机号"),n.focus(),!1;if(11!==a.length||!A.test(a))return c.alert("填写的手机号格式不对"),n.focus(),!1;var E=new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);if(u.length>0&&!E.test(u))return c.alert("填写的邮箱格式不正确, 例如:xxxx@meituan.com"),l.focus(),!1;var D=new RegExp(/^\d+$/);return 0===s.length?(c.alert("请填写QQ号"),o.focus(),!1):D.test(s)?""===h?(c.alert("请填写公司名称"),d.focus(),!1):/[\|｜、:：;；]/.test(h)?(c.alert("公司名称中不能包含特殊字符\\|｜、:：;；"),d.focus(),!1):h.length>100?(c.alert("公司名称长度过长，请不要超过100个字符"),d.focus(),!1):0===f.length?(c.alert("请填写店铺链接地址"),g.focus(),!1):""===v?(c.alert("团购类型不允许为空"),m.focus(),!1):"-1"===v?(c.alert("请选择二级品类"),m.focus(),!1):""===w?(c.alert("请填写城市,支持拼音搜索"),b.focus(),!1):""===x?(c.alert("请填写行政区,支持拼音搜索"),_.focus(),!1):S.length>250?(c.alert("详细地址长度过长，请不要超过250个字符"),T.focus(),!1):!0:(c.alert("QQ号只支持数字"),o.focus(),!1)}},f.CreateEntity=n;var p=e.config[t];p.init===!0&&new f.CreateEntity(p)},"1.0.0",{requires:["crm-city","crm-businessarea","node","w-autocomplete","io","mt-base","crm-business-opportunity/feedback","crm-business-opportunity/common","crm-business-opportunity/gotop","crm-util"]});